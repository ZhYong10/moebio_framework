<!DOCTYPE html>
<html lang='en' ng-app='moebio'>
<head>
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='moebio framework - canvas based JavaScript data visualization toolkit. '>
<meta name='keywords' content='javascript, visualization, web development, frontend, js'>
<link rel='stylesheet' href='css/bootstrap.min.css'>
<link rel='stylesheet' href='css/viewer.css'>
<link rel='stylesheet' href='css/playground.css'>
<link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700' rel='stylesheet' type='text/css'>
</head>
<body ng-controller='PlaygroundController'>

<header id='top' class='navbar navbar-default' role='navigation'>
  <div class='container'>
    <div class='navbar-header'>
      <a class='navbar-brand' href='/moebio_framework/'>Moebio Framework</a>
    </div>
  </div>
</header>

<div class='playground'>
  <div class='container'>
    <span id='stats'>{{stats}}</span>
  </div>
</div>

<div class='playgroundBody'>
  <div class='notEnoughSpace'>
    <div class='container'>
      <h1>Playground does not make too much sense when horizontal resolution is below 300px</h1>
    </div>
  </div>
  <div class='content'>
    <div id='editor'></div>
    <iframe id='moebio_out' src="base.html"></iframe>
  </div>
</div>


<script type="text/javascript" charset="utf-8">
function PlaygroundController($scope, $http, $location) {
  $scope.examples = [];

  var editor = ace.edit('editor');
  editor.$blockScrolling = Infinity;
  setupEditor(editor);

  var name = $location.path().slice(1);
  if (name === "") {
    name = "cube"
  }

  $('#moebio_out').load(activate(name));



  var timer;

function setupEditor() {
  var lastGen, lastChanged;

  editor.setTheme('ace/theme/monokai');
  editor.getSession().setMode('ace/mode/javascript');

  editor.getSession().on('change', function(e) {
      if (timer) {
      clearTimeout(timer);
      }
      lastChanged = new Date();

      localStorage.moebioLastBuild = editor.getSession().getValue();

      timer = setTimeout(function() {
        if (!lastGen || lastGen < lastChanged) {
        generate();
        };
      }, 300);
  });

  function generate() {
    var session = "document.getElementById('maindiv').innerHTML = '';"
    session = session + editor.getSession().getValue();
    // hack to re-run init
    session += "window.onload();";
    var iframe = document.getElementById('moebio_out');
    // iframe.src = iframe.src;
    iframe.contentWindow.eval(session);

  };

}
  function activate(exampleName) {
    console.log('loading ' + exampleName);

    $http.get('../' + exampleName + '/' + exampleName + '.js').success(function(data) {
      editor.getSession().setValue(data);
      });
  };
};
</script>

<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js'></script>
<script src='js/bootstrap.min.js'></script>
<script src='//cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.10/angular.min.js'></script>
<script src='//cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.10/angular-route.min.js'></script>
<script type='text/javascript' src='js/app.js'></script>

<script type="text/javascript" charset="utf-8" src='js/ace/ace.js'></script>
</body>
</html>
