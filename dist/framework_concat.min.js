function ObjectOperators(){}function DateListOperators(){}function DateOperators(){}function CountryListOperators(){}function CountryOperators(){}function GeoOperators(){}function GeometryConvertions(){}function GeometryOperators(){}function Triangle(a,b,c){this.a=a,this.b=b,this.c=c;var d,e,f,g,h=b.x-a.x,i=b.y-a.y,j=c.x-a.x,k=c.y-a.y,l=h*(a.x+b.x)+i*(a.y+b.y),m=j*(a.x+c.x)+k*(a.y+c.y),n=2*(h*(c.y-b.y)-i*(c.x-b.x));Math.abs(n)<1e-6?(d=Math.min(a.x,b.x,c.x),e=Math.min(a.y,b.y,c.y),f=.5*(Math.max(a.x,b.x,c.x)-d),g=.5*(Math.max(a.y,b.y,c.y)-e),this.x=d+f,this.y=e+g,this.r=f*f+g*g):(this.x=(k*l-i*m)/n,this.y=(h*m-j*l)/n,f=this.x-a.x,g=this.y-a.y,this.r=f*f+g*g)}function byX(a,b){return b.x-a.x}function dedup(a){var b,c,d,e,f,g=a.length;a:for(;g;)for(c=a[--g],b=a[--g],d=g;d;)if(f=a[--d],e=a[--d],b===e&&c===f||b===f&&c===e){a.splice(g,2),a.splice(d,2),g-=2;continue a}}function _triangulate(a){if(a.length<3)return[];a.sort(byX);for(var b=a.length-1,c=a[b].x,d=a[0].x,e=a[b].y,f=e;b--;)a[b].y<e&&(e=a[b].y),a[b].y>f&&(f=a[b].y);var g,h,i,j=d-c,k=f-e,l=j>k?j:k,m=.5*(d+c),n=.5*(f+e),o=[new Triangle({x:m-20*l,y:n-l,__sentinel:!0},{x:m,y:n+20*l,__sentinel:!0},{x:m+20*l,y:n-l,__sentinel:!0})],p=[],q=[];for(b=a.length;b--;){for(q.length=0,g=o.length;g--;)j=a[b].x-o[g].x,j>0&&j*j>o[g].r?(p.push(o[g]),o.splice(g,1)):(k=a[b].y-o[g].y,j*j+k*k>o[g].r||(q.push(o[g].a,o[g].b,o[g].b,o[g].c,o[g].c,o[g].a),o.splice(g,1)));for(dedup(q),g=q.length;g;)i=q[--g],h=q[--g],o.push(new Triangle(h,i,a[b]))}for(Array.prototype.push.apply(p,o),b=p.length;b--;)(p[b].a.__sentinel||p[b].b.__sentinel||p[b].c.__sentinel)&&p.splice(b,1);return p}function PointOperators(){}function PolygonGenerators(){}function PolygonListEncodings(){}function PolygonListOperators(){}function PolygonOperators(){}function RectangleOperators(){}function ColorOperators(){}function ColorGenerators(){}function ColorListGenerators(){}function ColorListOperators(){}function ColorOperators(){}function ColorScales(){}function ColorScaleGenerators(){}function ListGenerators(){}function ListOperators(){}function TableConversions(){}function TableEncodings(){}function TableGenerators(){}function TableOperators(){}function StringConversions(){}function StringListOperators(){}function StringOperators(){}function CanvasAndContext(){}function Draw(){}function DrawSimpleVis(){}function DrawTexts(){}function DrawTextsAdvanced(){}function DragDetection(a){this.mode=a.mode||0,this.listenerFunction=a.listenerFunction,this.target=a.target,this.areaVerificationFunction=a.areaVerificationFunction,this.factor=null==a.factor?1:a.factor,this.center=new Point(0,0),addInteractionEventListener("mousedown",this.onMouse,this),addInteractionEventListener("mouseup",this.onMouse,this),this.dragging=!1,this.mouseClickPosition=new Point,this.mousePosition=new Point,this.r=0,this.a=0,this.idInterval=null,this.dragVector=new Point}function InputTextFieldHTML(a){this.id=null==a.id?0:a.id,this.target=a.target,this.x=null==a.x?0:a.x,this.y=null==a.y?0:a.y,this.width=null==a.width?200:a.width,this.height=null==a.height?20:a.height,this.fontSize=null==a.fontSize?16:a.fontSize,this.enterFunction=a.enterFunction,this.changeFunction=a.changeFunction,this.focusFunction=a.focusFunction,this.blurFunction=a.blurFunction,this.text=a.text,this.textarea=null==a.textarea?!0:a.textarea,this.readOnly=null==a.readOnly?!1:a.readOnly,this.border=null==a.border?!0:a.border,this.password=a.password,this._prevX,this._prevY,this._prevWidth,this._prevHeight,this._prevText,this.zIndex=30,this.enterFunctionTarget,this.changeFunctionTarget,this.focusFunctionTarget,this.blurFunctionTarget,this.textColor=null==a.textColor?"black":a.textColor,this.backgroundColor="#FFFFFF",this.main=document.getElementById("maindiv"),this.div=document.createElement("div2"),this.textarea?this.DOMtext=document.createElement("textarea"):this.DOMtext=document.createElement("input"),this.password?this.DOMtext.setAttribute("type","password"):this.DOMtext.setAttribute("type","text"),this.div.setAttribute("style","position:absolute;top:"+this.y+"px;left:"+this.x+"px;z-index:"+this.zIndex+";"),this.border||this.DOMtext.setAttribute("style","border:none"),this.div.setAttribute("rows","1"),this.main.appendChild(this.div),this.div.appendChild(this.DOMtext),this.DOMtext.parent=this,this.added=!0,this.DOMtext.readOnly=this.readOnly,this.DOMtext.onfocus=function(a){a.target=this.parent,this.parent._onFocus(this.parent)},this.DOMtext.onblur=function(a){a.target=this.parent,this.parent._onBlur(this.parent)},this.DOMtext.value="",addInteractionEventListener("keydown",this.onKeyDown,this),this._eKeyDown,this.timer,this.focus=!1,null!=this.changeFunction&&this.setChangeFunction(this.changeFunction,this.target),null!=this.enterFunction&&this.setEnterFunction(this.enterFunction,this.target),null!=this.focusFunction&&this.setFocusFunction(this.focusFunction,this.target),null!=this.blurFunction&&this.setBlurFunction(this.blurFunction,this.target),null!=this.text?this.setText(this.text):this.draw(),this.DOMtext.addEventListener("mousemove",_onMouse,!1),_cycleOnMouseMovement&&this.DOMtext.addEventListener("mousemove",onMoveCycle,!1)}function TextBox(a){a=null==a?{}:a,this.x=null==a.x?300:a.x,this.y=null==a.y?2:a.y,this.width=null==a.width?200:a.width,this.text=null==a.text?"":a.text,this.fontColor=null==a.fontColor?"black":a.fontColor,this.fontSize=null==a.fontSize?"14":a.fontSize,this.fontName=null==a.fontName?LOADED_FONT:a.fontName,this.warnFunction=a.warnFunction,this.target=a.target,this.lineHeight=null==a.lineHeight?14:a.lineHeight,this.backgroundColor=a.backgroundColor,this.boxMargin=null==a.boxMargin?5:a.boxMargin,this.lineWidth=null==a.lineWidth?1:a.lineWidth,this.maxWidth,this.links,this.linksType,this.pointPairs,this.overLink,this.setText(this.text),addInteractionEventListener("mouseup",this.mouseUp,this)}function TextFieldHTML(a){a=null==a?{}:a,this.x=null==a.x?300:a.x,this.y=null==a.y?2:a.y,this.width=null==a.width?200:a.width,this.textColor=null==a.textColor?"black":a.textColor,this.backgroundColor=a.backgroundColor,this.linkFunction=a.linkFunction,this.target=a.target,this.fastHTMLactive=null==a.fastHTMLactive?!0:a.fastHTMLactive,this.text,this._prevX,this._prevY,this._prevWidth,this._prevHeight,this.zIndex=33,this.main=document.getElementById("maindiv"),this.div=document.createElement("div2"),this.div.setAttribute("style","position:absolute;top:"+this.y+"px;left:"+this.x+"px;z-index:"+this.zIndex+";"),this.main.appendChild(this.div),this.setText(null==a.text?"":a.text),this.draw();this.linkFunction,this.target;null!=this.target&&null!=this.linkFunction&&(FastHtml.target=this.target,FastHtml.linkFunction=this.linkFunction)}function Loader(){}function LoaderRequest(a,b,c){this.url=a,this.method=b?b:"GET",this.data=c}function LoadEvent(){Object.apply(this),this.result=null,this.errorType=0,this.errorMessage="",this.url}function MultiLoader(){this.urlList=null,this.onComplete=null,this.iLoaded=0,this.target=null,this.loading=!1,this.indexLoading,this.datasLoaded=null,this.imagesLoaded=null,this.priorityWeights,this.associativeArray=[],this.url_to_image={},this.simulateDelay=!1,this.DELAY_MILLISECONDS=1e3,this.timer}function Forces(a){this.k=a.k?a.k:.01,this.dEqSprings=a.dEqSprings?a.dEqSprings:100,this.dEqRepulsors=a.dEqRepulsors?a.dEqRepulsors:500,this.friction=a.friction?a.friction:.8,this.nodeList=new NodeList,this.forcesList=new List,this.equilibriumDistances=new NumberList,this.forcesTypeList=new List,this.fromNodeList=new NodeList,this.toNodeList=new NodeList,this._i0=0}function Engine3D(a){a=null==a?{}:a,this.lens=null==a.lens?300:a.lens,this._freeRotation=!1,this.setBasis(new Polygon3D(new Point3D(1,0,0),new Point3D(0,1,0),new Point3D(0,0,1))),this._cuttingPlane=10,null!=a.angles&&this.setAngles(a.angles)}function typeOf(a){var b=typeof a;if("object"!==b)return b;if(null===a)return"null";if(null!=a.getDate)return"date";if(null==a.getType)return"Object";var c=a.getType();return c}function VOID(){}function instantiate(a,b){switch(a){case"number":case"string":return window[a](b);case"date":if(!b||0==b.length)return new Date;if(1==b.length){if(b[0].match(/\d*.-\d*.-\d*\D\d*.:\d*.:\d*/)){var c=b[0].split(" ");return c[0]=c[0].split("-"),c[1]?c[1]=c[1].split(":"):c[1]=new Array(0,0,0),new Date(Date.UTC(c[0][0],Number(c[0][1])-1,c[0][2],c[1][0],c[1][1],c[1][2]))}return"NaN"!=Number(b[0])?new Date(Number(b[0])):new Date(b[0])}return new Date(Date.UTC.apply(null,b));case"boolean":return window[a]("false"==b||"0"==b?!1:!0);case"List":case"Table":case"StringList":case"NumberList":case"NumberTable":case"NodeList":case"RelationList":case"Polygon":case"Polygon3D":case"PolygonList":case"DateList":case"ColorList":return window[a].apply(window,b);case null:case void 0:case"undefined":return null}var d,e,f;return f=window[a],e=function(){},e.prototype=f.prototype,d=new e,f.apply(d,b),d}function instantiateWithSameType(a,b){return instantiate(typeOf(a),b)}function isArray(a){return-1==a.constructor.toString().indexOf("Array")?!1:!0}function argumentsToArray(a){return Array.prototype.slice.call(a,0)}function TimeLogger(a){var b=this;this.name=a,this.clocks={},this.tic=function(a){b.clocks[a]=(new Date).getTime()},this.tac=function(a){if(null==b.clocks[a])b.tic(a);else{var d=(new Date).getTime(),e=d-b.clocks[a];c.l("TimeLogger '"+a+"' took "+e+" ms")}}}function ConsoleTools(){}function FastHtml(){}function JSONUtils(){}function MD5(){}function StringUtils(){}function Navigator(){}function CountryListDraw(){}function CirclesVisOperators(){}function ColorsDraw(){}function ImageDraw(){}function ListDraw(){}function IntervalTableDraw(){}function NumberTableDraw(){}function ObjectDraw(){}function StringDraw(){}function StringListDraw(){}function StringListVisOperators(){}function NetworkDraw(){}function TreeDraw(){}function Global(){}function _onMouse(a){switch(a.type){case"mousemove":PREV_mX=mX,PREV_mY=mY,a.clientX?(mX=a.clientX,mY=a.clientY):a.offsetX?(mX=a.offsetX,mY=a.offsetY):a.layerX&&(mX=a.layerX,mY=a.layerY),mP.x=mX,mP.y=mY,MOUSE_IN_DOCUMENT=!0;break;case"mousedown":NF_DOWN=nF,MOUSE_PRESSED=!0,T_MOUSE_PRESSED=0,_tLastMouseDown=(new Date).getTime(),mX_DOWN=mX,mY_DOWN=mY,MOUSE_IN_DOCUMENT=!0;break;case"mouseup":NF_UP=nF,MOUSE_PRESSED=!1,T_MOUSE_PRESSED=0,mX_UP=mX,mY_UP=mY,MOUSE_IN_DOCUMENT=!0;break;case"mouseenter":MOUSE_IN_DOCUMENT=!0;break;case"mouseleave":MOUSE_IN_DOCUMENT=!1}}function onResize(a){_adjustCanvas(),resizeWindow()}function _adjustCanvas(){0!=canvasResizeable&&(cW=getDocWidth(),cH=getDocHeight(),canvas.setAttribute("width",cW),canvas.setAttribute("height",cH),cX=Math.floor(.5*cW),cY=Math.floor(.5*cH))}function clearContext(){context.clearRect(0,0,cW,cH)}function cycleOnMouseMovement(a,b){null!=b&&(END_CYCLE_DELAY=b),a?(context.canvas.addEventListener("mousemove",onMoveCycle,!1),addInteractionEventListener("mousewheel",onMoveCycle,this),_cycleOnMouseMovement=!0,stopCycle()):(context.canvas.removeEventListener("mousemove",onMoveCycle,!1),removeInteractionEventListener("mousewheel",onMoveCycle,this),_cycleOnMouseMovement=!1,startCycle())}function setFrameRate(a){a=a||30,Global._frameRate=a,cycleActive&&startCycle()}function enterFrame(){0==_alphaRefresh?context.clearRect(0,0,cW,cH):(context.fillStyle="rgba("+backGroundColorRGB[0]+","+backGroundColorRGB[1]+","+backGroundColorRGB[2]+","+_alphaRefresh+")",context.fillRect(0,0,cW,cH)),setCursor("default"),MOUSE_DOWN=NF_DOWN==nF,MOUSE_UP=NF_UP==nF,MOUSE_UP_FAST=MOUSE_UP&&9>nF-NF_DOWN,DX_MOUSE=mX-PREV_mX,DY_MOUSE=mY-PREV_mY,MOUSE_MOVED=0!=DX_MOUSE||0!=DY_MOUSE,MOUSE_PRESSED&&(T_MOUSE_PRESSED=(new Date).getTime()-_tLastMouseDown),cycle(),WHEEL_CHANGE=0,PREV_mX=mX,PREV_mY=mY,nF++}function startCycle(){clearTimeout(_setTimeOutId),clearInterval(_setIntervalId),_setIntervalId=setInterval(enterFrame,Global._frameRate),cycleActive=!0}function stopCycle(){clearInterval(_setIntervalId),cycleActive=!1,lastCycle()}function onMoveCycle(a){("mousemove"!=a.type||_prevMouseX!=mX||_prevMouseY!=mY)&&reStartCycle()}function reStartCycle(){_prevMouseX=mX,_prevMouseY=mY,cycleActive||(_setIntervalId=setInterval(enterFrame,Global._frameRate),cycleActive=!0),clearTimeout(_setTimeOutId),_setTimeOutId=setTimeout(stopCycle,END_CYCLE_DELAY)}function addInteractionEventListener(a,b,c){switch(listenerArray.push(new Array(a,b,c)),a){case"mousedown":case"mouseup":case"click":case"mousemove":context.canvas.addEventListener(a,onCanvasEvent,!1);break;case"mousewheel":_wheelActivated||activateWheel();break;case"keydown":case"keyup":_keyboardActivated||activateKeyboard()}}function onCanvasEvent(a){var b;for(b=0;null!=listenerArray[b];b++)if(listenerArray[b][0]==a.type.replace("DOMMouseScroll","mousewheel")){if(_interactionCancelledFrame==nF)return;listenerArray[b][1].call(listenerArray[b][2],a)}}function removeInteractionEventListener(a,b,c){for(var d=0;null!=listenerArray[d];d++)listenerArray[d][0]==a&&listenerArray[d][1]==b&&listenerArray[d][2]==c&&(delete listenerArray[d],listenerArray.splice(d,1),d--)}function cancelAllInteractions(){c.log("cancelAllInteractions, _interactionCancelledFrame:",nF),_interactionCancelledFrame=nF}function setBackgroundColor(a){"number"==typeof a?a=arguments.length>3?"rgba("+arguments[0]+","+arguments[1]+","+arguments[2]+","+arguments[3]+")":"rgb("+arguments[0]+","+arguments[1]+","+arguments[2]+")":Array.isArray(a)&&(a=ColorOperators.RGBtoHEX(a[0],a[1],a[2])),backGroundColor=a,backGroundColorRGB=ColorOperators.colorStringToRGB(backGroundColor);var b=document.getElementById("index");b.setAttribute("bgcolor",backGroundColor)}function setDivPosition(a,b,c){a.setAttribute("style","position:absolute;left:"+String(b)+"px;top:"+String(c)+"px;")}function activateKeyboard(){_keyboardActivated=!0,document.onkeydown=onKey,document.onkeyup=onKey}function onKey(a){onCanvasEvent(a)}function activateWheel(){_wheelActivated=!0,window.addEventListener&&window.addEventListener("DOMMouseScroll",_onWheel,!1),window.onmousewheel=document.onmousewheel=_onWheel}function _onWheel(a){a||(a=window.event),a.wheelDelta?WHEEL_CHANGE=a.wheelDelta/120:a.detail&&(WHEEL_CHANGE=-a.detail/3),a.value=WHEEL_CHANGE,a.type="mousewheel",onCanvasEvent(a)}function getDocWidth(){var a=document;return Math.max(a.body.offsetWidth,a.documentElement.offsetWidth,a.body.clientWidth,a.documentElement.clientWidth)}function getDocHeight(){var a=document;return Math.max(a.body.offsetHeight,a.documentElement.offsetHeight,a.body.clientHeight,a.documentElement.clientHeight)}ObjectOperators.identity=function(a){return a},ObjectOperators.getReport=function(a){if(null==a)return null;if(a.getReport)return a.getReport();var b="///////////report of instance of Object//////////",c=ObjectConversions.objectToString(a);if(c.length<2e3)return b+="\n"+c;var d=new StringList;new StringList,new StringList;for(propName in a)d.push(propName);return b+=d.length<100?"\nproperties: "+d.join(", "):"\nfirst 100 properties: "+d.slice(0,100).join(", ")},ObjectOperators.booleanGate=function(a,b,c){return a?b:c},ObjectOperators.getPropertyValue=function(a,b){return null!=a?null==a?null:a[b]:void 0},ObjectOperators.getPropertiesNames=function(a){return null!=a?StringList.fromArray(Object.getOwnPropertyNames(a)):void 0},ObjectOperators.getPropertiesNamesAndValues=function(a){if(null!=a){var b=new Table;return b[0]=ObjectOperators.getPropertiesNames(a),b[1]=new List,b[0].forEach(function(c,d){b[1][d]=a[c]}),b[1]=b[1].getImproved(),b}},ObjectOperators.interpolateObjects=function(a,b,c,d){var e,f=typeOf(a);if(f!=typeOf(b))return a;c=null==c?.5:c;var g=1-c;switch(f){case"number":return d&&Math.abs(a-b)<=d?a:g*a+c*b;case"Interval":return d&&Math.abs(a.x-b.x)+Math.abs(a.y-b.y)<=d?a:new Interval(g*a.x+c*b.x,g*a.y+c*b.y);case"NumberList":if(d&&Math.abs(a.subtract(b).getSum())<=d)return a;var h=Math.min(a.length,b.length),i=new NumberList;for(e=0;h>e;e++)i[e]=g*a[e]+c*b[e];return i}return null},ObjectOperators.replaceObject=function(a,b,c){return a==b?c:a},ObjectOperators.toList=function(a){return List.fromArray(a).getImproved()},ObjectOperators.addition=function(){var a,b;if(arguments.length<2){if(1==arguments.length&&null!=arguments[0]&&arguments[0].isList){var a=arguments[0][0];for(b=1;null!=arguments[0][b];b++)a=ObjectOperators.addition(a,arguments[0][b]);return a}return null}if(2==arguments.length){if(null!=arguments[0]&&arguments[0].isList&&null!=arguments[1]&&arguments[1].isList)return ObjectOperators._applyBinaryOperatorOnLists(arguments[0],arguments[1],ObjectOperators.addition);if(null!=arguments[0]&&arguments[0].isList)return ObjectOperators._applyBinaryOperatorOnListWithObject(arguments[0],arguments[1],ObjectOperators.addition);if(null!=arguments[1]&&arguments[1].isList)return ObjectOperators._applyBinaryOperatorOnObjectWithList(arguments[0],arguments[1],ObjectOperators.addition);var d=arguments[0],e=arguments[1],f=typeOf(d),g=typeOf(e),h=!1;f>g&&"string"!=g&&"string"!=f&&(d=arguments[1],e=arguments[0],f=typeOf(d),g=typeOf(e),h=!0);var i=f+"_"+g;switch(i){case"boolean_boolean":return d&&e;case"date_string":return h?e+DateOperators.dateToString(d):DateOperators.dateToString(d)+e;case"number_string":case"string_string":case"string_number":case"boolean_number":case"number_number":return d+e;case"Point_Point":return new Point(d.x+e.x,d.y+e.y);case"Point3D_Point3D":return new Point3D(d.x+e.x,d.y+e.y,d.z+e.z);case"number_Point":return new Point(d.x+e,d.y+e);case"number_Point3D":return new Point3D(d.x+e,d.y+e,d.z+e);case"Interval_number":return new Interval(d.x+e,d.y+e);case"Interval_Point":return new Point(d.getMin()+e.x,d.getMax()+e.y);case"Interval_Interval":return new Point(d.getMin()+e.getMin(),d.getMax()+e.getMax());case"Point_Rectangle":return new Rectangle(d.x+e.x,d.y+e.y,e.width,e.height);case"Interval_Rectangle":return new Rectangle(d.getMin()+e.x,d.getMax()+e.y,e.width,e.height);case"Rectangle_Rectangle":return new Rectangle(d.x+e.x,d.y+e.y,d.width+e.width,d.height+e.height);case"date_number":return new Date(d.getTime()+e/DateOperators.millisecondsToDays);case"date_date":return new Date(Number(d.getTime()+e.getTime()));case"date_DateInterval":return new DateInterval(ObjectOperators.addition(d,e.date0),ObjectOperators.addition(d,e.date1));case"DateInterval_number":return new DateInterval(ObjectOperators.addition(d.date0,e),ObjectOperators.addition(d.date1,e));case"DateInterval_Interval":return new DateInterval(ObjectOperators.addition(d.date0,e.min),ObjectOperators.addition(d.date1,e.max));case"DateInterval_DateInterval":return new DateInterval(ObjectOperators.addition(d.date0,e.date0),ObjectOperators.addition(d.date1,e.date1));case"string_StringList":return e.append(d,!1);case"StringList_string":return e.append(d,!0);default:return c.log("[!] addition didn't manage to resolve:",i,d+e),null}return d+e}for(a=arguments[0],b=1;b<arguments.length;b++)a=ObjectOperators.addition(a,arguments[b]);return a},ObjectOperators.multiplication=function(){var a,b;if(arguments.length<2){if(1==arguments.length&&arguments[0].isList){var a=arguments[0][0];for(b=1;null!=arguments[0][b];b++)a=ObjectOperators.multiplication(a,arguments[0][b]);return a}return null}if(2==arguments.length){if(null==arguments[0])return null;if(arguments[0].isList&&arguments[1].isList)return ObjectOperators._applyBinaryOperatorOnLists(arguments[0],arguments[1],ObjectOperators.multiplication);if(arguments[0].isList)return ObjectOperators._applyBinaryOperatorOnListWithObject(arguments[0],arguments[1],ObjectOperators.multiplication);if(arguments[1].isList)return ObjectOperators._applyBinaryOperatorOnListWithObject(arguments[1],arguments[0],ObjectOperators.multiplication);var d=arguments[0],e=arguments[1],f=typeOf(d),g=typeOf(e);f>g&&(d=arguments[1],e=arguments[0],f=typeOf(d),g=typeOf(e));var h=f+"_"+g;switch(h){case"number_number":case"boolean_boolean":case"boolean_number":case"Date_string":case"number_string":case"string_string":return d*e;case"Point_Point":return new Point(d.x*e.x,d.y*e.y);case"Point3D_Point3D":return new Point3D(d.x*e.x,d.y*e.y,d.z*e.z);case"number_Point":return new Point(d.x*e,d.y*e);case"number_Point3D":return new Point3D(d.x*e,d.y*e,d.z*e);case"Interval_number":return new Interval(d.getMin()*e,d.getMax()*e);case"Interval_Point":return new Point(d.getMin()*e.x,d.getMax()*e.y);case"Interval_Interval":return new Point(d.getMin()+e.getMin(),d.getMax()+e.getMax());case"Point_Rectangle":return new Rectangle(d.x*e.x,d.y*e.y,e.width,e.height);case"Interval_Rectangle":return new Rectangle(d.getMin()*e.x,d.getMax()*e.y,e.width,e.height);case"Rectangle_Rectangle":return new Rectangle(d.x*e.x,d.y*e.y,d.width*e.width,d.height*e.height);case"date_number":return new Date(d.getTime()*(e/DateOperators.millisecondsToDays));case"date_date":return new Date(Number(d.getTime()+e.getTime()));case"date_DateInterval":return new DateInterval(ObjectOperators.multiplication(d,e.date0),ObjectOperators.multiplication(d,e.date1));case"DateInterval_number":return new DateInterval(ObjectOperators.multiplication(d.date0,e),ObjectOperators.multiplication(d.date1,e));case"DateInterval_Interval":return new DateInterval(ObjectOperators.multiplication(d.date0,e.min),ObjectOperators.multiplication(d.date1,e.max));case"DateInterval_DateInterval":return new DateInterval(ObjectOperators.multiplication(d.date0,e.date0),ObjectOperators.multiplication(d.date1,e.date1));default:return c.log("[!] multiplication didn't manage to resolve:",h,d*e),null}return d*e}for(a=arguments[0],b=1;b<arguments.length;b++)a=ObjectOperators.multiplication(a,arguments[b]);return a},ObjectOperators.division=function(){var a,b;if(arguments.length<2){if(1==arguments.length&&arguments[0]&&arguments[0].isList){var a=arguments[0][0];for(b=1;null!=arguments[0][b];b++)a=ObjectOperators.division(a,arguments[0][b]);return a}return null}if(2==arguments.length){if(null!=arguments[0]&&arguments[0].isList&&null!=arguments[1]&&arguments[1].isList)return ObjectOperators._applyBinaryOperatorOnLists(arguments[0],arguments[1],ObjectOperators.division);if(null!=arguments[0]&&arguments[0].isList)return ObjectOperators._applyBinaryOperatorOnListWithObject(arguments[0],arguments[1],ObjectOperators.division);if(null!=arguments[1]&&arguments[1].isList)return ObjectOperators._applyBinaryOperatorOnListWithObject(arguments[1],arguments[0],ObjectOperators.division);var d=arguments[0],e=arguments[1],f=typeOf(d),g=typeOf(e);f>g&&(d=arguments[1],e=arguments[0],f=typeOf(d),g=typeOf(e));var h=f+"_"+g;switch(h){case"number_number":case"boolean_boolean":case"boolean_number":case"Date_string":case"number_string":case"string_string":return d/e;case"Point_Point":return new Point(d.x/e.x,d.y/e.y);case"Point3D_Point3D":return new Point3D(d.x/e.x,d.y/e.y,d.z/e.z);case"number_Point":return new Point(d.x/e,d.y/e);case"number_Point3D":return new Point3D(d.x/e,d.y/e,d.z/e);case"Interval_number":return new Interval(d.getMin()/e,d.getMax()/e);case"Interval_Point":return new Point(d.getMin()/e.x,d.getMax()/e.y);case"Interval_Interval":return new Point(d.getMin()+e.getMin(),d.getMax()+e.getMax());case"Point_Rectangle":return new Rectangle(d.x/e.x,d.y/e.y,e.width,e.height);case"Interval_Rectangle":return new Rectangle(d.getMin()/e.x,d.getMax()/e.y,e.width,e.height);case"Rectangle_Rectangle":return new Rectangle(d.x/e.x,d.y/e.y,d.width/e.width,d.height/e.height);case"date_number":return new Date(d.getTime()/(e/DateOperators.millisecondsToDays));case"date_date":return new Date(Number(d.getTime()+e.getTime()));case"date_DateInterval":return new DateInterval(ObjectOperators.division(d,e.date0),ObjectOperators.division(d,e.date1));case"DateInterval_number":return new DateInterval(ObjectOperators.division(d.date0,e),ObjectOperators.division(d.date1,e));case"DateInterval_Interval":return new DateInterval(ObjectOperators.division(d.date0,e.min),ObjectOperators.division(d.date1,e.max));case"DateInterval_DateInterval":return new DateInterval(ObjectOperators.division(d.date0,e.date0),ObjectOperators.division(d.date1,e.date1));default:return c.log("[!] division didn't manage to resolve:",h,d/e),null}return d/e}for(a=arguments[0],b=1;b<arguments.length;b++)a=ObjectOperators.division(a,arguments[b]);return a},ObjectOperators._applyBinaryOperatorOnLists=function(a,b,c){var d,e=Math.min(a.length,b.length),f=new List;for(d=0;e>d;d++)f.push(ObjectOperators._applyBinaryOperator(a[d],b[d],c));return f.getImproved()},ObjectOperators._applyBinaryOperatorOnListWithObject=function(a,b,c){var d,e=new List;for(d=0;d<a.length;d++)e.push(ObjectOperators._applyBinaryOperator(a[d],b,c));return e.getImproved()},ObjectOperators._applyBinaryOperatorOnObjectWithList=function(a,b,c){var d,e=new List;for(d=0;d<b.length;d++)e.push(ObjectOperators._applyBinaryOperator(a,b[d],c));return e.getImproved()},ObjectOperators._applyBinaryOperator=function(a,b,c){return c(a,b)},ObjectConversions=function(){},ObjectConversions.conversor=function(a,b){var d,e,f=typeOf(a),g=f+"_"+b;switch(c.log("ObjectConversions.conversor, pairType:",g),g){case"NumberTable_Polygon":var h=new Polygon,i=a.length>1;for(d=0;null!=a[0][d];d++)h[d]=new Point(a[0][d],i?a[1][d]:0);return h;case"date_string":return DateOperators.dateToString(a);case"string_date":return DateOperators.stringToDate(a);case"date_number":return a.getTime();case"number_date":return new Date(a);case"List_StringList":case"NumberList_StringList":return a.toStringList();case"StringList_NumberList":return a.toNumberList();case"Object_string":return JSON.stringify(a,null,"	");case"string_Object":return JSON.parse(a);case"string_ColorScale":return ColorScales[a];case"string_Table":return TableEncodings.CSVtoTable(a);case"StringList_DateList":return e=new DateList,a.forEach(function(a){e.push(DateOperators.stringToDate(a))}),e.name=a.name,e;case"DateList_NumberList":return a.getTimes();case"Table_Network":return NetworkConvertions.TableToNetwork(a,null,0,!1)}switch(b){case"string":return a.toString();case"number":return Number(a)}},DateListOperators.buildTimeTreeFromDates=function(a){if(null!=a){var b,c,d=new Tree,e=a[0],f=a[0];a.forEach(function(a){e=e>a?a:e,f=a>f?a:f}),b=e.getFullYear(),c=e.getFullYear();var g=new Node("years","years");d.addNodeToTree(g),g.dates=a.clone();var h,i,j,k,l,m,n,o,p,q;for(h=b;c>=h;h++)m=new Node(String(h),String(h)),d.addNodeToTree(m,g);return a.forEach(function(a){if(h=DateListOperators._y(a),m=g.toNodeList[h-b],null==m.dates)for(m.dates=new DateList,i=0;12>i;i++)n=new Node(DateOperators.MONTH_NAMES[i]+"_"+h,DateOperators.MONTH_NAMES[i]),d.addNodeToTree(n,m),nDaysOnMonth=DateOperators.getNDaysInMonth(h,i+1);if(m.dates.push(a),i=DateListOperators._m(a),n=m.toNodeList[i],null==n.dates)for(n.dates=new DateList,j=0;j<nDaysOnMonth;j++)o=new Node(j+1+"_"+n.id,String(j+1)),d.addNodeToTree(o,n);if(n.dates.push(a),j=DateListOperators._d(a),o=n.toNodeList[j],null==o.dates)for(o.dates=new DateList,k=0;24>k;k++)p=new Node(k+"_"+o.id,String(k)+":00"),d.addNodeToTree(p,o);if(o.dates.push(a),k=DateListOperators._h(a),p=o.toNodeList[k],null==p.dates)for(p.dates=new DateList,l=0;60>l;l++)q=new Node(l+"_"+p.id,String(l)),d.addNodeToTree(q,p);p.dates.push(a),l=DateListOperators._mn(a),q=p.toNodeList[l],null==q.dates&&(q.dates=new DateList),q.weight++,q.dates.push(a)}),d.assignDescentWeightsToNodes(),d}},DateListOperators._y=function(a){return a.getFullYear()},DateListOperators._m=function(a){return a.getMonth()},DateListOperators._d=function(a){return a.getDate()-1},DateListOperators._h=function(a){return a.getHours()},DateListOperators._mn=function(a){return a.getMinutes()},DateListOperators._s=function(a){return a.getSeconds()},DateListOperators._ms=function(a){return a.getMilliseconds()},DateOperators.millisecondsToHours=1/36e5,DateOperators.millisecondsToDays=1/864e5,DateOperators.millisecondsToWeeks=1/6048e5,DateOperators.millisecondsToYears=3.169e-11,DateOperators.MONTH_NAMES=["january","february","march","april","may","june","july","august","september","october","november","december"],DateOperators.MONTH_NAMES_SHORT=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],DateOperators.MONTH_NDAYS=[31,28,31,30,31,30,31,31,30,31,30,31],DateOperators.WEEK_NAMES=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],DateOperators.stringToDate=function(a,b,c){if(c=null==c?"-":c,b=null==b?1:b,1==b)return"-"!=c&&(a=a.replace(new RegExp(a,"g"),"-")),new Date(a);var d,e=a.split(c);switch(b){case 0:return new Date(Number(e[2]),Number(e[0])-1,Number(e[1]));case 1:return new Date(a);case 2:return d=Number(e[2]),d=d>=0?d+2e3:d+1900,new Date(d,Number(e[0])-1,Number(e[1]));case 3:return d=Number(e[0]),d=d>=0?d+2e3:d+1900,new Date(d,Number(e[1])-1,Number(e[2]))}},DateOperators.dateToString=function(a,b,c){c=null==c?"-":c,b=null==b?0:b;var d=a.getFullYear(),e=a.getMonth()+1,f=a.getDate();switch(b){case 0:return e+c+f+c+d;case 1:return d+c+e+c+f}},DateOperators.currentDate=function(){return new Date},DateOperators.addDaysToDate=function(a,b){return new Date(a.getTime()+b/DateOperators.millisecondsToDays)},DateOperators.addMillisecondsToDate=function(a,b){return new Date(a.getTime()+b)},DateOperators.parseDate=function(a){return new Date(Date.parse(a.replace(/\./g,"-")))},DateOperators.parseDates=function(a){var b,c=new DateList;for(b=0;null!=a[b];b++)c.push(this.parseDate(a[b]));return c},DateOperators.getHoursBetweenDates=function(a,b){return(b.getTime()-a.getTime())*DateOperators.millisecondsToHours},DateOperators.getDaysBetweenDates=function(a,b){return(b.getTime()-a.getTime())*DateOperators.millisecondsToDays},DateOperators.getWeeksBetweenDates=function(a,b){return(b.getTime()-a.getTime())*DateOperators.millisecondsToWeeks},DateOperators.getYearsBetweenDates=function(a,b){return(b.getTime()-a.getTime())*DateOperators.millisecondsToYears},DateOperators.nDayInYear=function(a){return Math.floor((a.getTime()-new Date(a.getFullYear(),0,1).getTime())*DateOperators.millisecondsToDays)},DateOperators.getDateDaysAgo=function(a){return DateOperators.addDaysToDate(new Date,-a)},DateOperators.getWeekInYear=function(a){var b=new Date(a.getFullYear(),0,1);return Math.ceil(((a-b)/864e5+b.getDay()+1)/7)},DateOperators.getNDaysInMonth=function(a,b){return new Date(b,a,0).getDate()},CountryListOperators.getCountryByName=function(a,b){for(var c=CountryOperators.getSimplifiedName(b),d=0;null!=a[d];d++)if(-1!=a[d].simplifiedNames.indexOf(c))return a[d];return null},CountryOperators.getSimplifiedName=function(a){return a.replace(/[\.\- ,\']/g,"").toLowerCase()},CountryOperators.getSimplifiedNames=function(a){for(var b,c=new StringList,d=0;null!=a[d];d++)b=this.getSimplifiedName(a[d]),""!=b&&c.pushIfUnique(b);return c},GeoOperators.EARTH_RADIUS=6371009,GeoOperators.EARTH_DIAMETER=2*GeoOperators.EARTH_RADIUS,GeoOperators.geoCoordinateToDecimal=function(a){return Math.floor(a)+1.66667*(a-Math.floor(a))},GeoOperators.geoDistance=function(a,b){var c=Math.pow(Math.sin(.5*(b.y-a.y)*gradToRad),2)+Math.cos(a.y*gradToRad)*Math.cos(b.y*gradToRad)*Math.pow(Math.sin(.5*(b.x-a.x)*gradToRad),2);return GeoOperators.EARTH_DIAMETER*Math.atan2(Math.sqrt(c),Math.sqrt(1-c))},GeoOperators.polygonLength=function(a){if(a.length<2)return 0;for(var b=GeoOperators.geoDistance(a[0],a[1]),c=2;null!=a[c];c++)b+=GeoOperators.geoDistance(a[c-1],a[c]);return b},GeometryConvertions.twoNumberListsToPolygon=function(a,b){for(var c=Math.min(a.length,b.length),d=new Polygon,e=0;c>e;e++)d[e]=new Point(a[e],b[e]);return d},GeometryConvertions.PolygonToNumberTable=function(a){if(null==a)return null;var b=new NumberTable;return b[0]=new NumberList,b[1]=new NumberList,a.forEach(function(a){b[0].push(a.x),b[1].push(a.y)}),b},GeometryOperators.getSoftenControlPoints=function(a,b,c,d){d=d||10;var e=PointOperators.angleFromTwoPoints(a,c),f=new Point(b.x-d*Math.cos(e),b.y-d*Math.sin(e)),g=new Point(b.x+d*Math.cos(e),b.y+d*Math.sin(e));return[f,g]},GeometryOperators.bezierCurvePoints=function(a,b,c,d,e,f,g,h,i){var j=1-i,k=j*a+i*c,l=j*b+i*d,m=j*c+i*e,n=j*d+i*f,o=j*e+i*g,p=j*f+i*h,q=j*k+i*m,r=j*l+i*n,s=j*m+i*o,t=j*n+i*p;return new Point(i*s+j*q,i*t+j*r);
},GeometryOperators.trueBezierCurveHeightHorizontalControlPoints=function(a,b,c,d,e,f,g){var h=b-a,g=(g-a)/h,e=(e-a)/h,f=(f-a)/h;if(null==GeometryOperators._bezierSimpleCurveTable){var i,j;for(GeometryOperators._bezierSimpleCurveTable=new NumberList,i=1;1e4>i;i++)j=GeometryOperators.bezierCurvePoints(0,0,e,0,f,1,1,1,i/1e4),GeometryOperators._bezierSimpleCurveTable[Math.floor(1e3*j.x)]=j.y;GeometryOperators._bezierSimpleCurveTable[0]=0,GeometryOperators._bezierSimpleCurveTable[1]=1}return GeometryOperators._bezierSimpleCurveTable[Math.floor(1e3*g)]*(d-c)+c},GeometryOperators.bezierCurveHeightHorizontalControlPoints=function(a,b,c,d,e){var f=Math.cos(Math.PI*(e-1)),g=f>0?1:-1;return(.5+.5*Math.pow(f*g,.6)*g)*(d-a)+a},GeometryOperators.distanceToBezierCurve=function(a,b,c,d,e,f,g,h,i,j){var k,l,m,n=.01,o=0,p=1,q=new Point(a,b),r=GeometryOperators.bezierCurvePoints(a,b,c,d,e,f,g,h,n),s=new Point(g,h),t=GeometryOperators.bezierCurvePoints(a,b,c,d,e,f,g,h,1-n),u=Math.pow(q.x-i.x,2)+Math.pow(q.y-i.y,2),v=Math.pow(r.x-i.x,2)+Math.pow(r.y-i.y,2),w=Math.pow(s.x-i.x,2)+Math.pow(s.y-i.y,2);Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2);for(k=0;10>k;k++)l=GeometryOperators.bezierCurvePoints(a,b,c,d,e,f,g,h,.5*(o+p)),m=GeometryOperators.bezierCurvePoints(a,b,c,d,e,f,g,h,.5*(o+p)+n),u=Math.pow(l.x-i.x,2)+Math.pow(l.y-i.y,2),v=Math.pow(m.x-i.x,2)+Math.pow(m.y-i.y,2),v>u?(p=.5*(o+p),s=GeometryOperators.bezierCurvePoints(a,b,c,d,e,f,g,h,p),w=Math.pow(s.x-i.x,2)+Math.pow(s.y-i.y,2)):(o=.5*(o+p),q=GeometryOperators.bezierCurvePoints(a,b,c,d,e,f,g,h,o),u=Math.pow(q.x-i.x,2)+Math.pow(q.y-i.y,2));return j?s:Math.sqrt(Math.min(u,w))},GeometryOperators.triangleContainsPoint=function(a,b,c,d){var e=(a.x-d.x)*(b.y-d.y)-(b.x-d.x)*(a.y-d.y),f=(b.x-d.x)*(c.y-d.y)-(c.x-d.x)*(b.y-d.y),g=(c.x-d.x)*(a.y-d.y)-(a.x-d.x)*(c.y-d.y);return e>0&&f>0&&g>0||e>=0&&f>=0&&g>=0},GeometryOperators.triangleArea=function(a){return Math.abs(a.a.x*(a.b.y-a.c.y)+a.b.x*(a.c.y-a.a.y)+a.c.x*(a.a.y-a.b.y))/2},GeometryOperators.lineFromTwoPoints=function(a,b){if(a.x==b.x)return new Point(1/0,a.x);var c=(b.y-a.y)/(b.x-a.x);return new Point(c,a.y-c*a.x)},GeometryOperators.distancePointToLine=function(a,b){var c,d;0==b.x?(c=1/0,d=a.x):(c=-1/b.x,d=a.y-c*a.x);var e=GeometryOperators.intersectionLines(b,new Point(c,d));return Math.sqrt(Math.pow(a.x-e.x,2)+Math.pow(a.y-e.y,2))},GeometryOperators.distancePointToSegment=function(a,b,c){var d,e,f=b.x==c.x?1/0:(c.y-b.y)/(c.x-b.x),g=f==1/0?new Point(1/0,b.x):new Point(f,b.y-f*b.x);0==g.x?(d=1/0,e=a.x):(d=-1/g.x,e=a.y-d*a.x);var h=GeometryOperators.intersectionLines(g,new Point(d,e));return h.x>=Math.min(b.x,c.x)&&h.x<=Math.max(b.x,c.x)?a.distanceToPoint(h):Math.min(a.distanceToPoint(b),a.distanceToPoint(c))},GeometryOperators.intersectionLines=function(a,b){if(a.x==b.x)return a.y==b.y?a.x==1/0?new Point(a.y,0):new Point(0,a.y):null;if(a.x==1/0)return new Point(a.y,b.x*a.y+b.y);if(b.x==1/0)return new Point(b.y,a.x*b.y+a.y);var c=(b.y-a.y)/(a.x-b.x);return new Point(c,a.x*c+a.y)},GeometryOperators.VennCircles=function(a,b,c,d,e){var f,g,h=Math.sqrt(a/Math.PI),i=Math.sqrt(b/Math.PI),j=GeometryOperators.circleDistancesFromCommonArea(h,i,c,e);if(d){var k=(j*j+Math.pow(h,2)-Math.pow(i,2))/(2*j);f=new Point3D(-k,0,h),g=new Point3D(j-k,0,i)}else f=new Point3D(.5*-j,0,h),g=new Point3D(.5*j,0,i);return 0==c&&(f.x-=.1*j,g.x+=.1*j),new Polygon3D(f,g)},GeometryOperators.circleDistancesFromCommonArea=function(a,b,c,d){d=d||.1;for(var e=Math.max(a,b)-Math.min(a,b),f=a+b,g=.5*(e+f),h=0,i=GeometryOperators.circlesCommonArea(a,b,g);Math.abs(i-c)>d&&200>h;)i>c?(e=g,g=.5*(f+g)):(f=g,g=.5*(g+e)),h++,i=GeometryOperators.circlesCommonArea(a,b,g);return g},GeometryOperators.circlesCommonArea=function(a,b,c){if(c>=a+b)return 0;if(c+Math.min(a,b)<=Math.max(a,b))return Math.PI*Math.pow(Math.min(a,b),2);var d=Math.pow(c,2),e=Math.pow(a,2),f=Math.pow(b,2);return e*Math.acos((d+e-f)/(2*c*a))+f*Math.acos((d+f-e)/(2*c*b))-.5*Math.sqrt((-c+a+b)*(c+a-b)*(c-a+b)*(c+a+b))},GeometryOperators.circlesLensAngles=function(a,b){if(b.x<a.x){var c=b.clone();b=a.clone(),a=c}if(b.x+b.z<=a.x+a.z)return null;if(a.x-a.z>=b.x-b.z)return null;var d=b.x-a.x,e=(d*d+Math.pow(a.z,2)-Math.pow(b.z,2))/(2*d),f=Math.acos(e/a.z),g=a.z*Math.sin(f),h=Math.asin(g/b.z);return a.x+e<b.x?new NumberList(-f,f,Math.PI-h,Math.PI+h):new NumberList(-f,f,h,-h)},GeometryOperators.delauney=function(a){return _triangulate(a)},PointOperators.angleBetweenVectors=function(a,b){return Math.atan2(b.y,b.x)-Math.atan2(a.y,a.x)},PointOperators.angleFromTwoPoints=function(a,b){return Math.atan2(b.y-a.y,b.x-a.x)},PointOperators.dot=function(a,b){return a.x*b.x+a.y*b.y},PointOperators.twoPointsInterpolation=function(a,b,c){return new Point((1-c)*a.x+c*b.x,(1-c)*a.y+c*b.y)},PolygonGenerators.createPolygon=function(a,b,c){var d=new Polygon;switch(b){case 0:for(var e=0;a>e;e++)d.push(new Point(c.x+c.width*Math.random(),c.y+c.height*Math.random()));break;case 1:}return d},PolygonListEncodings.StringToPolygonList=function(a,b,c){b=b||",",c=c||"/";var d,e,f=new PolygonList;pols=StringOperators.splitString(a,c);for(var g,h,i=0;null!=pols[i];i++){for(d=new Polygon,h=StringOperators.splitString(pols[i],b),g=0;null!=h[g];g+=2)e=new Point(Number(h[g]),Number(h[g+1])),d.push(e);f.push(d)}return f},PolygonListEncodings.PolygonListToString=function(a,b,c){b=b||",",c=c||"/";for(var d,e,f="",d=0;null!=a[d];d++)for(f+=0==d?"":c,e=0;null!=a[d][e];e++)f+=(0==e?"":b)+a[d][e].x+b+a[d][e].y;return f},PolygonListOperators.simplifyPolygons=function(a,b,c){for(var d,e=new PolygonList,f=0;null!=a[f];f++)d=PolygonOperators.simplifyPolygon(a[f],b),(d.length>0||!c)&&e.push(d);return e},PolygonOperators.hull=function(a,b){b=null==b?!1:b;var c,d,e=a,f=e.length,g=0,h=new Polygon;if(b)var i=new NumberList;if(e=PolygonOperators.sortOnXY(e),b){for(c=0;f>c;c++){for(;g>=2&&PolygonOperators.crossProduct3Points(h[g-2],h[g-1],e[c])<=0;)g--;h[g++]=e[c],i[g-1]=c}for(c=f-2,d=g+1;c>=0;c--){for(;g>=d&&PolygonOperators.crossProduct3Points(h[g-2],h[g-1],e[c])<=0;)g--;h[g++]=e[c],i[g-1]=c}return NumberList.fromArray(i.getSubList(new Interval(0,g-2)))}for(c=0;f>c;c++){for(;g>=2&&PolygonOperators.crossProduct3Points(h[g-2],h[g-1],e[c])<=0;)g--;h[g++]=e[c]}for(c=f-2,d=g+1;c>=0;c--){for(;g>=d&&PolygonOperators.crossProduct3Points(h[g-2],h[g-1],e[c])<=0;)g--;h[g++]=e[c]}return Polygon.fromArray(h.getSubList(new Interval(0,g-2)))},PolygonOperators.buildDendrogramFromPolygon=function(a){var b,d,e,f,g,h=new Tree,i=new NodeList,j=new Polygon;a.forEach(function(a,c){b=new Node("point_"+c,"point_"+c),b.weight=1,b.barycenter=a,b.point=a,b.polygon=new Polygon(a),h.addNode(b),j.push(b),i.push(b)}),h.nodeList=h.nodeList.getReversed();for(var k=function(a,b){var c=new Node("("+a.id+","+b.id+")","("+a.id+","+b.id+")");return c.polygon=a.polygon.concat(b.polygon),c.weight=c.polygon.length,d=a.weight+b.weight,c.barycenter=new Point((a.weight*a.barycenter.x+b.weight*b.barycenter.x)/d,(a.weight*a.barycenter.y+b.weight*b.barycenter.y)/d),h.addNode(c),h._newCreateRelation(c,a),h._newCreateRelation(c,b),c};j.length>1;)closestPair=PolygonOperators._findClosestNodes(j),f=j[closestPair[0]],g=j[closestPair[1]],e=k(f,g),e.distance=closestPair.distance,c.l("distance:",e.distance),j.splice(closestPair[0],1),j.splice(closestPair[1]-1,1),j.push(e);h.nodeList=h.nodeList.getReversed();var l=function(a,b){a.level=b+1,a.toNodeList.forEach(function(b){l(b,a.level)})};return l(h.nodeList[0],-1),h.leaves=i,h},PolygonOperators._findClosestNodes=function(a){var b,c,d,e=9999999999;for(b=0;null!=a[b+1];b++)for(c=b+1;null!=a[c];c++)d=Math.pow(a[b].barycenter.x-a[c].barycenter.x,2)+Math.pow(a[b].barycenter.y-a[c].barycenter.y,2),e>d&&(e=d,pair=[b,c]);return pair.distance=e,pair},PolygonOperators.sortOnXY=function(a){return a.sort(function(a,b){return a.x<b.x?-1:a.x==b.x&&a.y<b.y?-1:1})},PolygonOperators.crossProduct3Points=function(a,b,c){return(b.x-a.x)*(c.y-a.y)-(b.y-a.y)*(c.x-a.x)},PolygonOperators.expandFromBarycenter=function(a,b){for(var c=new Polygon,d=a.getBarycenter(),e=0;null!=a[e];e++)c[e]=a[e].expandFromPoint(d,b);return c},PolygonOperators.expandInAngles=function(a,b){for(var c,d,e,f=new Polygon,g=a[a.length-1],h=a[0],i=a[1],j=.5*Math.atan2(h.y-i.y,h.x-i.x)+.5*Math.atan2(h.y-g.y,h.x-g.x),k=a.containsPoint(new Point(h.x+Math.floor(b)*Math.cos(j),h.y+Math.floor(b)*Math.sin(j)))?-1:1,l=0;null!=a[l];l++)g=a[(l-1+a.length)%a.length],h=a[l],i=a[(l+1)%a.length],c=Math.atan2(h.y-i.y,h.x-i.x),d=Math.atan2(h.y-g.y,h.x-g.x),e=Math.abs(d-c)<Math.PI?-1:1,j=.5*c+.5*d,f[l]=new Point(h.x+k*e*b*Math.cos(j),h.y+k*e*b*Math.sin(j));return f},PolygonOperators.simplifyPolygon=function(a,b){b=null==b||0==b?1:b;var c,d,e,f,g,h=a.clone(),i=a.length;for(g=0;i>g;g++)c=h[g],d=h[(g+1)%i],e=h[(g+2)%i],f=GeometryOperators.lineFromTwoPoints(c,e),GeometryOperators.distancePointToLine(d,f)<b&&(h=h.getWithoutElementAtIndex((g+1)%i),g--),i=h.length;return h},PolygonOperators.bezierPolygonContainsPoint=function(a,b,c){var d=a.getFrame();clearContext(),context.fillStyle="black",context.fillRect(0,0,d.width,d.height),null!=c&&(context.strokeStyle="black",context.lineWidth=c),context.fillStyle="white",context.beginPath(),Draw.drawBezierPolygon(context,a,-d.x,-d.y),context.fill(),null!=c&&context.stroke();var e=context.getImageData(b.x-d.x,b.y-d.y,1,1).data;return clearContext(),e[0]>0},PolygonOperators.getBezierPolygonBestCenter=function(a,b){b=null==b?500:b;var c=a.getFrame();context.fillStyle="black",context.fillRect(0,0,c.width,c.height),context.fillStyle="white",context.beginPath(),Draw.drawBezierPolygon(context,a,-c.x,-c.y),context.fill();for(var d,e,f,g,h=0,i=0;b>i;i++)for(d=c.getRandomPoint(),e=0;e+=.1;TwoPi>=e){f=e;var j=context.getImageData(d.x+f*Math.cos(e)-c.x,d.y+f*Math.sin(e)-c.y,1,1).data;if(0==j[0]){f>h&&(h=f,g=d);break}}return g},PolygonOperators.convexHull=function(a,b){var c=this.hull(a,!0),d=NumberListGenerators.createSortedNumberList(a.length);d=d.getWithoutElementsAtIndexes(c);for(var e,f,g,h,i,j,k,l,m,n=new Point,o=b-1,p=c.length;b>o;){for(o=999999999,e=0;p>e;e++)for(g=a[c[e]],h=a[c[(e+1)%c.length]],n.x=.5*(g.x+h.x),n.y=.5*(g.y+h.y),m=Math.sqrt(Math.pow(h.x-g.x,2)+Math.pow(h.y-g.y,2)),f=0;null!=d[f];f++)i=a[d[f]],j=(Math.sqrt(Math.pow(i.x-g.x,2)+Math.pow(i.y-g.y,2))+Math.sqrt(Math.pow(i.x-h.x,2)+Math.pow(i.y-h.y,2)))/Math.pow(m,2),o>j&&(o=j,k=e,l=f);for(e=p-1;e>k;e--)c[e+1]=c[e];if(c[k+1]=d[l],d.splice(l,1),0==d.length)return c;p++}return c},PolygonOperators.controlPointsFromPointsAnglesIntensities=function(a,b,c){for(var d=new Polygon,e=0;null!=a[e];e++)e>0&&d.push(new Point(a[e].x-c[e]*Math.cos(b[e]),a[e].y-c[e]*Math.sin(b[e]))),e<a.length-1&&d.push(new Point(a[e].x+c[e]*Math.cos(b[e]),a[e].y+c[e]*Math.sin(b[e])));return d},PolygonOperators.placePointsInsidePolygon=function(a,b,c){var d=new Polygon,e=a.getFrame();switch(c=c||0){case 0:for(var f;d.length<b;)f=new Point(e.x+Math.random()*e.width,e.y+Math.random()*e.height),PolygonOperators.polygonContainsPoint(a,f)&&d.push(f);return d}},PolygonOperators.placePointsInsideBezierPolygon=function(a,b,c,d){var e=new Polygon,f=a.getFrame();switch(c=c||0){case 0:for(var g,h=0;e.length<b&&1e3>h;)g=new Point(f.x+Math.random()*f.width,f.y+Math.random()*f.height),h++,PolygonOperators.bezierPolygonContainsPoint(a,g,d)&&(e.push(g),h=0);return e}},RectangleOperators.packingRectangles=function(a,b,c,d){switch(null==c&&(c=new Rectangle(0,0,1,1)),b=b?b:0){case 0:return RectangleOperators.squarify(c,a);case 1:var e=a.getMinMaxInterval();e.min<0&&(a=a.add(-e.min),e=new Interval(0,e.max-e.min));var f,g,h=a.getSum(),i=new List,j=c.y,k=c.height/h;for(g=0;null!=a[g];g++)f=k*a[g],i.push(new Rectangle(c.x,j,c.width,f)),j+=f;return i;case 2:e=a.getMinMaxInterval(),e.min<0&&(a=a.add(-e.min),e=new Interval(0,e.max-e.min)),h=a.getSum(),i=new List;var l,m=c.x,n=c.width/h;for(g=0;null!=a[g];g++)l=n*a[g],i.push(new Rectangle(m,c.y,l,c.height)),m+=l;return i;case 3:if(a.length<6);else if(6==a.length){var o=new Rectangle(.44,.36,.16,.45),p=new Rectangle(.6,.15,.3,.3),q=new Rectangle(.72,.45,.28,.32),r=new Rectangle(.38,.04,.22,.32),s=new Point(.6,.36);o=expandRectangle(o,Math.sqrt(a[0]),s),p=expandRectangle(p,Math.sqrt(a[1]),s),r=expandRectangle(r,Math.sqrt(a[3]),s),q.x=p.x+.5*p.width,q.y=p.bottom;var t=new Point(q.x+.3*q.width,p.bottom);q=expandRectangle(q,Math.sqrt(a[2]),t),q.y+=.2*q.height;var u=new Point(.26,.36+Math.max(.3*o.height,.2*r.height)),v=new Rectangle(.1,u.y-.4,.2,.4),w=new Rectangle(.22,u.y,.16,.5);v=expandRectangle(v,Math.sqrt(a[4]),u),w=expandRectangle(w,Math.sqrt(a[5]),u);var x=.2*Math.max(r.width,o.width,w.right-u.x,v.right-u.x),y=Math.min(r.x,o.x)-Math.max(v.right,w.right)-x;return w.x+=y,v.x+=y,new List(o,p,q,r,v,w)}case 4:return europeQuadrigram(a);case 5:if(d=d||0,0==d)var z=Math.round(Math.sqrt(a.length));else z=Math.round(a.length/d);var A=Math.ceil(a.length/z),B=z*A-a.length,C=a.getAverage(),D=ListOperators.concat(a,ListGenerators.createListWithSameElement(B,C)),E=ListOperators.slidingWindowOnList(D,A,A,0),F=E.getSums(),G=this.packingRectangles(F,2,c);for(i=List(),g=0;z>g;g++)i=ListOperators.concat(i,this.packingRectangles(E[g],1,G[g]));return i;case 6:}return null},RectangleOperators.quadrification=RectangleOperators.squarify,RectangleOperators.squarify=function(a,b,c,d){if(null!=b){if(0==b.length)return new RectangleList;if(1==b.length)return new RectangleList(a);c=c?c:!1,d=d?d:!1;var e;if(e=c?b:b.getNormalizedToSum(),!d){var f=e.getSortIndexes();e=ListOperators.sortListByNumberList(e,e)}var g,h,i,j,k,l,m=a.width*a.height,n=new RectangleList,o=a.clone(),p=new List,q=0,r=new Rectangle,s=b.length;if(s>2){var t,u,v;for(t=q;s>t;t++)if(i=Number.MAX_VALUE,0==e[t])n.push(new Rectangle(r.x,r.y,0,0));else{for(u=1;s>u&&(g=e.slice(t,t+u),h=p.slice(),v=g.getSum(),k=v*m,r.x=o.x,r.y=o.y,o.width>o.height?(r.width=k/o.height,r.height=o.height,column=!0):(r.width=o.width,r.height=k/o.width,column=!1),p=RectangleOperators.partitionRectangle(r,g,v),j=p.highestRatio,!(j>=i));u++)i=j;if(0==h.length){if(n.push(new Rectangle(o.x,o.y,o.width,o.height)),n.length==s){if(!d){var w=new List;for(t=0;null!=n[t];t++)w[f[t]]=n[t];return w}return n}q++}else{if(n=n.concat(h),n.length==s){if(!d){for(w=new List,t=0;null!=n[t];t++)w[f[t]]=n[t];return w}return n}q+=h.length,l=h[h.length-1],o.width>o.height?(o.x=l.width+l.x,o.width-=l.width):(o.y=l.height+l.y,o.height-=l.height)}t=q-1}}else 2==s?(g=e.slice(),r=a.clone(),n=RectangleOperators.partitionRectangle(r,g,g.getSum())):n[0]=new Rectangle(a.x,a.y,a.width,a.height);if(!d){for(w=new List,t=0;null!=n[t];t++)w[f[t]]=n[t];return w}return n}},RectangleOperators.partitionRectangle=function(a,b,c){var d,e,f,g=a.width*a.height,h=new List,i=new Rectangle(a.x,a.y,a.width,a.height),j=1;for(e=0;e<b.length;e++)d=b[e]*g/c,a.width>a.height?(f=new Rectangle(i.x,i.y,d/i.height,i.height),h.push(f),i.x+=d/i.height):(f=new Rectangle(i.x,i.y,i.width,d/i.width),h.push(f),i.y+=d/i.width),f.ratio=Math.max(f.width,f.height)/Math.min(f.width,f.height),j=Math.max(j,f.ratio);return h.highestRatio=j,h},RectangleOperators._getHighestRatio=function(a){var b,c,d=1;for(c=0;c<a.length;c++)b=a[c],d=Math.max(d,b.getRatio());return d},ColorOperators.point3DToColor=function(a){return ColorUtils.RGBtouint(a.x,a.y,a.z)},ColorOperators.colorToPoint3D=function(a){return Point3D.fromArray(ColorUtils.uinttoRGB(a))},ColorGenerators.randomColor=function(a){return a=null==a?1:a,"rgba("+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+","+a+")"},ColorListGenerators._HARDCODED_CATEGORICAL_COLORS=new ColorList("#dd4411","#2200bb","#1f77b4","#ff660e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf","#dd8811","#dd0011","#221140","#1f66a3","#ff220e","#2ba01c","#442728","#945600","#8c453a","#e37700"),ColorListGenerators.createDefaultCategoricalColorList=function(a,b,c){b=null==b?1:b;var d=ColorListGenerators.createCategoricalColors(1,a).getInterpolated("black",.15);return 1>b&&(d=d.addAlpha(b)),c&&(d=d.getInverted()),d},ColorListGenerators.createColorListFromNumberList=function(a,b,c){c=null==c?0:c;var d,e,f=new ColorList;switch(c){case 0:d=a.getNormalizedToMax();break;case 1:break;case 2:}for(e=0;null!=d[e];e++)f.push(b(d[e]));return f},ColorListGenerators.createColorListWithSingleColor=function(a,b){for(var c=new ColorList,d=0;a>d;d++)c.push(b);return c},ColorListGenerators.createCategoricalColors=function(a,b,c,d,e,f){c=null==c?ColorScales.temperature:c;var g,h=new ColorList;switch(a){case 0:for(g=0;b>g;g++)h[g]=c(g/(b-1));break;case 1:var i=NumberListGenerators.createRandomNumberList(b,null,0);for(g=0;b>g;g++)h[g]=c(i[g]);break;case 2:for(g=0;b>g;g++)h[g]=ColorListGenerators._HARDCODED_CATEGORICAL_COLORS[g%ColorListGenerators._HARDCODED_CATEGORICAL_COLORS.length];break;case 5:var j,k,l,m=NumberListGenerators.createRandomNumberList(1001,null,0),n=NumberListGenerators.createSortedNumberList(b),o=NumberListGenerators.createRandomNumberList(b,null,0),p=ListOperators.sortListByNumberList(n,o),q=Math.floor(2*b)+100,r=Math.floor(.6*b)+5,s=ColorListGenerators._evaluationFunction(p),t=p,u=0;for(g=0;q>g;g++){for(k=0;r>k;k++)j=ColorListGenerators._sortingVariation(p,m[u],m[u+1]),u=(u+2)%1001,l=ColorListGenerators._evaluationFunction(j),l>s&&(t=j,s=l);p=t}for(g=0;b>g;g++)h.push(c(1/b+p[g]/(b+1)))}return null!=e&&null!=f&&(h=h.getInterpolated(e,f)),d&&(h=h.addAlpha(d)),h},ColorListGenerators._sortingVariation=function(a,b,c){var d=a.clone(),e=Math.floor(b*d.length),f=Math.floor(c*d.length),g=d[f];return d[f]=d[e],d[e]=g,d},ColorListGenerators._evaluationFunction=function(a){var b,c=0;for(b=0;null!=a[b+1];b++)c+=Math.sqrt(Math.abs(a[b+1]-a[b]));return c},ColorListGenerators.createCategoricalColorListForList=function(a,b,c,d,e,f){if(!a)return new ColorList;c||(c=1),d||(d="#fff"),e||(e=0),a=List.fromArray(a);var g,h=a.getWithoutRepetitions();g=b?b.getInterpolated(d,e):ColorListGenerators.createCategoricalColors(2,h.length,null,c,d,e),g=g.addAlpha(c),f&&(g=g.getInverted());var i=Table.fromArray([h,g]),j=ListOperators.translateWithDictionary(a,i,"NULL");return j=ColorList.fromArray(j),[{value:j,type:"ColorList"},{value:h,type:h.type},{value:g,type:"ColorList"},{value:new Table(h,j),type:"Table"}]},ColorListOperators.colorListFromColorScale=function(a,b){return a.getColorList.apply(a,[b])},ColorListOperators.colorListFromColorScaleFunction=function(a,b){var c,d=new ColorList;for(c=0;b>c;c++)d[c]=a(c/(b-1));return d},ColorListOperators.colorListFromColorScaleFunctionAndNumberList=function(a,b,c){c=null==c?!0:c,c&&(b=b.getNormalized());var d,e=new ColorList;for(d=0;null!=b[d];d++)e[d]=a(b[d]);return e},ColorListOperators.polygon3DToColorList=function(a){var b,c=a.length,d=new ColorList;for(b=0;c>b;b++)d.push(ColorOperators.point3DToColor(a[b]));return d},ColorListOperators.colorListToPolygon3D=function(a){var b,c=a.length,d=new Polygon3D;for(b=0;c>b;b++)d.push(ColorOperators.colorToPoint3D(a[b]));return d},ColorOperators.interpolateColors=function(a,b,c){var d=ColorOperators.interpolateColorsRGB(ColorOperators.colorStringToRGB(a),ColorOperators.colorStringToRGB(b),c);return ColorOperators.RGBtoHEX(d[0],d[1],d[2])},ColorOperators.interpolateColorsRGB=function(a,b,c){var d=1-c;return[Math.floor(d*a[0]+c*b[0]),Math.floor(d*a[1]+c*b[1]),Math.floor(d*a[2]+c*b[2])]},ColorOperators.RGBtoHEX=function(a,b,c){return"#"+ColorOperators.toHex(a)+ColorOperators.toHex(b)+ColorOperators.toHex(c)},ColorOperators.RGBArrayToString=function(a){return"rgb("+a[0]+","+a[1]+","+a[2]+")"},ColorOperators.HEXtoRGB=function(a){return[parseInt(a.substr(1,2),16),parseInt(a.substr(3,2),16),parseInt(a.substr(5,2),16)]},ColorOperators.colorStringToHEX=function(a){var b=ColorOperators.colorStringToRGB(a);return ColorOperators.RGBtoHEX(b[0],b[1],b[2])},ColorOperators.numberToHex=function(a){for(var b=a.toString(16);b.length<2;)b="0"+b;return b},ColorOperators.uinttoRGB=function(a){var b=new Array(a>>16,(a>>8)-(a>>16<<8),a-(a>>8<<8));return b},ColorOperators.uinttoHEX=function(a){var b=ColorOperators.uinttoRGB(a),c=ColorOperators.RGBToHEX(b[0],b[1],b[2]);return c},ColorOperators.RGBtouint=function(a,b,c){return Number(a)<<16|Number(b)<<8|Number(c)},ColorOperators.HEXtouint=function(a){var b=ColorOperators.HEXtoRGB(a),c=ColorOperators.RGBtouint(b[0],b[1],b[2]);return c},ColorOperators.grayByLevel=function(a){return a=Math.floor(255*a),"rgb("+a+","+a+","+a+")"},ColorOperators.HEXtoHSV=function(a){var b=ColorOperators.HEXtoRGB(a);return ColorOperators.RGBtoHSV(b[0],b[1],b[2])},ColorOperators.HSVtoHEX=function(a,b,c){var d=ColorOperators.HSVtoRGB(a,b,c);return ColorOperators.RGBtoHEX(d[0],d[1],d[2])},ColorOperators.HSLtoHEX=function(a,b,c){var d=ColorOperators.HSLtoRGB(a,b,c);return ColorOperators.RGBtoHEX(d[0],d[1],d[2])},ColorOperators.RGBtoHSV=function(a,b,c){var d,e,f,g=Math.min(Math.min(a,b),c),h=Math.max(Math.max(a,b),c);f=h/255;var i=h-g;return 0==i?new Array(0,0,a/255):0==h?(e=0,d=-1,new Array(d,e,f)):(e=i/h,d=a==h?(b-c)/i:b==h?2+(c-a)/i:4+(a-b)/i,d*=60,0>d&&(d+=360),new Array(d,e,f))},ColorOperators.HSVtoRGB=function(a,b,c){a=a?a:0,b=b?b:0,c=c?c:0;var d,e,f,g,h,i,j,k;if(0==b)return d=e=f=c,[Math.floor(255*d),Math.floor(255*e),Math.floor(255*f)];switch(a/=60,g=Math.floor(a),h=a-g,i=c*(1-b),j=c*(1-b*h),k=c*(1-b*(1-h)),g){case 0:d=c,e=k,f=i;break;case 1:d=j,e=c,f=i;break;case 2:d=i,e=c,f=k;break;case 3:d=i,e=j,f=c;break;case 4:d=k,e=i,f=c;break;default:d=c,e=i,f=j}return new Array(Math.floor(255*d),Math.floor(255*e),Math.floor(255*f))},ColorOperators.HSLtoRGB=function(a,b,c){function d(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a}var e,f,g;if(0==b)e=f=g=c;else{var h=.5>c?c*(1+b):c+b-c*b,i=2*c-h;e=d(i,h,a/360+1/3),f=d(i,h,a/360),g=d(i,h,a/360-1/3)}return[Math.floor(255*e),Math.floor(255*f),Math.floor(255*g)]},ColorOperators.invertColorRGB=function(a,b,c){return[255-a,255-b,255-c]},ColorOperators.addAlpha=function(a,b){var c=ColorOperators.colorStringToRGB(a);return null==c?"black":"rgba("+c[0]+","+c[1]+","+c[2]+","+b+")"},ColorOperators.invertColor=function(a){var b=ColorOperators.colorStringToRGB(a);return b=ColorOperators.invertColorRGB(b[0],b[1],b[2]),ColorOperators.RGBtoHEX(b[0],b[1],b[2])},ColorOperators.toHex=function(a){for(var b=a.toString(16);b.length<2;)b="0"+b;return b},ColorOperators.getRandomColor=function(){return"rgb("+String(Math.floor(256*Math.random()))+","+String(Math.floor(256*Math.random()))+","+String(Math.floor(256*Math.random()))+")"},ColorOperators.colorStringToRGB=function(a){"#"==a.charAt(0)&&(a=a.substr(1,6)),a=a.replace(/ /g,""),a=a.toLowerCase();var b={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};null!=b[a]&&(a=b[a]);for(var c=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,process:function(a){return[parseInt(a[1]),parseInt(a[2]),parseInt(a[3])]}},{re:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),[\.0123456789]+\)$/,process:function(a){return[parseInt(a[1]),parseInt(a[2]),parseInt(a[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,process:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,process:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}}],d=0;d<c.length;d++){var e=c[d].re,f=c[d].process,g=e.exec(a);if(g)return f(g)}return null},ColorScales.blackScale=function(a){return"black"},ColorScales.grayscale=function(a){var b=ColorOperators.interpolateColorsRGB([0,0,0],[255,255,255],a);return ColorOperators.RGBtoHEX(b[0],b[1],b[2])},ColorScales.antiGrayscale=function(a){var b=ColorOperators.interpolateColorsRGB([255,255,255],[0,0,0],a);return ColorOperators.RGBtoHEX(b[0],b[1],b[2])},ColorScales.antiTemperature=function(a){return ColorScales.temperature(1-a)},ColorScales.temperature=function(a){if(.2>a)var b=ColorOperators.interpolateColors("#000000",ColorOperators.HSVtoHEX(234,1,1),5*a);else b=a>.85?ColorOperators.interpolateColors(ColorOperators.HSVtoHEX(0,1,1),"#FFFFFF",(a-.85)/.15):ColorOperators.HSVtoHEX(Math.round(360*(.65-(a-.2))),1,1);return b},ColorScales.sqrtTemperature=function(a){return ColorScales.temperature(Math.sqrt(a))},ColorScales.sqrt4Temperature=function(a){return ColorScales.temperature(Math.pow(a,.25))},ColorScales.quadraticTemperature=function(a){return ColorScales.temperature(Math.pow(a,2))},ColorScales.cubicTemperature=function(a){return ColorScales.temperature(Math.pow(a,3))},ColorScales.greenToRed=function(a){var b=ColorOperators.interpolateColorsRGB([50,255,50],[255,50,50],a);return ColorOperators.RGBtoHEX(b[0],b[1],b[2])},ColorScales.greenToBlue=function(a){var b=ColorOperators.interpolateColorsRGB([50,255,50],[50,50,255],a);return ColorOperators.RGBtoHEX(b[0],b[1],b[2])},ColorScales.grayToOrange=function(a){var b=ColorOperators.interpolateColorsRGB([100,100,100],[255,110,0],a);return ColorOperators.RGBtoHEX(b[0],b[1],b[2])},ColorScales.blueToRed=function(a){return"rgb("+Math.floor(255*a)+",0,"+Math.floor(255*(1-a))+")"},ColorScales.blueToRedAlpha=function(a){return"rgba("+Math.floor(255*a)+",0,"+Math.floor(255*(1-a))+", 0.5)"},ColorScales.whiteToRed=function(a){var b=Math.floor(255-255*a);return"rgb(255,"+b+","+b+")"},ColorScales.redToBlue=function(a){var b=ColorOperators.interpolateColorsRGB([255,0,0],[0,0,255],a);return ColorOperators.RGBtoHEX(b[0],b[1],b[2])},ColorScales.greenWhiteRed=function(a){if(.5>a)var b=ColorOperators.interpolateColorsRGB([50,255,50],[255,255,255],2*a);else b=ColorOperators.interpolateColorsRGB([255,255,255],[255,50,50],2*(a-.5));return ColorOperators.RGBtoHEX(b[0],b[1],b[2])},ColorScales.solar=function(a){var b=ColorOperators.interpolateColorsRGB([0,0,0],ColorOperators.interpolateColorsRGB([255,0,0],[255,255,0],a),Math.pow(.99*a+.01,.2));return ColorOperators.RGBtoHEX(b[0],b[1],b[2])},ColorScales.antiSolar=function(a){return ColorOperators.invertColor(ColorScales.solar(a))},ColorScaleGenerators.createColorScaleFromColors=function(a,b){if(null==a||null==b||!a.length>0||!b.length>0||a.length!=b.length+2)return null;null==a.rgbs&&(a.rgbs=a.getRgbArrays()),b=b.slice(),b.unshift(0),b.push(1);var c=function(c){var d,e,f;for(d=0;null!=b[d+1];d++)if(c<b[d+1])return e=(c-b[d])/(b[d+1]-b[d]),f=1-e,"rgb("+Math.floor(f*a.rgbs[d][0]+e*a.rgbs[d+1][0])+","+Math.floor(f*a.rgbs[d][1]+e*a.rgbs[d+1][1])+","+Math.floor(f*a.rgbs[d][2]+e*a.rgbs[d+1][2])+")"};return c},ListGenerators.createListWithSameElement=function(a,b){switch(typeOf(b)){case"number":var c=new NumberList;break;case"List":var c=new Table;break;case"NumberList":var c=new NumberTable;break;case"Rectangle":var c=new RectamgleList;break;case"string":var c=new StringList;break;case"boolean":var c=new List;break;default:var c=new List}for(var d=0;a>d;d++)c[d]=b;return c},ListGenerators.createIterationSequence=function(a,b,c){for(var d=ListGenerators.createListWithSameElement(1,b),e=1;a>e;e++)d[e]=c(d[e-1]);return d},ListOperators.getElement=function(a,b){return null==a?null:(b=null==b?0:b%a.length,a[b])},ListOperators.getFirstElements=function(a,b){return null==a?null:(b=null==b?0:Number(b),[{type:"Object",name:"first value",description:"first value",value:a[b+0]},{type:"Object",name:"second value",description:"second value",value:a[b+1]},{type:"Object",name:"third value",description:"third value",value:a[b+2]},{type:"Object",name:"fourth value",description:"fourth value",value:a[b+3]},{type:"Object",name:"fifth value",description:"fifth value",value:a[b+4]},{type:"Object",name:"sixth value",description:"sixth value",value:a[b+5]},{type:"Object",name:"seventh value",description:"seventh value",value:a[b+6]},{type:"Object",name:"eight value",description:"eight value",value:a[b+7]},{type:"Object",name:"ninth value",description:"ninth value",value:a[b+8]},{type:"Object",name:"tenth value",description:"tenth value",value:a[b+9]}])},ListOperators.indexOf=function(a,b){return a.indexOf(b)},ListOperators.concat=function(){if(null==arguments||0==arguments.length||null==arguments[0])return null;if(1==arguments.length)return arguments[0];var a,b=arguments[0].concat(arguments[1]);for(a=2;arguments[a];a++)b=b.concat(arguments[a]);return b.getImproved()},ListOperators.assemble=function(){return List.fromArray(Array.prototype.slice.call(arguments,0)).getImproved()},ListOperators.countElementsRepetitionOnList=function(a,b,c,d){if(null!=a){b=null==b?!0:b,c=c||!1,d=null==d?0:d;var e,f,g,h=instantiate(typeOf(a)),i=new NumberList;if(c){if(0==a.length)return null;var j=a[0];for(h.push(j),i.push(1),g=1;g<nElements;g++)e=a[g],e==j?i[i.length-1]=i[i.length-1]+1:(h.push(e),i.push(1),j=e)}else for(g=0;null!=a[g];g++)e=a[g],f=h.indexOf(e),-1!=f?i[f]++:(h.push(e),i.push(1));if("NumberList"==h.type)var k=new NumberTable;else var k=new Table;return k[0]=h,k[1]=i,b&&(k=TableOperators.sortListsByNumberList(k,i)),0!=d&&d<h.length&&(k[0]=k[0].splice(0,d),k[1]=k[1].splice(0,d)),k}},ListOperators.reverse=function(a){return a.getReversed()},ListOperators.translateWithDictionary=function(a,b,c){var d=new List;return a.forEach(function(e,f){index=b[0].indexOf(e),null!=c?d[f]=-1==index?c:b[1][index]:d[f]=-1==index?a[f]:b[1][index]}),d.getImproved()},ListOperators.sortListByNumberList=function(a,b,c){if(null==c&&(c=!0),0==b.length)return a;var d=[],e=instantiate(typeOf(a));for(i=0;null!=a[i];i++)d.push([a[i],b[i]]);for(c?d.sort(function(a,b){return a[1]<b[1]?1:-1}):d.sort(function(a,b){return a[1]<b[1]?-1:1}),i=0;null!=d[i];i++)e.push(d[i][0]);
return e.name=a.name,e},ListOperators.sortListByIndexes=function(a,b){var c=instantiate(typeOf(a));c.name=a.name;var d,e=a.length;for(d=0;e>d;d++)c.push(a[b[d]]);return c},ListOperators.concatWithoutRepetitions=function(){var a,b=arguments[0].clone();for(a=1;a<arguments.length;a++)for(var c=arguments[a],d=c.length,a=0;d>a;a++)-1==b.indexOf(c[a])&&b.push(c[a]);return b.getImproved()},ListOperators.slidingWindowOnList=function(a,b,c,d){d=d||0;var e,f,g,h=new Table,i=a.length;switch(c=Math.max(1,c),d){case 0:for(f=0;i>f;f+=c)if(i>=f+b){for(e=new List,g=0;b>g;g++)e.push(a[f+g]);h.push(e.getImproved())}break;case 1:for(f=0;i>f;f+=c){for(e=new List,g=0;g<Math.min(b,i-f);g++)e.push(a[f+g]);h.push(e.getImproved())}break;case 2:for(f=0;i>f;f+=c){for(e=new List,g=0;b>g;g++)e.push(a[(f+g)%i]);h.push(e.getImproved())}}return h.getImproved()},ListOperators.getNewListForObjectType=function(a){var b=new List;return b[0]=a,instantiateWithSameType(b.getImproved())},ListOperators.listsIntersect=function(a,b){for(var c=a.length<b.length?a:b,d=a==c?b:a,e=0;null!=c[e];e++)if(-1!=d.indexOf(c[e]))return!0;return!1},ListOperators.getCommonElements=function(a,b){for(var c="NumberList"==a.type&&"NumberList"==b.type,d="StringList"==a.type&&"StringList"==b.type,e=c?new NumberList:d?new StringList:new List,f=a.length<b.length?a:b,g=a==f?b:a,h=0;null!=f[h];h++)-1!=g.indexOf(f[h])&&e.push(f[h]);return c||d?e:e.getImproved()},ListOperators.unionLists=function(a,b){var c;if(a.type!=a.type||"StringList"!=a.type&&"NumberList"!=a.type)return a.concat(b).getWithoutRepetitions();for(var d={},e=a.length-1;e>=0;--e)d[a[e]]=a[e];for(var e=b.length-1;e>=0;--e)d[b[e]]=b[e];c="StringList"==a.type?new StringList:new NumberList;for(var f in d)d.hasOwnProperty(f)&&c.push(d[f]);return c},ListOperators.intersectLists=function(a,b){var c;if(a.type!=b.type||"StringList"!=a.type&&"NumberList"!=a.type)c=ListOperators.getCommonElements(a,b);else for(c="StringList"==a.type?new StringList:new NumberList,a=a.slice(),b=b.slice();a.length>0&&b.length>0;)a[0]<b[0]?a.shift():a[0]>b[0]?b.shift():(c.push(a.shift()),b.shift());return c},ListOperators.getListEntropy=function(a,b){if(null!=a){if(a.length<2)return 1==a.length&&(a._mostRepresentedValue=a[0],a._biggestProbability=1,a._P_valueFollowing=a[0]==b?1:0),0;var d=ListOperators.countElementsRepetitionOnList(a,!0);c.l("    getListEntropy | table[0]",d[0]),c.l("    getListEntropy | table[1]",d[1]),a._mostRepresentedValue=d[0][0];var e=a.length;if(a._biggestProbability=d[1][0]/e,1==d[0].length)return a._P_valueFollowing=a[0]==b?1:0,0;var f=0,g=Math.log(d[0].length);if(d[1].forEach(function(a){f-=a/e*Math.log(a/e)/g}),null!=b){var h=d[0].indexOf(b);a._P_valueFollowing=-1==h?0:d[1][h]/e}return f}},ListOperators.getInformationGain=function(a,b){if(null==a||null==b||a.length!=b.length)return null;var c=ListOperators.getListEntropy(b),d={},e=[],f=a.length;return a.forEach(function(a,c){null==d[a]&&(d[a]=new List,e.push(d[a])),d[a].push(b[c])}),e.forEach(function(a){c-=a.length/f*ListOperators.getListEntropy(a)}),c},ListOperators.getInformationGainAnalysis=function(a,b){if(null==a||null==b||a.length!=b.length)return null;var c,d=ListOperators.getListEntropy(b),e={},f=[],g=a.length,h=new List;return a.forEach(function(a,c){null==e[a]&&(e[a]=new List,f.push(e[a])),e[a].push(b[c])}),f.forEach(function(a){c=ListOperators.getListEntropy(a),d-=a.length/g*c,h.push({children:a,entropy:c,infoGain:d})}),h},ListOperators.groupElements=function(a,b,c,d){if(a){var e=ListOperators._groupElements_Base(a,null,b,c,d);return e}},ListOperators.groupElementsByPropertyValue=function(a,b,c,d,e){if(a){var f=ListOperators._groupElements_Base(a,b,c,d,e);return f}},ListOperators._groupElements_Base=function(a,b,c,d,e){if(a){void 0==d&&(d=0);for(var f,g,h,i,j={},k=new Table,l=0;l<a.length;l++)g=a[l],f=void 0==b?g:g[b],void 0==j[f]&&(j[f]=new List,j[f].name=f,j[f].valProperty=f,k.push(j[f])),0==d?j[f].push(g):1==d&&j[f].push(l),(void 0==h||h>f)&&(h=f),(void 0==i||f>i)&&(i=f);if(e)for(var m=0,l=h;i>l;l++)void 0==j[l]&&(j[l]=new List,j[l].name=l,j[l].valProperty=l,k.push(j[l]),m++);return c&&(k=k.getSortedByProperty("name")),k}},TableConversions.ObjectToTable=function(a,b){var c;if(Array.isArray(a)){if(c=1,!b){b=[];for(var d in a[0])b.push(d)}}else{var e=[];for(var d in a)e.push(d);if(1==e.length&&Array.isArray(a[e[0]])){if(c=1,a=a[e[0]],!b){b=[];for(var d in a[0])b.push(d)}}else c=3,b||(b=e)}for(var f=new Table,g=0;g<b.length;g++){var h=b[g],i=new List;f[g]=i,i.name=h}if(1==c)for(var g=0;g<a.length;g++)for(var j=a[g],k=0;k<b.length;k++)f[k].push(j[b[k]]);else for(var k=0;k<b.length;k++)for(var i=a[b[k]],g=0;g<i.length;g++)f[k].push(i[g]);for(var g=0;g<f.length;g++)f[g]=f[g].getImproved();return f=f.getImproved()},TableConversions.ObjectToList=function(a,b){var c=TableConversions.ObjectToTable(a,b);return 1==c.getLengths.getMax()?c.getRow(0):void 0},TableConversions.TableToObject=function(a,b){if(a){b||(b=a.getNames());for(var c=[],d=0;d<a[0].length;d++){for(var e={},f=0;f<b.length;f++)e[b[f]]=a[f][d];c.push(e)}return{array:c}}},TableEncodings.ENTER=String.fromCharCode(13),TableEncodings.ENTER2=String.fromCharCode(10),TableEncodings.ENTER3=String.fromCharCode(8232),TableEncodings.SPACE=String.fromCharCode(32),TableEncodings.SPACE2=String.fromCharCode(160),TableEncodings.TAB="	",TableEncodings.TAB2=String.fromCharCode(9),TableEncodings.CSVtoTable=function(a,b,c,d){d=null==d?"":d;var e,f=null==b?!1:b;if(null==a)return null;if(""==a)return new Table;a=a.replace(/\$/g,"");var g=a.split('"');for(e=1;null!=g[e];e+=2)g[e]=g[e].replace(/\n/g,"*ENTER*");a=g.join('"');var h=TableEncodings.ENTER2,i=a.split(h);1==i.length&&(h=TableEncodings.ENTER,i=a.split(h),1==i.length&&(h=TableEncodings.ENTER3,i=a.split(h)));var k=new Table,l=void 0!=c?c:",";if(null==a||""==a||" "==a||0==i.length)return null;var m=0;if(f){m=1;var n=i[0].split(l)}var o,p,q;for(e=m;e<i.length;e++)if(!(i[e].length<2)){var r=NetworkEncodings.replaceChomasInLine(i[e]).split(l);for(j=0;j<r.length;j++){k[j]=null==k[j]?new List:k[j],f&&1==e&&(k[j].name=null==n[j]?"":TableEncodings._removeQuotes(n[j]));var s=f?e-1:e;p=r[j].replace(/\*CHOMA\*/g,",").replace(/\*ENTER\*/g,"\n"),p=""==p?d:p,q=Number(p.replace(",",".")),o=q||0==q&&""!=p?q:p,"string"==typeof o&&(o=TableEncodings._removeQuotes(o)),k[j][s]=o}}for(e=0;null!=k[e];e++)k[e]=k[e].getImproved();return k=k.getImproved()},TableEncodings._removeQuotes=function(a){return 0==a.length?a:('"'!=a.charAt(0)&&"'"!=a.charAt(0)||'"'!=a.charAt(a.length-1)&&"'"!=a.charAt(a.length-1)||(a=a.substr(1,a.length-2)),a)},TableEncodings.TableToCSV=function(a,b,c){b=b||",";var d,e,f,g,h,i=ListGenerators.createListWithSameElement(a[0].length,"");for(d=0;null!=a[d];d++)for(f=a[d],g=f.type,h=d!=a.length-1,e=0;null!=f[e];e++){switch(g){case"NumberList":i[e]+=f[e];break;default:i[e]+='"'+f[e]+'"'}h&&(i[e]+=b)}var j="";if(c){for(d=0;null!=a[d];d++)f=a[d],j+='"'+f.name+'"',d!=a.length-1&&(j+=b);j+="\n"}return j+i.getConcatenated("\n")},TableGenerators.createTableWithSameElement=function(a,b,c){for(var d=new Table,e=0;a>e;e++)d[e]=ListGenerators.createListWithSameElement(b,c);return d.getImproved()},TableOperators.getElementFromTable=function(a,b,c){return null==a[b]?null:a[b][c]},TableOperators.getSubTable=function(a,b,c,d,e){if(null==a)return a;var f=a.length;if(0==f)return null;var g=new Table;0>=d&&(d=f-b+d),b=Math.min(b,f-1),d=Math.min(d,f-b);var h=a[0].length;if(0==h)return null;0>=e&&(e=h-c+e),c=Math.min(c,h-1),e=Math.min(e,h-c);var i,j,k,l,m;for(k=b;b+d>k;k++){for(i=a[k],j=new List,j.name=a[k].name,l=c;c+e>l;l++)m=i[l],j.push(m);g.push(j.getImproved())}return g.getImproved()},TableOperators.transpose=function(a,b){return null==a?null:a.getTransposed(b)},TableOperators.trainingTestPartition=function(a,b,c,d){if(null!=a&&null!=b){c=c||0,d=d||0;var e=new NumberList,f=new NumberList,g=1==c?new NumberOperators._Alea("my",d,"seeds"):Math.random;return 2==c&&(N_MOD=Math.floor(b/(1-b)*10)),a[0].forEach(function(a,d){0==c||1==c?g()<b?e.push(d):f.push(d):d%N_MOD!=0?e.push(d):f.push(d)}),new List(a.getSubListsByIndexes(e),a.getSubListsByIndexes(f))}},TableOperators.testClassificationModel=function(a,b,c,d){if(null==a||null==b||null==c)return null;d=d||0;var e=0;return b.forEach(function(b,d){c(a[0][d],a[1][d])!=b&&e++}),e/b.length},TableOperators.getSubListsByIndexes=function(a,b){var c=new Table;c.name=a.name;var d,e,f;for(d=0;null!=a[d];d++){for(e=a[d],f=instantiateWithSameType(e),j=0;null!=b[j];j++)f[j]=e[b[j]];c[d]=f.getImproved()}return c},TableOperators.sortListsByNumberList=function(a,b,c){null==c&&(c=!0);var d=instantiate(typeOf(a));d.name=a.name;var e,f=a.length,g=b.clone();for(e=0;e<g.length;e++)g[e]=e;for(g=ListOperators.sortListByNumberList(g,b,c),e=0;f>e;e++){d[e]=a[e].clone();for(var h=0;h<g.length;h++)d[e][h]=a[e][g[h]]}return d},TableOperators.aggregateTable=function(a,b,c){if(b=null==b?0:b,null==a||null==a[0]||null==a[0][0]||null==a[b])return null;c=null==c?0:c;var d,e,f,g,h=new Table;for(h.name=a.name,e=0;null!=a[e];e++)h[e]=new List,h[e].name=a[e].name;switch(c){case 0:for(d=0;null!=a[0][d];d++)if(g=-1==h[b].indexOf(a[b][d]))for(e=0;null!=a[e];e++)h[e].push(a[e][d]);break;case 1:for(d=0;null!=a[0][d];d++)if(f=h[b].indexOf(a[b][d]),g=-1==f)for(e=0;null!=a[e];e++)h[e].push(a[e][d]);else for(e=0;null!=a[e];e++)e!=b&&"NumberList"==a[e].type&&(h[e][f]+=a[e][d]);break;case 2:var i=a[b].getElementsRepetitionCount(!1);for(h=TableOperators.aggregateTable(a,b,1),e=0;null!=h[e];e++)e!=b&&"NumberList"==h[e].type&&(h[e]=h[e].divide(i[1]));h.push(i[1])}for(e=0;null!=h[e];e++)h[e]=h[e].getImproved();return h.getImproved()},TableOperators.getCountPairsMatrix=function(a){if(null==a||a.length<2||null==a[0]||null==a[0][0])return null;var b=a[0].getWithoutRepetitions(),c=a[1].getWithoutRepetitions(),d=new NumberTable(c.length);return c.forEach(function(a,c){d[c].name=String(a),b.forEach(function(a,b){d[c][b]=0})}),a[0].forEach(function(e,f){element1=a[1][f],d[c.indexOf(element1)][b.indexOf(e)]++}),d},TableOperators.filterTableByElementInList=function(a,b,c){if(!(null==a||!a.length>1||null==b)){if(null==c)return a;var d,e,f=new Table;for(f.name=a.name,e=0;null!=a[e];e++)f[e]=new List;for(d=0;null!=a[0][d];d++)if(a[b][d]==c)for(e=0;null!=a[e];e++)f[e].push(a[e][d]);for(e=0;null!=f[e];e++)f[e]=f[e].getImproved();return f}},TableOperators.mergeDataTablesInList=function(a){if(a.length<2)return a;for(var b=a[0],c=1;null!=a[c];c++)b=TableOperators.mergeDataTables(b,a[c]);return b},TableOperators.mergeDataTables=function(a,b){if(0==b[0].length){var c=a.clone();return c.push(ListGenerators.createListWithSameElement(a[0].length,0)),c}var d,e,f,g=new Table,h=ListOperators.concatWithoutRepetitions(a[0],b[0]),i=h.length,j=a.length-1,k=b.length-1,l=new NumberTable,m=new NumberTable;for(e=0;i>e;e++){if(d=a[0].indexOf(h[e]),d>-1)for(var f=0;j>f;f++)0==e&&(l[f]=new NumberList,l[f].name=a[f+1].name),l[f][e]=a[f+1][d];else for(f=0;j>f;f++)0==e&&(l[f]=new NumberList,l[f].name=a[f+1].name),l[f][e]=0;if(d=b[0].indexOf(h[e]),d>-1)for(f=0;k>f;f++)0==e&&(m[f]=new NumberList,m[f].name=b[f+1].name),m[f][e]=b[f+1][d];else for(f=0;k>f;f++)0==e&&(m[f]=new NumberList,m[f].name=b[f+1].name),m[f][e]=0}for(g[0]=h,e=0;null!=l[e];e++)g.push(l[e]);for(e=0;null!=m[e];e++)g.push(m[e]);return g},TableOperators.fusionDataTables=function(a,b){for(var c,d,e=a.clone(),f=0;null!=b[0][f];f++)d=b[0][f],c=e[0].indexOf(d),-1==c?(e[0].push(d),e[1].push(b[1][f])):e[1][c]+=b[1][f];return e},TableOperators.completeTable=function(a,b,c){c=null==c?0:c;var d=new Table;d.name=a.name;for(var e,f,g,h=0;h<a.length;h++){for(e=a[h],f=null==e?ListOperators.getNewListForObjectType(c):instantiateWithSameType(e),f.name=null==e?"":e.name,g=0;b>g;g++)f[g]=null==e||null==e[g]?c:e[g];d[h]=f}return d},TableOperators.getNumberTableFromTable=function(a){if(null==a||!a.length>0)return null;var b,c=new NumberTable;for(c.name=a.name,b=0;null!=a[b];b++)"NumberList"==a[b].type&&c.push(a[b]);return c},TableOperators.getVariablesInformationGain=function(a,b){if(null==a)return null;var c=new NumberList;return a.forEach(function(a){c.push(ListOperators.getInformationGain(a,b))}),c},TableOperators.splitTableByCategoricList=function(a,b){if(null==a||null==b)return null;var c,d=new List,e={};b.length;return b.forEach(function(b,f){c=e[b],null==c&&(c=new Table,e[b]=c,d.push(c),a.forEach(function(a,b){c[b]=new List,c[b].name=a.name}),c._element=b),a.forEach(function(b,d){c[d].push(a[d][f])})}),d},TableOperators.buildDecisionTree=function(a,b,c,d,e,f,g){if(null!=a&&null!=b&&null!=c){d=null==d?.2:d,e=e||10,f=f||.002;var h=NumberListGenerators.createSortedNumberList(b.length),i=new Tree;return TableOperators._buildDecisionTreeNode(i,a,b,0,d,e,f,null,null,c,h,g),i}},TableOperators._buildDecisionTreeNode=function(a,b,d,e,f,g,h,i,j,k,l,m){var n=ListOperators.getListEntropy(d,k);if(n>=f){informationGains=TableOperators.getVariablesInformationGain(b,d);var o=0,p=0;informationGains.forEach(function(a,b){a>o&&(o=a,p=b)})}var q=n>=f&&o>h&&d.length>=g,r=a.nodeList.getNewId(),s=(null==j?"":j+":")+(q?b[p].name:"P="+d._biggestProbability+"("+d._mostRepresentedValue+")"),t=new Node(r,s);if(a.addNodeToTree(t,i),null==i&&(a.informationGainTable=new Table,a.informationGainTable[0]=b.getNames(),informationGains&&(a.informationGainTable[1]=informationGains.clone(),a.informationGainTable=a.informationGainTable.getListsSortedByList(informationGains,!1))),t.entropy=n,t.weight=d.length,t.supervised=d,t.indexes=l,t.value=j,t.mostRepresentedValue=d._mostRepresentedValue,t.biggestProbability=d._biggestProbability,t.valueFollowingProbability=d._P_valueFollowing,t.lift=t.valueFollowingProbability/a.nodeList[0].valueFollowingProbability,2>e&&(c.l("\nlevel",e),c.l("supervised.countElement(supervisedValue)",d.countElement(k)),c.l("entropy",n),c.l("value",j),c.l("name",s),c.l("supervised.name",d.name),c.l("supervised.length",d.length),c.l("supervisedValue",k),c.l("supervised._biggestProbability, supervised._P_valueFollowing",d._biggestProbability,d._P_valueFollowing),c.l("node.valueFollowingProbability (=supervised._P_valueFollowing):",t.valueFollowingProbability),c.l("tree.nodeList[0].valueFollowingProbability",a.nodeList[0].valueFollowingProbability),c.l("node.biggestProbability (=_biggestProbability):",t.biggestProbability),c.l("node.mostRepresentedValue:",t.mostRepresentedValue),c.l("node.mostRepresentedValue==supervisedValue",t.mostRepresentedValue==k)),t._color=TableOperators._decisionTreeColorScale(1-t.valueFollowingProbability),m){var u=document.createElement("canvas");u.width=150,u.height=100;var v=u.getContext("2d");v.clearRect(0,0,150,100),TableOperators._decisionTreeGenerateColorsMixture(v,150,100,["blue","red"],t.mostRepresentedValue==k?[Math.floor(t.biggestProbability*t.weight),Math.floor((1-t.biggestProbability)*t.weight)]:[Math.floor((1-t.biggestProbability)*t.weight),Math.floor(t.biggestProbability*t.weight)]);var w=new Image;w.src=u.toDataURL(),t.pattern=v.createPattern(w,"repeat")}if(!q)return t;t.bestFeatureName=b[p].name,t.iBestFeature=p,t.informationGain=o;var x,y,z=b.concat([d,l]),A=TableOperators.splitTableByCategoricList(z,b[p]);return A.forEach(function(b){x=b.getSubList(0,b.length-3),y=b[b.length-2],childIndexes=b[b.length-1],TableOperators._buildDecisionTreeNode(a,x,y,e+1,f,g,h,t,b._element,k,childIndexes,m)}),t.toNodeList=t.toNodeList.getSortedByProperty("valueFollowingProbability",!1),t},TableOperators._decisionTreeColorScale=function(a){var b=.5>a?Math.floor(510*a):255,c=.5>a?Math.floor(510*a):Math.floor(510*(1-a)),d=.5>a?255:Math.floor(510*(1-a));return"rgb("+b+","+c+","+d+")"},TableOperators._decisionTreeGenerateColorsMixture=function(a,b,c,d,e){var f,g,h,i=ListGenerators.createListWithSameElement(e[0],d[0]);for(h=1;null!=d[h];h++)i=i.concat(ListGenerators.createListWithSameElement(e[h],d[h]));for(f=0;b>f;f++)for(g=0;c>g;g++)h=4*(f+g*b),a.fillStyle=i.getRandomElement(),a.fillRect(f,g,1,1)},StringConversions.stringToObject=function(a){try{return JSON.parse(a)}catch(b){return null}},StringListOperators.concatStrings=function(a,b){return null==b&&(b=""),StringList.fromArray(a.join(b))},StringListOperators.join=function(a,b,c,d){return null!=a?(b=null==b?"":b,c=null==c?"":c,d=null==d?"":d,c+a.join(b)+d):void 0},StringListOperators.filterStringListByString=function(a,b,c,d){var e,f=d?new NumberList:new StringList;if(c)var g=new RegExp("\\b"+b+"\\b");for(e=0;null!=a[e];e++)c?a[e].match(g).length>0&&f.push(d?e:a[e]):-1!=a[e].indexOf(b)&&f.push(d?e:a[e]);return f},StringListOperators.countStringsOccurrencesOnTexts=function(a,b){var c,d,e,f,g,h=new NumberTable;for(c=0;null!=a[c];c++){for(e=a[c],f=new NumberList,f.name=e,d=0;null!=b[d];d++)g=b[d].split(e),f[d]=g.length-1;h[c]=f}return h},StringListOperators.getWordsOccurrencesMatrix=function(a,b,c,d,e,f,g,h,i){var j;d=d||500,e=e||1e3,f=null==f?!0:f,g=g||!1,h=h||!0,i=null==i?3:i;var k,l=StringOperators.getWordsOccurrencesTable(a[0],b,c,d,i);for(j=1;null!=a[j];j++)k=StringOperators.getWordsOccurrencesTable(a[j],b,c,d,i),l=TableOperators.mergeDataTables(l,k);if(l[0].length>e&&(h=!0),g||h){var m=new NumberList;m=l[1].clone(),l.forEach(function(a,b){2>b||a.forEach(function(a,b){m[b]+=a})}),g&&l.forEach(function(a,b){0!=b&&a.forEach(function(b,c){a[c]=b/m[c]})}),h&&(l=l.getListsSortedByList(m,!1))}return f&&l.forEach(function(a,b){0!=b&&(l[b]=l[b].getNormalizedToSum())}),e>0&&(l=l.sliceRows(0,e-1)),l},StringListOperators.createTextsNetwork=function(a,b,d,e){var f,g,h=new Network,i=StringListOperators.getWordsOccurrencesMatrix(a,b,!1,600,800,!1,!0,!1,3);for(a.forEach(function(a,b){node=new Node("_"+b,"_"+b),node.content=a,node.wordsWeights=i[b+1],h.addNode(node)}),f=0;null!=h.nodeList[f+1];f++)for(node=h.nodeList[f],g=f+1;null!=h.nodeList[g];g++)node1=h.nodeList[g],weight=NumberListOperators.cosineSimilarity(node.wordsWeights,node1.wordsWeights),0==f&&1==g&&(c.log(node.wordsWeights.length,node1.wordsWeights.length,weight),c.log(node.wordsWeights.type,node.wordsWeights),c.log(node1.wordsWeights.type,node1.wordsWeights),c.log(node.wordsWeights.getNorm()*node1.wordsWeights.getNorm())),weight>e&&(relation=new Relation(node.id+"_"+node1.id,node.id+"_"+node1.id,node,node1,weight),h.addRelation(relation));return h},StringListOperators.createShortTextsNetwork=function(a,b,d,e,f,g){if(null!=a&&null!=a.length&&0!=a.length){var h,i,j,k,l,m,n,o=(new Date).getTime(),p=new Network,q=a.join(" *** ").toLowerCase(),r=q.split(" *** "),s=a.length,t=0;if(d=d||.2,e=e||0,g){g[0]=g[0].toLowerCase();var u,v=g[1][0]}var w;switch(e){case 0:w=function(a){return 1-Math.pow(2*a/(s-1)-1,2)};break;case 1:w=function(a){return 1/(a+1)};break;case 2:w=function(a){return 1-Math.pow(2*Math.pow(a/(s-1),.2)-1,2)};default:w=function(a){return 0==a?0:1/a}}for(c.l("A ===> StringListOperators.createShortTextsNetwork took:",(new Date).getTime()-o),o=(new Date).getTime(),a.forEach(function(a,c){for(node=new Node("_"+c,"_"+c),p.addNode(node),node.content=a,words=StringOperators.getWords(a,!0,b,!1,!1,0,3),l=words.length,m=new NumberList,i=0;null!=words[i];i++)j=words[i],nOtherTexts=0,r.forEach(function(a,b){c!=b&&(nOtherTexts+=Number(-1!=a.indexOf(j)))}),0!=nOtherTexts?(m[i]=w(nOtherTexts),f&&(m[i]*=1-1/(StringOperators.countOccurrences(r[c],j)+1)),g&&(u=g[0].indexOf(j),m[i]*=-1==u?1:1-Math.pow(g[1][u]/v,.2)),t=Math.max(t,m[i])):(words.splice(i,1),i--);k=Math.floor(3*Math.log(l+1)),words=words.getSortedByList(m,!1).slice(0,k),words.position={},words.forEach(function(a,b){words.position[a]=b}),m=m.getSorted(!1).slice(0,k),node.wordsTable=new Table,node.wordsTable[0]=words,node.wordsTable[1]=m}),c.l("B ===> StringListOperators.createShortTextsNetwork took:",(new Date).getTime()-o),o=(new Date).getTime(),h=0;null!=p.nodeList[h+1];h++)for(node=p.nodeList[h],i=h+1;null!=p.nodeList[i];i++)node1=p.nodeList[i],n=0,node.wordsTable[0].forEach(function(a,b){u=node1.wordsTable[0].position[a],null!=u&&(n+=node.wordsTable[1][b]*node1.wordsTable[1][u])}),n=Math.sqrt(n/t/Math.max(node.wordsTable[0].length,node1.wordsTable[0].length)),n>d&&(relation=new Relation(node.id+"_"+node1.id,node.id+"_"+node1.id,node,node1,n),p.addRelation(relation));return c.l("C ===> StringListOperators.createShortTextsNetwork took:",(new Date).getTime()-o),p}},StringOperators.ENTER=String.fromCharCode(13),StringOperators.ENTER2=String.fromCharCode(10),StringOperators.ENTER3=String.fromCharCode(8232),StringOperators.SPACE=String.fromCharCode(32),StringOperators.SPACE2=String.fromCharCode(160),StringOperators.TAB="	",StringOperators.TAB2=String.fromCharCode(9),StringOperators.LINK_REGEX=/(^|\s+)(https*\:\/\/\S+[^\.\s+])/,StringOperators.MAIL_REGEX=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,StringOperators.STOP_WORDS=StringList.fromArray("t,s,mt,rt,re,m,http,amp,a,able,about,across,after,all,almost,also,am,among,an,and,any,are,as,at,be,because,been,but,by,can,cannot,could,dear,did,do,does,either,else,ever,every,for,from,get,got,had,has,have,he,her,hers,him,his,how,however,i,if,in,into,is,it,its,just,least,let,like,likely,may,me,might,most,must,my,neither,no,nor,not,of,off,often,on,or,other,our,own,rather,said,say,says,she,should,since,so,some,than,that,the,their,them,then,there,these,they,this,tis,to,too,twas,us,wants,was,we,were,what,when,where,which,while,who,whom,why,will,with,would,yet,you,your".split(",")),StringOperators.split=function(a,b){return null==b?StringOperators.splitByEnter(a):StringList.fromArray(a.split(b))},StringOperators.splitByEnter=function(a){if(null==a)return null;var b=StringOperators.splitString(a,"\n");if(b.length>1)return b;var b=StringOperators.splitString(a,StringOperators.ENTER2);if(b.length>1)return b;var b=StringOperators.splitString(a,StringOperators.ENTER3);return b.length>1?b:new StringList(a)},StringOperators.replaceSubString=function(a,b,c){return null==a||null==b||null==c?null:a.replace(new RegExp(b,"g"),c)},StringOperators.replaceSubStringsByString=function(a,b,c){if(null!=b){return b.forEach(function(b){a=StringOperators.replaceSubString(a,b,c)}),a}},StringOperators.replaceSubStringsByStrings=function(a,b,c){if(null!=b&&null!=c){var d,e=Math.min(b.length,c.length);for(d=0;e>d;d++)a=StringOperators.replaceSubString(a,b[d],c[d]);return a}},StringOperators.substr=function(a,b,c){return b=b||0,a.substr(b,c)},StringOperators.splitString=function(a,b){return null==a?null:(null==b&&(b=","),"string"==typeof b&&(b=b.replace("\\n","\n")),-1==a.indexOf(b)?new StringList(a):StringList.fromArray(a.split(b)))},StringOperators.getFirstTextBetweenStrings=function(a,b,c){var d=a.indexOf(b);if(-1==d)return null;if(""==c||null==c)return a.substr(d+b.length);var e=a.indexOf(c,d+b.length+1);return-1==e?a.substring(d+b.length):a.substr(d+b.length,e-(d+b.length))},StringOperators.getAllTextsBetweenStrings=function(a,b,c){if(-1==a.indexOf(b))return new StringList;var d,e,f,g=a.split(b),h=g.length,i=new StringList;for(f=1;h>f;f++)d=g[f],c==b?i.push(d):(e=d.indexOf(c),e>=0&&i.push(d.substr(0,e)));return i},StringOperators.countWordsDichotomyAnalysis=function(a,b,c,d){var e=0;return b.forEach(function(b){e-=StringOperators.countWordOccurrences(a,b)}),c.forEach(function(b){e+=StringOperators.countWordOccurrences(a,b)}),d&&(e/=a.length),e},StringOperators.getLinksFromHtml=function(a,b,c){var d=document.createElement("html");d.innerHTML=a;var e,f,g,h,i,j,k,l=d.getElementsByTagName("a"),m=new StringList;if(b=""==b?null:b,c=null==c?!1:c,b){b=b.trim(),".html"==b.substr(-5)&&(i=b.split("/"),b=i.slice(0,i.length-1).join("/")),"/"==b.indexOf(-1)&&(b=b.substr(0,b.length-1)),i=b.split("/");var n=b.replace("//","**").split("/")[0].replace("**","//")}for(e=0;e<l.length;e++)if(f=g=l[e].getAttribute("href"),null!=g){for(-1!=g.indexOf("=")&&(g=g.split("=")[0]),b&&-1==g.indexOf("http://")&&-1==g.indexOf("https://")&&-1==g.indexOf("wwww.")&&-1==g.indexOf("file:")&&-1==g.indexOf("gopher:")&&0!=g.indexOf("//")&&(g="../../../"==g.substr(0,9)?i.slice(0,i.length-3).join("/")+"/"+g.substr(9):"../../"==g.substr(0,6)?i.slice(0,i.length-2).join("/")+"/"+g.substr(6):"../"==g.substr(0,3)?i.slice(0,i.length-1).join("/")+"/"+g.substr(3):"/"==g.charAt(0)?n+g:b+"/"+g),c&&-1!=g.indexOf("#")&&(g=g.split("#")[0]),"/"==g.substr(-1)&&(g=g.substr(0,g.length-1)),h=g.indexOf("/../");-1!=h;)k=g.split("/../"),j=k[0].replace("//","**").split("/"),g=j.slice(0,j.length-1).join("/").replace("**","//")+("/"+k.slice(1).join("/../")),h=g.indexOf("/../");-1!=g.indexOf("./")&&(j=g.replace("//","**").split("/"),"."==j[0].substr(-1)&&(j[0]=j[0].substr(0,j[0].length-1),g=j.join("/").replace("**","//"))),g=g.trim(),"/"==g.substr(-1)&&(g=g.substr(0,g.length-1)),g!=b&&m.push(g)}return m=m.getWithoutRepetitions()},StringOperators.textContainsString=function(a,b,c,d){return a=d?b:a.toLowerCase(),b=d?b:b.toLowerCase(),c?a.match(new RegExp("\\b"+b+"\\b")).length>0:-1!=a.indexOf(b)},StringOperators.logInConsole=function(a,b){b=null==b?!0:b,b&&c.log("///////////////////////////////////////////////////"),c.log(a),b&&c.log("///////////////////////////////////////////////////")},StringOperators.getParenthesisContents=function(a,b){for(var c=new StringList,d=a,e=StringOperators.getFirstParenthesisContentWithIndexes(a,b),f=0;""!=e.content&&e.index1<d.length-1&&f<a.length;)c.push(e.content),d=d.substr(e.index1+2),e=StringOperators.getFirstParenthesisContentWithIndexes(d,b),f++;return c},StringOperators.getFirstParenthesisContent=function(a,b){return StringOperators.getFirstParenthesisContentWithIndexes(a,b).content},StringOperators.getFirstParenthesisContentWithIndexes=function(a,b){var c=b?"[":"(",d=b?"]":")",e=b?/\[/g:/\(/g,f=b?/\]/g:/\)/g,g=a.indexOf(c);if(-1==g)return{content:"",index0:0,index1:0};for(var h=a.indexOf(d),i=a.substring(g+1,h),j=i.match(e),k=i.match(f),l=(null==j?0:j.length)-(null==k?0:k.length),m=0;(l>0||-1==h)&&m<a.length;)h=a.indexOf(d,h),i=a.substring(g+1,h+1),h++,j=i.match(e),k=i.match(f),l=(null==j?0:j.length)-(null==k?0:k.length),m++;return h=a.indexOf(d,h),{content:-1==h?a.substring(g+1):a.substring(g+1,h),index0:g+1,index1:-1==h?a.length-1:h-1}},StringOperators.placeString=function(a,b,c){return a.substr(0,c)+b+a.substr(c+b.length)},StringOperators.insertString=function(a,b,c){return a.substr(0,c)+b+a.substr(c)},StringOperators.removeEnters=function(a){return a.replace(/(\StringOperators.ENTER|\StringOperators.ENTER2|\StringOperators.ENTER3)/gi," ")},StringOperators.removeTabs=function(a){return a.replace(/(\StringOperators.TAB|\StringOperators.TAB2|\t)/gi,"")},StringOperators.removePunctuation=function(a,b){return b=b||"",a.replace(/[:,.;?!\(\)\"\']/gi,b)},StringOperators.removeDoubleSpaces=function(a){for(var b=a,c=RegExp(/  /);c.test(b);)b=b.replace(c," ");return b},StringOperators.removeInitialRepeatedCharacter=function(a,b){for(;a.charAt(0)==b;)a=a.substr(1);return a},StringOperators.removeHtmlTags=function(a){var b=document.createElement("DIV");return b.innerHTML=a,b.textContent||b.innerText},StringOperators.removeLinks=function(a){a+=" ";var b=/http:\/\/[a-zA-Z0-9\/\.]+( |:|;|\r|\t|\n|\v)/g;return a.replace(b," ").substr(0,a.length-2)},StringOperators.removeQuotes=function(a){return'"'==a.charAt(0)&&(a=a.substr(1)),'"'==a.charAt(a.length-1)&&(a=a.substr(0,a.length-1)),a},StringOperators.getWords=function(a,b,c,d,e,f,g){if(null==a)return null;g=g||0,b=null==b?!0:b,d=null==d?!0:d,e=null==e?!0:e,f=null==f?0:f;var h,i;if(e)var j=a.match(StringOperators.LINK_REGEX);a=a.toLowerCase().replace(StringOperators.LINK_REGEX,"");var k=a.match(/\w+/g);if(null==k)return new StringList;if(e&&null!=j&&(k=k.concat(j)),k=StringList.fromArray(k).replace(/ /g,""),null!=c)for(h=0;null!=k[h];h++)for(i=0;null!=c[i];i++)if("string"==typeof c[i]){if(c[i]==k[h]){k.splice(h,1),h--;break}}else if(c[i].test(k[h])){k.splice(h,1),h--;break}if(g>0)for(h=0;null!=k[h];h++)k[h].length<g&&(k.splice(h,1),h--);if(d){if(b)return k=ListOperators.countElementsRepetitionOnList(k,!0)[0],0!=f&&(k=k.substr(0,f)),k;var l=ListOperators.countOccurrencesOnList(k);return k=k.getSortedByList(l),0!=f&&(k=k.substr(0,f)),k}return b&&(k=k.getWithoutRepetitions()),0!=f&&(k=k.splice(0,f)),k},removeAccentsAndDiacritics=function(a){var b=a.replace(new RegExp(/[àáâãäå]/g),"a");return b=b.replace(new RegExp(/æ/g),"ae"),b=b.replace(new RegExp(/ç/g),"c"),b=b.replace(new RegExp(/[èéêë]/g),"e"),b=b.replace(new RegExp(/[ìíîï]/g),"i"),b=b.replace(new RegExp(/ñ/g),"n"),b=b.replace(new RegExp(/[òóôõö]/g),"o"),b=b.replace(new RegExp(/œ/g),"oe"),b=b.replace(new RegExp(/[ùúûü]/g),"u"),b=b.replace(new RegExp(/[ýÿ]/g),"y"),b=b.replace(new RegExp(/[ÀÁÂÄÃ]/g),"A"),b=b.replace(new RegExp(/Æ/g),"AE"),b=b.replace(new RegExp(/Ç/g),"c"),b=b.replace(new RegExp(/[ÈÉÊË]/g),"E"),b=b.replace(new RegExp(/[ÌÍÎÏ]/g),"I"),b=b.replace(new RegExp(/Ñ/g),"N"),b=b.replace(new RegExp(/[ÒÓÔÖÕ]/g),"O"),b=b.replace(new RegExp(/Œ/g),"OE"),b=b.replace(new RegExp(/[ÙÚÛÜ]/g),"U"),b=b.replace(new RegExp(/[Ÿ]/g),"Y")},StringOperators.getWordsOccurrencesTable=function(a,b,c,d,e){if(null!=a){if(0==a.length)return new Table(new StringList,new NumberList);var f=StringOperators.getWords(a,!1,b,!1,c,d,e);return ListOperators.countElementsRepetitionOnList(f,!0,!1,d)}},StringOperators.indexesOf=function(a,b){var c=a.indexOf(b);if(-1==c)return new NumberList;var d=new NumberList(c);for(c=a.indexOf(b,c+1);-1!=c;)d.push(c),c=a.indexOf(b,c+1);return d},StringOperators.repeatString=function(a,b){var c,d="";for(c=0;b>c;c++)d+=a;return d},StringOperators.countOccurrences=function(a,b){for(var c=0,d=a.indexOf(b);-1!=d;)c++,d=a.indexOf(b,d+b.length);return c},StringOperators.countWordOccurrences=function(a,b){var c=new RegExp("\\b"+b+"\\b"),d=a.match(c);return null==d?0:d.length},StringOperators.countStringsOccurrences=function(a,b){var c,d=new NumberList;for(c=0;null!=b[c];c++)d[c]=a.split(b[c]).length-1;return d},StringOperators.validateEmail=function(a){return StringOperators.MAIL_REGEX.test(a)},StringOperators.validateUrl=function(a){return StringOperators.LINK_REGEX.test(a)},CanvasAndContext.createInvisibleContext=function(a,b){a=a||cW,b=b||cH;var c=document.createElement("canvas");return c.width=cW,c.height=cH,c.getContext("2d")},Draw.drawSmoothPolygon=function(a,b,c){c=null==c?30:c;var d;if(a.length<2)return null;if(2==a.length){var e=Math.atan2(a[1].y-a[0].y,a[1].x-a[0].x)-.5*Math.PI,f=c*Math.cos(e),g=c*Math.sin(e);return context.moveTo(a[0].x,a[0].y),context.bezierCurveTo(a[0].x+f,a[0].y+g,a[1].x+f,a[1].y+g,a[1].x,a[1].y),void context.bezierCurveTo(a[1].x-f,a[1].y-g,a[0].x-f,a[0].y-g,a[0].x,a[0].y)}var h,i=a.length,j=a[i-1],k=a[0],l=a[1];d=GeometryOperators.getSoftenControlPoints(j,k,l,c);var m,n=d[1];context.moveTo(k.x,k.y),j=k;var o=i+Number(b);for(h=1;o>h;h++)k=a[h%i],l=a[(h+1)%i],d=GeometryOperators.getSoftenControlPoints(j,k,l,c),m=d[0],context.bezierCurveTo(n.x,n.y,m.x,m.y,k.x,k.y),n=d[1],j=k},Draw.fillRectangleWithImage=function(a,b,c,d){null!=d&&(context.fillStyle=d,context.beginPath(),context.fillRect(a.x,a.y,a.width,a.height),context.fill());var e,f,g,h,i,j;switch(c){case 0:context.drawImage(b,a.x,a.y,a.width,a.height);break;case 1:e=.5*Math.max(b.width-a.width,0),f=.5*Math.max(b.height-a.height,0),g=a.x+.5*Math.max(a.width-b.width,0),h=a.y+.5*Math.max(a.height-b.height,0),i=Math.min(b.width,a.width),j=Math.min(b.height,a.height),context.drawImage(b,e,f,i,j,g,h,i,j);break;case 2:e=Math.max(b.width-a.width,0),f=Math.max(b.height-a.height,0),i=Math.min(b.width,a.width),j=Math.min(b.height,a.height);var k=i/j,l=b.width/b.height;l>k&&(j=i/l),k>l&&(i=j/l),g=a.x+.5*(a.width-i),h=a.y+.5*(a.height-j),context.drawImage(b,0,0,b.width,b.height,g,h,i,j);break;case 3:a.width/a.height<b.width/b.height?(sh=b.height,sw=sh*a.width/a.height,e=.5*(b.width-sw),f=0):(sw=b.width,sh=sw*a.height/a.width,e=0,f=.5*(b.height-sh)),context.drawImage(b,e,f,sw,sh,a.x,a.y,a.width,a.height);break;case 4:break;case 5:}},Draw.drawEllipse=function(a,b,c,d){var e=.5522848,f=c*e,g=d*e,h=a+c,i=b+d;context.moveTo(a-c,b),context.bezierCurveTo(a-c,b-g,a-f,b-d,a,b-d),
context.bezierCurveTo(a+f,b-d,h,b-g,h,b),context.bezierCurveTo(h,b+g,a+f,i,a,i),context.bezierCurveTo(a-f,i,a-c,b+g,a-c,b),context.moveTo(a-c,b)},Draw.drawPolygon=function(a,b,c,d){c=c||0,d=d||0;var e;for(context.moveTo(c+a[0].x,d+a[0].y),e=1;null!=a[e];e++)context.lineTo(c+a[e].x,d+a[e].y);b&&context.lineTo(c+a[0].x,d+a[0].y)},Draw.drawPolygonWithControlPoints=function(a,b,c,d){c=c||0,d=d||0;var e;for(context.moveTo(c+a[0].x,d+a[0].y),e=1;null!=a[e];e++)context.bezierCurveTo(c+b[2*(e-1)].x,d+b[2*(e-1)].y,c+b[2*e-1].x,d+b[2*e-1].y,c+a[e].x,d+a[e].y)},Draw.drawBezierPolygon=function(a,b,c){b=b||0,c=c||0;var d,e,f=Math.floor((a.length-1)/3);for(context.moveTo(b+a[0].x,c+a[0].y),e=0;f>e;e++)d=3*e+1,context.bezierCurveTo(b+a[d].x,c+a[d].y,b+a[d+1].x,c+a[d+1].y,b+a[d+2].x,c+a[d+2].y)},Draw.drawBezierPolygonTransformed=function(a,b){if(null!=a&&0!=a.length){var c,d,e,f,g=Math.floor((a.length-1)/3),h=b(a[0]);for(context.moveTo(h.x,h.y),d=0;g>d;d++)c=3*d+1,h=b(a[c]),e=b(a[c+1]),f=b(a[c+2]),context.bezierCurveTo(h.x,h.y,e.x,e.y,f.x,f.y)}},Draw.drawPolygonTransformed=function(a,b){var c=b(a[0]);for(context.moveTo(c.x,c.y),i=0;null!=a[i];i++)c=b(a[i]),context.lineTo(c.x,c.y)},Draw.drawSliderRectangle=function(a,b,c,d){context.arc(a+.5*c,b,.5*c,Math.PI,TwoPi),context.lineTo(a+c,b),context.arc(a+.5*c,b+d,.5*c,0,Math.PI),context.lineTo(a,b)},Draw.drawRoundRect=function(a,b,c,d,e){e=e||0;var f=b+d;context.moveTo(a+e,b),context.lineTo(a+c-e,b),context.quadraticCurveTo(a+c,b,a+c,b+e),context.lineTo(a+c,b+d-e),context.quadraticCurveTo(a+c,f,a+c-e,f),context.lineTo(a+e,f),context.quadraticCurveTo(a,f,a,f-e),context.lineTo(a,b+e),context.quadraticCurveTo(a,b,a+e,b)},Draw.drawEquilateralTriangle=function(a,b,c,d){d=d||0,context.moveTo(c*Math.cos(d)+a,c*Math.sin(d)+b),context.lineTo(c*Math.cos(d+2.0944)+a,c*Math.sin(d+2.0944)+b),context.lineTo(c*Math.cos(d+4.1888)+a,c*Math.sin(d+4.1888)+b),context.lineTo(c*Math.cos(d)+a,c*Math.sin(d)+b)},Draw.drawArrowTriangle=function(a,b,c){var d=a.angleToPoint(b),e=a.distanceToPoint(b);Draw.drawTriangleFromBase(a.x,a.y,c,e,d)},Draw.drawTriangleFromBase=function(a,b,c,d,e){context.moveTo(a+.5*c*Math.cos(e+.5*Math.PI),b+.5*c*Math.sin(e+.5*Math.PI)),context.lineTo(a+.5*c*Math.cos(e-.5*Math.PI),b+.5*c*Math.sin(e-.5*Math.PI)),context.lineTo(a+d*Math.cos(e),b+d*Math.sin(e)),context.lineTo(a+.5*c*Math.cos(e+.5*Math.PI),b+.5*c*Math.sin(e+.5*Math.PI))},Draw.drawHorizontalFlowPiece=function(a,b,c,d,e,f,g){context.moveTo(a,c),context.bezierCurveTo(a+g,c,b-g,e,b,e),context.lineTo(b,f),context.bezierCurveTo(b-g,f,a+g,d,a,d),context.lineTo(a,c)},Draw.drawRectangles=function(a,b,c,d,e,f,g){e=e||0;var h,i,j=2*e;if(null!=d)var k=d.length;var l=new Rectangle;for(h=0;null!=a[h];h++)i=a[h],i.height<=e||i.width<=e||(null!=d&&(context.fillStyle=d[h%k]),context.fillRect(i.x+b+e,i.y+c+e,i.width-j,i.height-j),null!=f&&null!=f[h]&&(l.x=i.x+b+e,l.y=i.y+c+e,l.width=i.width-j,l.height=i.height-j,Draw.fillRectangleWithImage(context,l,f[h],g)))},Draw.drawQuadrilater=function(a,b,c,d,e){e=null==e?!0:e,context.moveTo(a.x,a.y),context.lineTo(b.x,b.y),context.lineTo(c.x,c.y),context.lineTo(d.x,d.y),e&&context.lineTo(a.x,a.y)},Draw.drawLens=function(a,b){if(b.x<a.x){var c=b.clone();b=a.clone(),a=c}if(b.x+b.z<=a.x+a.z)return void context.arc(b.x,b.y,b.z,0,TwoPi);if(a.x-a.z>=b.x-b.z)return void context.arc(a.x,a.y,a.z,0,TwoPi);var d=GeometryOperators.circlesLensAngles(a,b);context.arc(a.x,a.y,a.z,d[0],d[1]),context.arc(b.x,b.y,b.z,d[2],d[3])},Draw.drawAndCapture=function(a,b,c){var d=context;context=hiddenContext,context.canvas.setAttribute("width",b.width),context.canvas.setAttribute("height",b.height),context.clearRect(0,0,b.width,b.height),context.translate(-b.x,-b.y),a.call(c);var e=new Image;return e.src=context.canvas.toDataURL(),context=d,e},DrawSimpleVis.drawSimpleBarChart=function(a,b,c,d){d=null==d?ColorListOperators.colorListFromColorScale(new ColorScale):d,c=null==c?new Rectangle(10,10,400,300):c;var e,f=c.width/b.length,g=c.getBottom(),h=b.getNormalizedToMax(c.height);for(e=0;null!=b[e];e++)a.fillStyle=d[e],a.fillRect(c.x+e*f,g-h[e],f-1,h[e])},DrawSimpleVis.drawIntervalsFlowTable=function(a,b,d,e,f){c.log("[!] MOVED TO IntervalTableDraw.js")},DrawSimpleVis.drawIntervalsWordsFlowTable=function(a,b,d,e,f){c.log("[!] MOVED TO IntervalTableDraw.js")},DrawSimpleVis.drawStackBarsFlowTable=function(a,b,c,d){var e,f,g=b.length;d=null==d?ColorListOperators.colorListFromColorScale(new ColorScale(ColorOperators.temperatureScale),g):d,c=null==c?new Rectangle(10,10,400,300):c;var h,i,j,k,l,m=b[0].length,n=c.width/(m-1),o=c.height,p=b[g-1],q=0,r=0,s=c.x,t=c.y;for(a.strokeStyle="white",e=0;null!=b[e];e++){for(l=b[e],q=.5*(1-p[0].y)*o+e*r+t,f=1;m>f;f++)q=.5*(1-p[f].y)*o+e*r+t,h=new Point(f*n+s,l[f].x*o+q),i=new Point((f+1)*n+s,l[f].x*o+q),j=new Point((f+1)*n+s,l[f].y*o+q),k=new Point(f*n+s,l[f].y*o+q),a.fillStyle=d[e],a.beginPath(),a.moveTo(h.x,h.y),a.lineTo(i.x,i.y),a.lineTo(j.x,j.y),a.lineTo(k.x,k.y),a.lineTo(h.x,h.y),a.fill();a.fill()}},DrawTexts.POINT_TO_PIXEL=1.3333,DrawTexts.PIXEL_TO_POINT=.75,DrawTexts.fillTextRectangle=function(a,b,c,d,e,f,g,h){var i=DrawTexts.textWordWrapReturnLines(a,d,e,f,h);return DrawTexts.fillTextRectangleWithTextLines(i,b,c,e,f,g)},DrawTexts.fillTextRotated=function(a,b,c,d){context.save(),context.translate(b,c),context.rotate(d),context.fillText(a,0,0),context.restore()},DrawTexts.fillTextRectangleWithTextLines=function(a,b,c,d,e,f){d=0==d||null==d?99999:d;for(var g=0;null!=a[g]&&(context.fillText(a[g],b,c+g*e),!((g+2)*e>d));g++);return f?a.length*e:a.length},DrawTexts.textWordWrapReturnLines=function(a,b,c,d,e){b=b||100,c=c||600,d=d||16;var f=0==d?-1:Math.floor(c/d),g=new StringList;if(0>=b)return g.push(a),g;var h,i,j,k,l,m,n=a.split(/\\n|\n/),o=0;for(h=0;h<n.length;h++)if(""!=n[h]){for(i=n[h].split(" "),j=1;i.length>0&&j<=i.length;)if(k=i.slice(0,j).join(" "),l=context.measureText(k).width,l>b){if(1==j&&(j=2),m=i.slice(0,j-1).join(" "),""!=m&&g.push(m),g.length==f){if(e){var p=g[g.length-1];context.measureText(p+"…").width<=b?g[g.length-1]+="…":(i=p.split(" "),m=i.slice(0,i.length-1).join(" ")+"…",g.push(m))}return g}o++,i=i.splice(j-1),j=1}else j++;j>0&&(m=i.join(" "),""!=m&&g.push(m)),o++}else g.push(""),o++;return g.width=1==g.length?l:b,g},DrawTexts.getMaxTextWidth=function(a){for(var b=getTextW(a[0]),c=1;null!=a[c];c++)b=Math.max(b,getTextW(a[c]));return b},DrawTexts.cropString=function(a,b,c){if(null!=b){if(c=c||0,0>=c||a.measureText(b).width<=c)return b;for(var d=b.split(""),e=1;d.length>0&&e<=d.length;){var f=d.slice(0,e).join(""),g=a.measureText(f).width;if(g>c)return 1==e&&(e=2),d.slice(0,e-1).join("");e++}}},DrawTextsAdvanced.characterOnQuadrilater=function(a,b,c,d,e,f,g){},DrawTextsAdvanced.textOnQuadrilater=function(a,b,c,d,e,f,g){if(g=null==g?0:g,1==g){var h=new Point(.5*(b.x+c.x),.5*(b.y+c.y)),i=new Point(.5*(b.x+e.x),.5*(b.y+e.y)),j=new Point(.5*(d.x+e.x),.5*(d.y+e.y)),k=new Point(.5*(c.x+d.x),.5*(c.y+d.y)),l=new Point(.5*(h.x+j.x),.5*(h.y+j.y));return DrawTextsAdvanced.textOnQuadrilater(a,b,h,l,i,f,2),DrawTextsAdvanced.textOnQuadrilater(a,h,c,k,l,f,3),DrawTextsAdvanced.textOnQuadrilater(a,l,k,d,j,f,4),void DrawTextsAdvanced.textOnQuadrilater(a,i,l,j,e,f,5)}var m=context.measureText(a),n=m.width,o=f;switch(g){case 0:var p=new Point(0,0),q=new Point(n,0),r=new Point(1e-6,o+1e-6);break;case 2:var p=new Point(0,0),q=new Point(.5*n,0),r=new Point(1e-6,.5*o+1e-6);break;case 3:var p=new Point(.5*n,0),q=new Point(n,0),r=new Point(.5*n+1e-6,.5*o+1e-6);break;case 4:var p=new Point(.5*n,.5*o),q=new Point(n,.5*o),r=new Point(.5*n+1e-6,o+1e-6);break;case 5:var p=new Point(0,.5*o),q=new Point(.5*n,.5*o),r=new Point(1e-6,o+1e-6)}context.save(),DrawTextsAdvanced.applyTransformationOnCanvasFromPoints(p,q,r,b,c,e),context.beginPath(),context.moveTo(p.x-2,p.y-2),context.lineTo(q.x+8,q.y-2),context.lineTo(r.x-2,r.y+8),context.clip(),context.fillText(a,0,0),context.restore(),p.x=q.x+1e-4,p.y=r.y+1e-4,context.save(),DrawTextsAdvanced.applyTransformationOnCanvasFromPoints(p,q,r,d,c,e),context.beginPath(),context.moveTo(p.x+4,p.y+2),context.lineTo(q.x+4,q.y-2),context.lineTo(r.x-2,r.y+2),context.clip(),context.fillText(a,0,0),context.restore()},DrawTextsAdvanced.applyTransformationOnCanvasFromPoints=function(a,b,c,d,e,f){var g=MatrixGenerators.createMatrixFromTrianglesMapping(a,b,c,d,e,f);context.transform(g.a,g.b,g.c,g.d,g.tx,g.ty)},DrawTextsAdvanced.mapRectangleIntoQuadrilater=function(a,b,c,d,e,f,g,h,i){context.save();var j=MatrixGenerators.createMatrixFromTrianglesMapping(new Point(0,0),new Point(100,0),new Point(100,100),f,g,h);context.transform(j.a,j.b,j.c,j.d,j.tx,j.ty),context.beginPath(),context.moveTo(0,0),context.lineTo(100,0),context.lineTo(100,100),context.lineTo(0,0),context.clip(),context.drawImage(a,b,c,d,e,0,0,100,100),context.restore(),context.save();var j=MatrixGenerators.createMatrixFromTrianglesMapping(new Point(0,0),new Point(0,2),new Point(2,2),f,i,h);context.transform(j.a,j.b,j.c,j.d,j.tx,j.ty),context.beginPath(),context.moveTo(0,0),context.lineTo(0,2),context.lineTo(2,2),context.lineTo(0,0),context.clip(),context.drawImage(a,b,c,d,e,0,0,2,2),context.restore()},DrawTextsAdvanced.getClippedTrianglesData=function(a,b,c,d,e){var f={};return context.clearRect(0,0,d,e),context.save(),context.beginPath(),context.moveTo(0,0),context.lineTo(d,0),context.lineTo(d,e),context.lineTo(0,0),context.clip(),context.drawImage(a,b,c,d,e,0,0,d,e),f.dataTriangle0=context.getImageData(0,0,d,e),context.restore(),context.clearRect(0,0,d,e),context.save(),context.beginPath(),context.moveTo(0,0),context.lineTo(0,e),context.lineTo(d,e),context.lineTo(0,0),context.clip(),context.drawImage(a,b,c,d,e,0,0,d,e),f.dataTriangle1=context.getImageData(0,0,d,e),context.restore(),f},DrawTextsAdvanced.typodeOnQuadrilater=function(a,b,c,d,e){var f=c.x-b.x,g=(c.y-b.y,e.y-b.y),h=d.y-c.y;if(context.lineWidth=.01+(g+h)/100,!(1.8>f))for(var i,j,k,l,m=typodeObject[a],n=0;null!=m[n];n++){for(i=m[n],context.beginPath(),k=i[0].x,l=1-k,context.moveTo(Math.floor(k*f+b.x)+.5,Math.floor(i[0].y*(l*g+k*h)+l*b.y+k*c.y)+.5),j=1;null!=i[j];j++)k=i[j].x,l=1-k,context.lineTo(Math.floor(k*f+b.x)+.5,Math.floor(i[j].y*(l*g+k*h)+l*b.y+k*c.y)+.5);context.stroke()}},fRect=function(a,b,c,d){"number"!=typeof a&&(b=a.y,c=a.width,d=a.height,a=a.x),context.fillRect(a,b,c,d)},sRect=function(a,b,c,d){"number"!=typeof a&&(b=a.y,c=a.width,d=a.height,a=a.x),context.strokeRect(a,b,c,d)},fsRect=function(a,b,c,d){"number"!=typeof a&&(b=a.y,c=a.width,d=a.height,a=a.x),context.fillRect(a,b,c,d),context.strokeRect(a,b,c,d)},fCircle=function(a,b,c){context.beginPath(),context.arc(a,b,c,0,TwoPi),context.fill()},sCircle=function(a,b,c){context.beginPath(),context.arc(a,b,c,0,TwoPi),context.stroke()},fsCircle=function(a,b,c){context.beginPath(),context.arc(a,b,c,0,TwoPi),context.fill(),context.stroke()},fEllipse=function(a,b,c,d){var e=.5522848,f=c*e,g=d*e,h=a+c,i=b+d;context.beginPath(),context.moveTo(a-c,b),context.bezierCurveTo(a-c,b-g,a-f,b-d,a,b-d),context.bezierCurveTo(a+f,b-d,h,b-g,h,b),context.bezierCurveTo(h,b+g,a+f,i,a,i),context.bezierCurveTo(a-f,i,a-c,b+g,a-c,b),context.moveTo(a-c,b),context.closePath(),context.fill()},sEllipse=function(a,b,c,d){var e=.5522848,f=c*e,g=d*e,h=a+c,i=b+d;context.beginPath(),context.moveTo(a-c,b),context.bezierCurveTo(a-c,b-g,a-f,b-d,a,b-d),context.bezierCurveTo(a+f,b-d,h,b-g,h,b),context.bezierCurveTo(h,b+g,a+f,i,a,i),context.bezierCurveTo(a-f,i,a-c,b+g,a-c,b),context.moveTo(a-c,b),context.closePath(),context.stroke()},fsEllipse=function(a,b,c,d){var e=.5522848,f=c*e,g=d*e,h=a+c,i=b+d;context.beginPath(),context.moveTo(a-c,b),context.bezierCurveTo(a-c,b-g,a-f,b-d,a,b-d),context.bezierCurveTo(a+f,b-d,h,b-g,h,b),context.bezierCurveTo(h,b+g,a+f,i,a,i),context.bezierCurveTo(a-f,i,a-c,b+g,a-c,b),context.moveTo(a-c,b),context.closePath(),context.fill(),context.stroke()},line=function(a,b,c,d){context.beginPath(),context.moveTo(a,b),context.lineTo(c,d),context.stroke()},bezier=function(a,b,c,d,e,f,g,h){context.beginPath(),context.moveTo(a,b),context.bezierCurveTo(c,d,e,f,g,h),context.stroke()},_lines=function(){if(null!=arguments){arguments=arguments[0],context.beginPath(),context.moveTo(arguments[0],arguments[1]);for(var a=2;null!=arguments[a+1];a+=2)context.lineTo(arguments[a],arguments[a+1])}},_linesM=function(){if(null!=arguments){arguments=arguments[0];var a=new Polygon;context.beginPath(),context.moveTo(arguments[0],arguments[1]),a[0]=new Point(arguments[0],arguments[1]);for(var b=2;null!=arguments[b+1];b+=2)context.lineTo(arguments[b],arguments[b+1]),a.push(new Point(arguments[b],arguments[b+1]));return a.containsPoint(mP)}},fLines=function(){_lines(arguments),context.fill()},sLines=function(){_lines(arguments),context.stroke()},fsLines=function(){_lines(arguments),context.fill(),context.stroke()},fsLinesM=function(){var a=_linesM(arguments);return context.fill(),context.stroke(),a},_polygon=function(a){context.beginPath(),context.moveTo(a[0].x,a[0].y);for(var b=1;null!=a[b];b++)context.lineTo(a[b].x,a[b].y)},fPolygon=function(a){_polygon(a),context.fill()},sPolygon=function(a,b){_polygon(a),b&&context.closePath(),context.stroke()},fsPolygon=function(a,b){_polygon(a),b&&context.closePath(),context.fill(),context.stroke()},fEqTriangle=function(a,b,c,d){_eqTriangle(a,b,c,d),context.fill()},sEqTriangle=function(a,b,c,d){_eqTriangle(a,b,c,d),context.stroke()},fsEqTriangle=function(a,b,c,d){_eqTriangle(a,b,c,d),context.fill(),context.stroke()},_eqTriangle=function(a,b,c,d){context.beginPath(),c=c||0,context.moveTo(d*Math.cos(c)+a,d*Math.sin(c)+b),context.lineTo(d*Math.cos(c+2.0944)+a,d*Math.sin(c+2.0944)+b),context.lineTo(d*Math.cos(c+4.1888)+a,d*Math.sin(c+4.1888)+b),context.lineTo(d*Math.cos(c)+a,d*Math.sin(c)+b)},fRectM=function(a,b,c,d,e){return e=null==e?0:e,context.fillRect(a,b,c,d),mY>b-e&&b+d+e>mY&&mX>a-e&&a+c+e>mX},sRectM=function(a,b,c,d,e){return e=null==e?0:e,context.strokeRect(a,b,c,d),mY>b-e&&b+d+e>mY&&mX>a-e&&a+c+e>mX},fsRectM=function(a,b,c,d,e){return e=null==e?0:e,context.fillRect(a,b,c,d),context.strokeRect(a,b,c,d),mY>b-e&&b+d+e>mY&&mX>a-e&&a+c+e>mX},fCircleM=function(a,b,c,d){return d=null==d?0:d,context.beginPath(),context.arc(a,b,c,0,TwoPi),context.fill(),Math.pow(a-mX,2)+Math.pow(b-mY,2)<Math.pow(c+d,2)},sCircleM=function(a,b,c,d){return d=null==d?0:d,context.beginPath(),context.arc(a,b,c,0,TwoPi),context.stroke(),Math.pow(a-mX,2)+Math.pow(b-mY,2)<Math.pow(c+d,2)},fsCircleM=function(a,b,c,d){return d=null==d?0:d,context.beginPath(),context.arc(a,b,c,0,TwoPi),context.stroke(),context.fill(),Math.pow(a-mX,2)+Math.pow(b-mY,2)<Math.pow(c+d,2)},lineM=function(a,b,c,d,e){return e=e||4,context.beginPath(),context.moveTo(a,b),context.lineTo(c,d),context.stroke(),_distToSegmentSquared(a,b,c,d)<e*e},_distToSegmentSquared=function(a,b,c,d){var e=Math.pow(a-c,2)+Math.pow(b-d,2);if(0===e)return Math.pow(a-mX,2)+Math.pow(b-mY,2);var f=((mX-a)*(c-a)+(mY-b)*(d-b))/e;if(0>=f)return Math.pow(a-mX,2)+Math.pow(b-mY,2);if(f>=1)return Math.pow(c-mX,2)+Math.pow(d-mY,2);var g=a+f*(c-a),h=b+f*(d-b);return Math.pow(g-mX,2)+Math.pow(h-mY,2)},bezierM=function(a,b,c,d,e,f,g,h,i){return i=null==i?2:i,context.beginPath(),context.moveTo(a,b),context.bezierCurveTo(c,d,e,f,g,h),context.stroke(),mX<Math.min(a,g,c,e)-i||mX>Math.max(a,g,c,e)+i||mY<Math.min(b,h,d,f)-i||mY>Math.max(b,h,d,f)+i?!1:GeometryOperators.distanceToBezierCurve(a,b,c,d,e,f,g,h,mP,!1)<i},drawImage=function(a){if(null!=a)switch(arguments.length){case 3:context.drawImage(a,arguments[1],arguments[2]);break;case 5:context.drawImage(a,arguments[1],arguments[2],arguments[3],arguments[4]);break;case 9:context.drawImage(a,arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8])}},fitImage=function(a,b){if(null!=a&&null!=b){var c=a.width/a.height,d=b.width/b.height,e=c/d;c>d?context.drawImage(a,.5*(a.width-a.width/e),0,a.width/e,a.height,b.x,b.y,b.width,b.height):context.drawImage(a,0,.5*(a.height-a.height*e),a.width,a.height*e,b.x,b.y,b.width,b.height)}},setFill=function(a){return"number"==typeof a?arguments.length>3?void(context.fillStyle="rgba("+arguments[0]+","+arguments[1]+","+arguments[2]+","+arguments[3]+")"):void(context.fillStyle="rgb("+arguments[0]+","+arguments[1]+","+arguments[2]+")"):void(context.fillStyle=a)},setStroke=function(a,b){return"number"==typeof a?arguments.length>3?void(context.strokeStyle="rgba("+arguments[0]+","+arguments[1]+","+arguments[2]+","+arguments[3]+")"):void(context.strokeStyle="rgb("+arguments[0]+","+arguments[1]+","+arguments[2]+")"):(context.strokeStyle=a,void(b&&(context.lineWidth=b)))},setLW=function(a){context.lineWidth=a},clipCircle=function(a,b,c){context.save(),context.beginPath(),context.arc(a,b,c,0,TwoPi,!1),context.closePath(),context.clip()},clipRectangle=function(a,b,c,d){context.save(),context.beginPath(),context.moveTo(a,b),context.lineTo(a+c,b),context.lineTo(a+c,b+d),context.lineTo(a,b+d),context.clip()},restore=function(){context.restore()},fText=function(a,b,c){context.fillText(a,b,c)},sText=function(a,b,c){context.strokeText(a,b,c)},fsText=function(a,b,c){context.strokeText(a,b,c),context.fillText(a,b,c)},fTextRotated=function(a,b,c,d){context.save(),context.translate(b,c),context.rotate(d),context.fillText(a,0,0),context.restore()},fTextM=function(a,b,c,d){return d=d||12,context.fillText(a,b,c),mY>c&&c+d>mY&&mX>b&&mX<b+context.measureText(a).width},fsTextM=function(a,b,c,d){return d=d||12,context.strokeText(a,b,c),context.fillText(a,b,c),mY>c&&c+d>mY&&mX>b&&mX<b+context.measureText(a).width},fTextRotatedM=function(a,b,c,d,e){e=e||12,context.save(),context.translate(b,c),context.rotate(d),context.fillText(a,0,0),context.restore();var f=mX-b,g=mY-c,h=Math.sqrt(f*f+g*g),i=Math.atan2(g,f)-d,j=b+h*Math.cos(i),k=c+h*Math.sin(i);return k>c&&c+e>k&&j>b&&j<b+context.measureText(a).width},fTextW=function(a,b,c){return context.fillText(a,b,c),context.measureText(a).width},setText=function(a,b,c,d,e,f){a=a||"#000000",b=String(b)||"14",c=c||LOADED_FONT,d=null==d?"left":d,e=null==e?"top":e,f=null==f?"":f,""!=f&&(f+=" "),context.fillStyle=a,context.font=f+b+"px "+c,context.textAlign=d,context.textBaseline=e},getTextW=function(a){return context.measureText(a).width},getPixelData=function(a,b){return context.getImageData(a,b,1,1).data},getPixelColor=function(a,b){var c=context.getImageData(a,b,1,1).data;return"rgba("+c[0]+","+c[1]+","+c[2]+","+c[3]+")"},getPixelColorRGBA=function(a,b){return context.getImageData(a,b,1,1).data},captureCanvas=function(){var a=new Image;return a.src=canvas.toDataURL(),a},drawAndcapture=function(a,b,c,d){var e=context;context=hiddenContext,context.canvas.setAttribute("width",b),context.canvas.setAttribute("height",c),context.clearRect(0,0,b,c),null==d?a.call():a.call(d);var f=new Image;return f.src=context.canvas.toDataURL(),context=e,f},setCursor=function(a){a=null==a?"default":a,canvas.style.cursor=a},getMilliseconds=function(){var a=new Date;return _ms=a.getTime(),delete a,_ms},DragDetection.prototype.constructor=DragDetection,DragDetection.prototype.enterframe=function(a){switch(a.mode){case 0:a.dragVector.x=(mX-a.mousePosition.x)*a.factor,a.dragVector.y=(mY-a.mousePosition.y)*a.factor,a.mousePosition.x=mX,a.mousePosition.y=mY;break;case 1:a.dragVector.x=mX-a.mouseClickPosition.x,a.dragVector.y=mY-a.mouseClickPosition.y;break;case 2:var b=mX-a.center.x,c=mY-a.center.y,d=Math.sqrt(Math.pow(b,2)+Math.pow(c,2)),e=Math.atan2(c,b);a.dragVector.x=d-a.r,a.dragVector.y=e-a.a,a.r=d,a.a=e}a.listenerFunction.call(a.target,a.dragVector)},DragDetection.prototype.onMouse=function(a){switch(a.type){case"mousedown":if(null!=this.areaVerificationFunction&&!this.areaVerificationFunction.call(this.target))return;this.dragging=!0,this.mouseClickPosition.x=mX,this.mouseClickPosition.y=mY,this.mousePosition.x=mX,this.mousePosition.y=mY;var b=mX-this.center.x,c=mY-this.center.y;this.r=Math.sqrt(Math.pow(b,2)+Math.pow(c,2)),this.a=Math.atan2(c,b),this.dragVector.x=0,this.dragVector.y=0,null!=this.idInterval&&clearInterval(this.idInterval),this.idInterval=setInterval(this.enterframe,30,this);break;case"mouseup":this.simulateMouseUp()}},DragDetection.prototype.simulateMouseUp=function(){this.dragging=!1,clearInterval(this.idInterval),this.idInterval=null},InputTextFieldHTML.prototype.constructor=InputTextFieldHTML,InputTextFieldHTML.prototype.setBorder=function(a){this.border=a,this.DOMtext.setAttribute("style","border:0; color: "+this.textColor+"; width:"+(this.width-7)+"px;height:"+(this.height-7)+"px; font-size:"+this.fontSize+"px; border:"+(a?"yes":"none"))},InputTextFieldHTML.prototype.draw=function(){(this.x!=this._prevX||this.y!=this._prevY||this.width!=this._prevWidth||this.height!=this._prevHeight||this.text!=this._prevText)&&(this._prevX=this.x,this._prevY=this.y,this._prevWidth=this.width,this._prevHeight=this.height,this._prevText=this.text,this.DOMtext.style="none",this.DOMtext.style.padding="0px",this.DOMtext.style.border="0px",this.DOMtext.style.borderColor="#FFFFFF",this.DOMtext.style.background="transparent",this.DOMtext.style.resize="none",this.DOMtext.setAttribute("style","border: 0; color: "+this.textColor+"; width:"+(this.width-7)+"px;height:"+(this.height-7)+"px; font-size:"+this.fontSize+"px"),this.div.setAttribute("style","border: 0; position:absolute;top:"+this.y+"px;left:"+this.x+"px;z-index:"+this.zIndex+";"))},InputTextFieldHTML.prototype.setText=function(a,b){b=null==b?!0:b,this.text=a,this.DOMtext.value=a,this.draw()},InputTextFieldHTML.prototype.getText=function(){return this.DOMtext.value},InputTextFieldHTML.prototype.getSelectionStart=function(){return this.DOMtext.selectionStart},InputTextFieldHTML.prototype.onKeyDown=function(a){this._eKeyDown=a,this._keyCode=a.keyCode,this.timer=setTimeout(this.onKeyDownDelayed,4,this)},InputTextFieldHTML.prototype.onKeyDownDelayed=function(a){if(13==a._keyCode&&a.DOMtext==document.activeElement&&null!=a.enterFunction&&a.enterFunction.call(a.enterFunctionTarget,a.id),a.text!=a.DOMtext.value){a.text=a.DOMtext.value;a.text.charAt(a.text.length-1);13!=a._keyCode&&null!=a.changeFunction&&a.changeFunction.call(a.changeFunctionTarget,a.id)}_cycleOnMouseMovement&&reStartCycle(),this.timer=null},InputTextFieldHTML.prototype.forceFocus=function(){this.DOMtext.focus(),this.focus=!0},InputTextFieldHTML.prototype.forceUnfocus=function(){c.log("[!] use InputTextFieldHTML.prototype.forceBlur instead"),a.push(0)},InputTextFieldHTML.prototype.forceBlur=function(){this.DOMtext.blur(),this.focus=!1},InputTextFieldHTML.prototype.setEnterFunction=function(a,b){this.enterFunction=a,this.enterFunctionTarget=b},InputTextFieldHTML.prototype.setChangeFunction=function(a,b){this.changeFunction=a,this.changeFunctionTarget=b},InputTextFieldHTML.prototype.setFocusFunction=function(a,b){this.focusFunction=a,this.focusFunctionTarget=b},InputTextFieldHTML.prototype.setBlurFunction=function(a,b){this.blurFunction=a,this.blurFunctionTarget=b},InputTextFieldHTML.prototype.setSelection=function(a,b){a=null==a?0:a,b=null==b?this.DOMtext.value.length:b,this.DOMtext.selectionStart=a,this.DOMtext.selectionEnd=b},InputTextFieldHTML.prototype.placeCursor=function(a){this.setSelection(a)},InputTextFieldHTML.prototype.setScrollPosition=function(a){1>=a&&(a=Math.floor(a*this.DOMtext.scrollHeight)),this.DOMtext.scrollTop=a},InputTextFieldHTML.prototype.getScrollPosition=function(){return this.DOMtext.scrollTop},InputTextFieldHTML.prototype.getTextHeight=function(){return this.DOMtext.scrollHeight},InputTextFieldHTML.prototype._onFocus=function(a){a.focus=!0,null!=a.focusFunction&&a.focusFunction.call(a.focusFunctionTarget,a.id)},InputTextFieldHTML.prototype._onBlur=function(a){a.focus=!1,null!=a.blurFunction&&a.blurFunction.call(a.blurFunctionTarget,a.id)},InputTextFieldHTML.prototype.remove=function(){this.added&&(this.div.removeChild(this.DOMtext),this.main.removeChild(this.div),this.added=!1)},InputTextFieldHTML.prototype.readd=function(){this.added||(this.main.appendChild(this.div),this.div.appendChild(this.DOMtext),this.added=!0)},InputTextFieldHTML.prototype.disappear=function(){c.log("[!] InputTextFieldHTML.prototype.disappear replaced by remove"),a.push(0),this.x=-1e4,this.draw()},TextBox.prototype.constructor=TextBox,TextBox.prototype.getMaxWidth=function(){return DrawTexts.getMaxTextWidth(this.lines)},TextBox.prototype.update=function(){this.setText(this.text)},TextBox.prototype.setText=function(a){this.text=String(a),this.text=TextBox.replaceWikiLinks(this.text);var b,c,d=this.text.split("<e");if(d.length>1){var e,f,g;this.links=new StringList,this.linksType=new StringList;var h,i,a,j,k,l=new List;for(b=1;null!=d[b];b++)if(e=d[b].indexOf("*"),g=d[b].indexOf(">"),f=d[b].indexOf("*",e+1),-1!=e&&-1!=g&&g>e){for(i=d[b].substr(0,e),this.links.push(i),-1!=f&&g>f&&"b"==!d[b].charAt(f+1)?(j=d[b].charAt(f+1),d[b]=d[b].substring(e+1,f)+d[b].substr(g+1),this.linksType.push("self")):(a=d[b].substring(e+1,g),k=d[b].substr(g+1),d[b]=a+k,this.linksType.push("blank")),h=d[b-1].length,h-=1*(d[b-1].split("\\n").length-1),c=0;b-1>c;c++)h+=d[c].length,h-=1*(d[c].split("\\n").length-1);l.push(new Interval(h,g-e-1))}this.text=d.join("")}else this.links=null,this.pointPairs=null;if(setText(this.fontColor,this.fontSize,this.fontName,null,null,this.fontStyle),this.lines=DrawTexts.textWordWrapReturnLines(this.text,this.width,0,this.lineHeight),this.height=this.lines.length*this.lineHeight,null!=this.links){var m,n=0;this.pointPairs=[];var o,p,q,r;for(b=0;null!=this.links[b];b++)for(m=l[b],n=0,c=0;null!=this.lines[c];c++){if(r=this.lines[c],m.x>=n&&m.x<n+r.length){o=context.measureText(r.substr(0,m.x-n)).width,p=context.measureText(r.substr(0,m.x+m.y-n)).width,q=c*this.lineHeight+.5,this.pointPairs.push({x0:o,x1:p,y:q});break}n+=r.length+1}}for(n=0,c=0;null!=this.lines[c];c++)r=this.lines[c],n+=r.length+1;for(setText(this.fontColor,this.fontSize,this.fontName,null,null,this.fontStyle),this.maxWidth=0,b=0;null!=this.lines[b];b++)this.maxWidth=Math.max(this.maxWidth,context.measureText(this.lines[b]).width)},TextBox.prototype.draw=function(a){a=null==a?1:a,null!=this.backgroundColor&&(context.fillStyle=this.backgroundColor,context.fillRect(this.x-this.boxMargin,this.y-this.boxMargin,this.width+2*this.boxMargin,this.height+2*this.boxMargin)),setText(this.fontColor,this.fontSize*a,this.fontName,null,null,this.fontStyle),DrawTexts.fillTextRectangleWithTextLines(this.lines,this.x,this.y,0,this.lineHeight*a);var b,c,d,e;if(this.overLink=null,null!=this.pointPairs){context.lineWidth=this.lineWidth,context.strokeStyle=this.fontColor;for(var f=0;null!=this.pointPairs[f];f++)b=this.pointPairs[f].x0*a+this.x,c=this.pointPairs[f].x1*a+this.x,d=this.pointPairs[f].y*a+this.y,e=Math.floor(d+Number(this.fontSize*a)),this.line(b,c,e+.5),mY>d&&e>mY&&mX>b&&c>mX&&(context.canvas.style.cursor="pointer",this.overLink=f)}},TextBox.prototype.line=function(a,b,c){context.beginPath(),context.moveTo(a,c),context.lineTo(b,c),context.stroke()},TextBox.prototype.mouseUp=function(a){if(null!=this.overLink){var b=this.links[this.overLink],c=this.linksType[this.overLink];"http://"==b.substr(0,7)||"https://"==b.substr(0,8)||"www."==b.substr(0,4)?"blank"==c?window.open(b):window.open(b,"_self"):this.warnFunction.call(this.target,b),this.overLink=null}},TextBox.prototype.deactivate=function(){removeInteractionEventListener("mouseup",this.mouseUp,this)},TextBox.replaceWikiLinks=function(a){for(var b,d,e,f,g=a.indexOf("[");-1!=g;)b=a.indexOf("]",g+1),-1==b?g=-1:(d=a.substring(g+1,b),c.log("text inside brackets: {"+d+"}"),-1==d.indexOf("[")&&-1==d.indexOf("]")&&(-1!=d.indexOf(" ")&&(e=d.split(" "),StringOperators.validateUrl(e[0])&&(a=a.substr(0,g)+"<e"+e[0]+"*"+e.slice(1).join(" ")+">"+a.substr(b+1),f=!0)),f||(a=a.substr(0,g)+"<e"+d+"*"+d+">"+a.substr(b+1))),g=a.indexOf("[",b));return a},TextFieldHTML.prototype.constructor=TextFieldHTML,TextFieldHTML.prototype.draw=function(){(this.x!=this._prevX||this.y!=this._prevY||this.width!=this._prevWidth||this.height!=this._prevHeight)&&(this._prevX=this.x,this._prevY=this.y,this._prevWidth=this.width,this._prevHeight=this.height,this.div.setAttribute("style","position:absolute;top:"+this.y+"px;left:"+this.x+"px;z-index:"+this.zIndex+"; width:"+this.width+"px; height:"+this.height+"px;"))},TextFieldHTML.prototype.setText=function(a){this.text!=a&&(this.text=a,this.div.innerHTML=this.fastHTMLactive?FastHtml.expand(a):a)},TextFieldHTML.prototype.getText=function(){return this.DOMtext.value},Loader.proxy="",Loader.cacheActive=!1,Loader.associativeByUrls={},Loader.REPORT_LOADING=!1,Loader.n_loading=0,Loader.LOCAL_STORAGE_ENABLED=!1,Loader.PHPurl="http://intuitionanalytics.com/tests/proxy.php?url=",Loader.loadData=function(a,b,d,e,f){if(Loader.REPORT_LOADING&&c.log("load data:",a),Loader.n_loading++,Loader.LOCAL_STORAGE_ENABLED){var g=LocalStorage.getItem(a);if(g){var h=new LoadEvent;h.url=a,h.param=e,h.result=g,b.call(k,h)}}Loader.REPORT_LOADING&&c.log("Loader.loadData | url:",a);var i="http"==String(a).substr(0,4),j=new XMLHttpRequest,k=d?d:arguments.callee,l=function(){if(Loader.REPORT_LOADING&&c.log("Loader.loadData | onLoadComplete"),4==j.readyState){Loader.n_loading--;var d=new LoadEvent;d.url=a,d.param=e,200==j.status||0==j.status&&null!=j.responseText?(d.result=j.responseText,b.call(k,d)):(Loader.REPORT_LOADING&&c.log("[!] There was a problem retrieving the data ["+j.status+"]:\n"+j.statusText),d.errorType=j.status,d.errorMessage="[!] There was a problem retrieving the data ["+j.status+"]:"+j.statusText,b.call(k,d))}};if(window.XMLHttpRequest&&!window.ActiveXObject)try{j=new XMLHttpRequest}catch(h){j=!1}else if(window.ActiveXObject)try{j=new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(h){try{j=new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(h){try{j=new ActiveXObject("Msxml2.XMLHTTP")}catch(h){try{j=new ActiveXObject("Microsoft.XMLHTTP")}catch(h){j=!1}}}}j&&(j.onreadystatechange=l,i?j.open("GET",Loader.proxy+a,!0):j.open("GET",a,!0),f=f||"",j.send(f))},Loader.loadImage=function(a,b,d,e){Loader.n_loading++,Loader.REPORT_LOADING&&c.log("Loader.loadImage | url:",a);var f=d?d:arguments.callee,g=document.createElement("img");if(this.cacheActive)if(null!=this.associativeByUrls[a]){Loader.n_loading--;var h=new LoadEvent;h.result=this.associativeByUrls[a],h.url=a,h.param=e,b.call(f,h)}else var i=!0,j=this.associativeByUrls;g.onload=function(){Loader.n_loading--;var c=new LoadEvent;c.result=g,c.url=a,c.param=e,i&&(j[a]=g),b.call(f,c)},g.onerror=function(){Loader.n_loading--;var c=new LoadEvent;c.result=null,c.errorType=1,c.errorMessage="There was a problem retrieving the image ["+g.src+"]:",c.url=a,c.param=e,b.call(f,c)},g.src=Loader.proxy+a},Loader.loadXML=function(a,b){function d(){Loader.n_loading--,4==e.readyState&&(200==e.status||0==e.status?f(e.responseXML):c.log("There was a problem retrieving the XML data:\n"+e.statusText))}Loader.n_loading++;var e=new XMLHttpRequest,f=b;if(Loader.REPORT_LOADING&&c.log("loadXML, url:",a),window.XMLHttpRequest&&!window.ActiveXObject)try{e=new XMLHttpRequest}catch(g){e=!1}else if(window.ActiveXObject)try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(g){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(g){e=!1}}e&&(e.onreadystatechange=d,e.open("GET",a,!0),e.send(""))},Loader.sendContentToVariableToPhp=function(a,b,c,d,e,f){var g=b+"="+encodeURIComponent(c);Loader.sendDataToPhp(a,g,d,e,f)},Loader.sendContentsToVariablesToPhp=function(a,b,c,d,e,f){for(var g=b[0]+"="+encodeURIComponent(c[0]),h=1;null!=b[h];h++)g+="&"+b[h]+"="+encodeURIComponent(c[h]);Loader.sendDataToPhp(a,g,d,e,f)},Loader.sendDataToPhp=function(a,b,d,e,f){var g=new XMLHttpRequest;g.open("POST",a,!0),g.setRequestHeader("Content-type","application/x-www-form-urlencoded"),g.send(b);var h=e?e:arguments.callee,i=function(){if(Loader.REPORT_LOADING&&c.log("Loader.loadData | onLoadComplete, req.responseText:",g.responseText),4==g.readyState){Loader.n_loading--;var b=new LoadEvent;b.url=a,b.param=f,200==g.status||0==g.status&&null!=g.responseText?(b.result=g.responseText,
d.call(h,b)):(Loader.REPORT_LOADING&&c.log("[!] There was a problem retrieving the data ["+g.status+"]:\n"+g.statusText),b.errorType=g.status,b.errorMessage="[!] There was a problem retrieving the data ["+g.status+"]:"+g.statusText,d.call(h,b))}};g.onreadystatechange=i},LoadEvent.prototype={},LoadEvent.prototype.constructor=LoadEvent,MultiLoader.prototype={},MultiLoader.prototype.constructor=MultiLoader,MultiLoader.prototype.loadDatas=function(a,b,c){this.urlList=a,this.target=c?c:arguments.callee,this.onComplete=b,this.datasLoaded=new List,this.nextDataLoading()},MultiLoader.prototype.nextDataLoading=function(){this.iLoaded<this.urlList.length?(this.indexLoading=this.iLoaded,Loader.loadData(this.urlList[this.indexLoading],this.onCompleteLoadData,this),this.loading=!0):this.loading=!1},MultiLoader.prototype.onCompleteLoadData=function(a){null!=this.priorityWeights?this.datasLoaded[this.urlList.indexOf(a.url)]=a.result:this.datasLoaded.push(a.result),this.associativeArray[this.indexLoading]=a.result;var b=new LoadEvent;b.errorType=a.errorType,b.result=this.datasLoaded,b.url=a.url,this.iLoaded+1>=this.urlList.length&&(this.loading=!1),this.onComplete.call(this.target,b),this.iLoaded++,this.nextDataLoading()},MultiLoader.prototype.loadImages=function(a,b,c,d){this.urlList=a,this.target=c?c:arguments.callee,this.onComplete=b,this.priorityWeights=d,this.imagesLoaded=new List,this.nextImageLoading()},MultiLoader.prototype.onCompleteLoadImage=function(a){1==a.errorType?(null!=this.priorityWeights?this.imagesLoaded[this.indexLoading]=null:this.imagesLoaded.push(null),this.associativeArray[this.indexLoading]=-1):(null!=this.priorityWeights?this.imagesLoaded[this.indexLoading]=a.result:this.imagesLoaded.push(a.result),this.associativeArray[this.indexLoading]=a.url,this.url_to_image[a.url]=a.result);var b=new LoadEvent;b.result=this.imagesLoaded,b.url=a.url,b.lastImage=a.result,b.indexImage=this.indexLoading,null!=this.onComplete&&this.onComplete.call(this.target,b),this.loading=!1,this.iLoaded++,this.nextImageLoading()},MultiLoader.prototype.getImageFromUrl=function(a){return this.url_to_image[a]},MultiLoader.prototype.setPriorityWeights=function(a){this.priorityWeights=a,this.loading||this.nextImageLoading()},MultiLoader.prototype.nextImageLoading=function(a){if(this.simulateDelay||null!=a)return null==a?(this.loading=!0,void(this.timer=setTimeout(this.nextImageLoading,this.DELAY_MILLISECONDS,this))):(a.loading=!1,a.simulateDelay=!1,a.nextImageLoading(),void(a.simulateDelay=!0));if(this.iLoaded<this.urlList.length)if(null!=this.priorityWeights){var b,c,d=-99999999;for(c=0;null!=this.urlList[c];c++)this.priorityWeights[c]>d&&null==this.associativeArray[c]&&(d=this.priorityWeights[c],b=c);d>0&&(this.indexLoading=b,Loader.loadImage(this.urlList[this.indexLoading],this.onCompleteLoadImage,this),this.loading=!0)}else this.indexLoading=this.iLoaded,Loader.loadImage(this.urlList[this.indexLoading],this.onCompleteLoadImage,this),this.loading=!0;else this.loading=!1},MultiLoader.prototype.destroy=function(){delete this.datasLoaded,delete this.imagesLoaded},Forces.prototype.forcesForNetwork=function(a,b,c,d,e){b=b||0,c=c||new Point(0,0),d=null==d?0:d,e=null==e?!1:e,this.forcesList=new List,this.equilibriumDistances=new NumberList,this.forcesTypeList=new List,this.fromNodeList=new NodeList,this.toNodeList=new NodeList;var f,g,h,i,j,k=a.nodeList.length,l=a.relationList;for(h=0;k>h;h++)0==b?this.addNode(a.nodeList[h],new Point(a.nodeList[h].x,a.nodeList[h].y)):(j=Math.random()*TwoPi,this.addNode(a.nodeList[h],new Point(c.x+b*Math.cos(j),c.y+b*Math.sin(j))));for(h=0;k-1>h;h++)for(f=a.nodeList[h],i=h+1;k>i;i++)if(g=a.nodeList[i],l.nodesAreConnected(f,g)){switch(d){case 0:this.equilibriumDistances.push(this.dEqSprings);break;case 1:this.equilibriumDistances.push((1.1-l.getFirstRelationByIds(f.id,g.id,!1).weight)*this.dEqSprings);break;case 2:this.equilibriumDistances.push(Math.sqrt(Math.min(f.nodeList.length,g.nodeList.length))*this.dEqSprings*.1)}this.addForce(f,g,"Spring"),e&&(this.equilibriumDistances.push(.5*this.dEqRepulsors),this.addForce(f,g,"Repulsor"))}else this.equilibriumDistances.push(this.dEqRepulsors),this.addForce(f,g,"Repulsor")},Forces.prototype.addNode=function(a,b,c){b=null==b?new Point(200*Math.random()-100,200*Math.random()-100):b,c=null==c?new Point(0,0):c,this.nodeList.addNode(a),a.x=b.x,a.y=b.y,a.vx=c.x,a.vy=c.y,a.ax=0,a.ay=0},Forces.prototype.addForce=function(a,b,c,d){this.fromNodeList.addNode(a),this.toNodeList.addNode(b),this.forcesList.push(a.id+"*"+b.id+"*"+c),this.forcesTypeList.push(c),null!=d&&this.equilibriumDistances.push(d)},Forces.prototype.calculate=function(){var a,b,c,d,e,f,g,h,i;for(this._resetAccelerations(),a=0;null!=this.forcesList[a];a++)if(b=this.fromNodeList[a],c=this.toNodeList[a],d=this.forcesTypeList[a],f=c.x-b.x,g=c.y-b.y,h=Math.sqrt(Math.pow(f,2)+Math.pow(g,2)),i=this.equilibriumDistances[a],!("Repulsor"==d&&h>i||"Attractor"==d&&i>h))switch(d){case"Spring":case"Repulsor":case"Attractor":e=this.k*(h-i)/h,b.ax+=e*f,b.ay+=e*g,c.ax-=e*f,c.ay-=e*g;break;case"DirectedSpring":e=this.k*(h-i)/h,c.ax-=e*f,c.ay-=e*g;break;case"DirectedRepulsor":i>h&&(e=this.k*(h-i)/h,c.ax-=e*f,c.ay-=e*g)}},Forces.prototype.attractionToPoint=function(a,b,c){b=null==b?1:b;var d,e,f,g,h;for(i=0;null!=this.nodeList[i];i++)d=this.nodeList[i],f=a.x-d.x,g=a.y-d.y,h=Math.pow(f,2)+Math.pow(g,2),e=null!=c?Math.min(b/h,c):b/h,d.ax+=e*f,d.ay+=e*g},Forces.prototype.avoidOverlapping=function(a){a=a||0;var b,d,e,f,g,h,i,k,l,m,n,o,p,q=.5*a,r=this.nodeList.length;for(c.log(this.nodeList.length),b=0;null!=this.nodeList[b+1];b++)for(d=this.nodeList[(b+this._i0)%r],f=d.x-.5*d.width-q,h=d.x+.5*d.width+q,g=d.y-.5*d.height-q,i=d.y+.5*d.height+q,j=b+1;null!=this.nodeList[j];j++)e=this.nodeList[(j+this._i0+b)%r],k=e.x-.5*e.width-q,m=e.x+.5*e.width+q,l=e.y-.5*e.height-q,n=e.y+.5*e.height+q,(f>k&&m>f||h>k&&m>h)&&(g>l&&n>g||i>l&&n>i)&&(o=e.x-d.x,p=e.y-d.y,Math.abs(o)>Math.abs(p)?o>0?(d.x-=.5*(h-k),e.x+=.5*(h-k)):(d.x+=.5*(m-f),e.x-=.5*(m-f)):p>0?(d.y-=.5*(i-l),e.y+=.5*(i-l)):(d.y+=.5*(n-g),e.y-=.5*(n-g)));this._i0++},Forces.prototype.avoidOverlappingRadial=function(a,b){a=a||0,b=b||1;var c,d,e,f,g,h,i,k,l=this.nodeList.length,m=2*a;for(c=0;null!=this.nodeList[c+1];c++)for(d=this.nodeList[(c+this._i0)%l],j=c+1;null!=this.nodeList[j];j++)e=this.nodeList[(j+this._i0+c)%l],f=e.x-d.x,g=e.y-d.y,h=Math.pow(f,2)+Math.pow(g,2),i=Math.pow(d.r+e.r+m,2),i>h&&(i=Math.sqrt(i),h=Math.sqrt(h),k=.5*(i-h)/h,d.x-=b*k*f,d.y-=b*k*g,e.x+=b*k*f,e.y+=b*k*g);this._i0++},Forces.prototype.applyForces=function(){var a;for(i=0;null!=this.nodeList[i];i++)a=this.nodeList[i],a.vx+=a.ax,a.vy+=a.ay,a.vx*=this.friction,a.vy*=this.friction,a.x+=a.vx,a.y+=a.vy},Forces.prototype.deactivateForcesFromNode=function(a){a.vx=a.vy=a.ax=a.ay=0},Forces.prototype.destroy=function(){delete this.k,delete this.dEqSprings,delete this.dEqRepulsors,delete this.friction,this.nodeList.destroy(),delete this.nodeList,this.forcesList.destroy(),delete this.forcesList,this.equilibriumDistances.destroy(),delete this.equilibriumDistances,this.forcesTypeList.destroy(),delete this.forcesTypeList,this.fromNodeList.destroy(),delete this.fromNodeList,this.toNodeList.destroy(),delete this.toNodeList,delete this._i0},Forces.prototype._resetAccelerations=function(){var a;for(i=0;null!=this.nodeList[i];i++)a=this.nodeList[i],a.ax=0,a.ay=0},Engine3D.prototype.constructor=Engine3D,Engine3D.prototype.setBasis=function(a){this._basis=a.clone(),this._basisBase=a.clone(),this._provisionalBase=a.clone()},Engine3D.prototype.setAngles=function(a){this._angles=a.clone(),this._freeRotation=!1,this._basis=this.basis3DRotation(this._basisBase,this._angles)},Engine3D.prototype.applyRotation=function(a){this._freeRotation||(this._freeRotation=!0,this.updateAngles(),this._provisionalBase[0]=this._basis[0].clone(),this._provisionalBase[1]=this._basis[1].clone(),this._provisionalBase[2]=this._basis[2].clone()),this._basis[0]=this.point3DRotation(this._provisionalBase[0],new Point3D(-a.y,a.x,0)),this._basis[1]=this.point3DRotation(this._provisionalBase[1],new Point3D(-a.y,a.x,0)),this._basis[2]=this.point3DRotation(this._provisionalBase[2],new Point3D(-a.y,a.x,0)),this._provisionalBase[0]=this._basis[0].clone(),this._provisionalBase[1]=this._basis[1].clone(),this._provisionalBase[2]=this._basis[2].clone()},Engine3D.prototype.projectPoint3D=function(a){var b=this.lens/(this.lens+(this._basis[0].z*a.x+this._basis[1].z*a.y+this._basis[2].z*a.z));return new Point3D((this._basis[0].x*a.x+this._basis[1].x*a.y+this._basis[2].x*a.z)*b,(this._basis[0].y*a.x+this._basis[1].y*a.y+this._basis[2].y*a.z)*b,b)},Engine3D.prototype.projectCoordinates=function(a,b,c){var d=this.lens/(this.lens+(this._basis[0].z*a+this._basis[1].z*b+this._basis[2].z*c));return new Point3D((this._basis[0].x*a+this._basis[1].x*b+this._basis[2].x*c)*d,(this._basis[0].y*a+this._basis[1].y*b+this._basis[2].y*c)*d,d)},Engine3D.prototype.projectPoint3DNode=function(a){var b=this.lens/(this.lens+(this._basis[0].z*a.x+this._basis[1].z*a.y+this._basis[2].z*a.z));return new Point3D((this._basis[0].x*a.x+this._basis[1].x*a.y+this._basis[2].x*a.z)*b,(this._basis[0].y*a.x+this._basis[1].y*a.y+this._basis[2].y*a.z)*b,b)},Engine3D.prototype.scale=function(a){return this.lens/(this.lens+(this._basis[0].z*a.x+this._basis[1].z*a.y+this._basis[2].z*a.z))},Engine3D.prototype.sortedIndexesByPointsScale=function(a){for(var b=new Array,c=0;null!=a[c];c++)b[c]=[a[c],c];UTLITARY_GLOBAL_VAR=this._basis,b=b.sort(this._sortingCriteria,this._basis),UTLITARY_GLOBAL_VAR=null;for(var d=new NumberList,c=0;null!=a[c];c++)d[c]=b[c][1];return d},Engine3D.prototype.sortListByPointsScale=function(a,b){for(var c=new Array,d=0;null!=a[d];d++)c[d]=[b[d],a[d]];UTLITARY_GLOBAL_VAR=this._basis,c=c.sort(this._sortingCriteria,this._basis),UTLITARY_GLOBAL_VAR=null;var e=instantiateWithSameType(a);e.name=a;for(var d=0;null!=a[d];d++)e[d]=c[d][1];return e},Engine3D.prototype._sortingCriteria=function(a,b,c){var d=a[0],e=b[0];return UTLITARY_GLOBAL_VAR[0].z*d.x+UTLITARY_GLOBAL_VAR[1].z*d.y+UTLITARY_GLOBAL_VAR[2].z*d.z<UTLITARY_GLOBAL_VAR[0].z*e.x+UTLITARY_GLOBAL_VAR[1].z*e.y+UTLITARY_GLOBAL_VAR[2].z*e.z?1:-1},Engine3D.prototype.updateAngles=function(){this._angles=this.getEulerAngles()},Engine3D.prototype.getEulerAngles=function(){return new Point3D(Math.atan2(-this._basis[1].z,this._basis[2].z),Math.asin(this._basis[0].z),Math.atan2(-this._basis[0].y,this._basis[0].x))},Engine3D.prototype.basis3DRotation=function(a,b){return ca=Math.cos(b.x),sa=Math.sin(b.x),cb=Math.cos(b.y),sb=Math.sin(b.y),cg=Math.cos(b.z),sg=Math.sin(b.z),new Polygon3D(new Point3D(a[0].x*cg*cb+a[0].y*(cg*sa*sb+sg*ca)+a[0].z*(sg*sa-cg*ca*sb),-a[0].x*sg*cb+a[0].y*(cg*ca-sg*sa*sb)+a[0].z*(sg*ca*sb+cg*sa),a[0].x*sb-a[0].y*sa*cb+a[0].z*cb*ca),new Point3D(a[1].x*cg*cb+a[1].y*(cg*sa*sb+sg*ca)+a[1].z*(sg*sa-cg*ca*sb),-a[1].x*sg*cb+a[1].y*(cg*ca-sg*sa*sb)+a[1].z*(sg*ca*sb+cg*sa),a[1].x*sb-a[1].y*sa*cb+a[1].z*cb*ca),new Point3D(a[2].x*cg*cb+a[2].y*(cg*sa*sb+sg*ca)+a[2].z*(sg*sa-cg*ca*sb),-a[2].x*sg*cb+a[2].y*(cg*ca-sg*sa*sb)+a[2].z*(sg*ca*sb+cg*sa),a[2].x*sb-a[2].y*sa*cb+a[2].z*cb*ca))},Engine3D.prototype.point3DRotation=function(a,b){var c=Math.cos(b.x),d=Math.sin(b.x),e=Math.cos(b.y),f=Math.sin(b.y),g=Math.cos(b.z),h=Math.sin(b.z);return new Point3D(a.x*g*e+a.y*(g*d*f+h*c)+a.z*(h*d-g*c*f),-a.x*h*e+a.y*(g*c-h*d*f)+a.z*(h*c*f+g*d),a.x*f-a.y*d*e+a.z*e*c)},Engine3D.prototype.line3D=function(a,b){var c=new Polygon,d=a,e=this.lens/(this.lens+(this._basis[0].z*d.x+this._basis[1].z*d.y+this._basis[2].z*d.z)),f=b,g=this.lens/(this.lens+(this._basis[0].z*f.x+this._basis[1].z*f.y+this._basis[2].z*f.z));if(e>0||g>0){if(e>0&&g>0)return c.push(new Point((this._basis[0].x*d.x+this._basis[1].x*d.y+this._basis[2].x*d.z)*e,(this._basis[0].y*d.x+this._basis[1].y*d.y+this._basis[2].y*d.z)*e)),c.push(new Point((this._basis[0].x*f.x+this._basis[1].x*f.y+this._basis[2].x*f.z)*g,(this._basis[0].y*f.x+this._basis[1].y*f.y+this._basis[2].y*f.z)*g)),c;var h=new Point3D(this._basis[0].x*d.x+this._basis[1].x*d.y+this._basis[2].x*d.z,this._basis[0].y*d.x+this._basis[1].y*d.y+this._basis[2].y*d.z,this._basis[0].z*d.x+this._basis[1].z*d.y+this._basis[2].z*d.z),i=new Point3D(this._basis[0].x*f.x+this._basis[1].x*f.y+this._basis[2].x*f.z,this._basis[0].y*f.x+this._basis[1].y*f.y+this._basis[2].y*f.z,this._basis[0].z*f.x+this._basis[1].z*f.y+this._basis[2].z*f.z),j=(-this.lens+this._cuttingPlane-h.z)/(i.z-h.z),k=new Point3D(h.x+j*(i.x-h.x),h.y+j*(i.y-h.y),-this.lens+this._cuttingPlane),l=this.lens/(this.lens+k.z);return e>0?(c.push(new Point(h.x*e,h.y*e)),c.push(new Point(k.x*l,k.y*l))):(c.push(new Point(k.x*l,k.y*l)),c.push(new Point(i.x*g,i.y*g))),c}return null},Engine3D.prototype.quadrilater=function(a,b,c,d){var e=new Polygon3D,f=this.line3D(a,b),g=this.line3D(b,c),h=this.line3D(c,d),i=this.line3D(d,a);return null!=f&&((null==i||f[0].x!=i[1].x&&f[0].y!=i[1].y)&&e.push(f[0]),e.push(f[1])),null!=g&&((null==f||g[0].x!=f[1].x&&g[0].y!=f[1].y)&&e.push(g[0]),e.push(g[1])),null!=h&&((null==g||h[0].x!=g[1].x&&h[0].y!=g[1].y)&&e.push(h[0]),e.push(h[1])),null!=i&&((null==h||i[0].x!=h[1].x&&i[0].y!=h[1].y)&&e.push(i[0]),e.push(i[1])),e};var TYPES_SHORT_NAMES_DICTIONARY={Null:"Ø",Object:"{}",Function:"F",Boolean:"b",Number:"#",Interval:"##",Array:"[]",List:"L",Table:"T",BooleanList:"bL",NumberList:"#L",NumberTable:"#T",String:"s",StringList:"sL",StringTable:"sT",Date:"d",DateInterval:"dd",DateList:"dL",Point:".",Rectangle:"t",Polygon:".L",RectangleList:"tL",MultiPolygon:".T",Point3D:"3",Polygon3D:"3L",MultiPolygon3D:"3T",Color:"c",ColorScale:"cS",ColorList:"cL",Image:"i",ImageList:"iL",Node:"n",Relation:"r",NodeList:"nL",RelationList:"rL",Network:"Nt",Tree:"Tr"};getTextFromObject=function(a,b){if(null==a)return"Null";if(a.isList){if(0==a.length)return"[]";var c=a.toString();if(c.length>160){var d,e;for(c="[",d=0;null!=a[d]&&6>d;d++)e=getTextFromObject(a[d],typeOf(a[d])),e.length>40&&(e=e.substr(0,40)+(a[d].isList?"…]":"…")),c+=(0!=d?", ":"")+e;a.length>6&&(c+=",…"),c+="]"}return c}switch(b){case"date":return DateOperators.dateToString(a);case"DateInterval":return DateOperators.dateToString(a.date0)+" - "+DateOperators.dateToString(a.date1);case"string":return(a.length>160?a.substr(0,159)+"…":a).replace(/\n/g,"↩");case"number":return String(a);default:return"{}"}},Date.prototype.getType=function(){return"date"},evalJavaScriptFunction=function(functionText,args,scope){if(null!=functionText){var res,myFunction,good=!0,message="",realCode,lines=functionText.split("\n");for(i=0;null!=lines[i];i++)lines[i]=lines[i].trim(),(""==lines[i]||"/"==lines[i].substr(1))&&(lines.splice(i,1),i--);var isFunction=-1!=lines[0].indexOf("function");functionText=lines.join("\n"),realCode=isFunction?scope?"scope.myFunction = "+functionText:"myFunction = "+functionText:scope?"scope.myVar = "+functionText:"myVar = "+functionText;try{isFunction?(eval(realCode),res=scope?scope.myFunction.apply(scope,args):myFunction.apply(this,args)):(eval(realCode),res=scope?scope.myVar:myVar)}catch(err){good=!1,message=err.message,res=null}var resultObject={result:res,success:good,errorMessage:message};return resultObject}};var tl=new TimeLogger("Global Time Logger");ConsoleTools._ticTime,ConsoleTools._tacTime,ConsoleTools.NumberTableOnConsole=function(a){var b,d,e,f,g="";for(f=0;f<a[0].length;f++){for(b="|",e=0;null!=a[e];e++){for(d=String(Math.floor(100*a[e][f])/100).replace(/0./,".");d.length<3;)d=" "+d;b+=d+"|"}g+=b+"\n"}return c.l(g),g},ConsoleTools.tic=function(a){a=a||"",ConsoleTools._ticTime=ConsoleTools._tacTime=(new Date).getTime(),ConsoleTools._nTacs=0,c.l("°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°° tic °°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°° ["+a+"]")},ConsoleTools.tac=function(a){a=a||"";var b=ConsoleTools._tacTime;ConsoleTools._tacTime=(new Date).getTime(),c.l("°°°°°°° tac ["+a+"], t from tic:"+(ConsoleTools._tacTime-ConsoleTools._ticTime)+", t from last tac:"+(ConsoleTools._tacTime-b))},FastHtml.expand=function(a,b,c){if(null==a||""==a)return"";if(a.split("<").length!=a.split(">").length)return a;for(var d=a,e="";null!=e;)e=StringOperators.getFirstTextBetweenStrings(d,"<fs",">"),null!=e&&(d=d.replace("<fs"+e+">",'<font style="font-size:'+Number(e)+'px">')),-1==d.indexOf(">")&&(e=null);for(e="";null!=e;)e=StringOperators.getFirstTextBetweenStrings(d,"<ff",">"),null!=e&&(d=d.replace("<ff"+e+">",'<font face="'+e+'">'));for(d=d.replace(/¬/,"<br/>"),d=d.replace(/<fcBlack>/g,'<font color="#000000">'),d=d.replace(/<fcWhite>/g,'<font color="#FFFFFF">'),d=d.replace(/<fcRed>/g,'<font color="#FF0000">'),d=d.replace(/<fcGreen>/g,'<font color="#00FF00">'),d=d.replace(/<fcBlue>/g,'<font color="#0000FF">'),d=d.replace(/<fcOrange>/g,'<font color="#FFAA00">'),d=d.replace(/<fcCyan>/g,'<font color="#00FFFF">'),d=d.replace(/<fcYellow>/g,'<font color="#FFFF00">'),d=d.replace(/<fcMagenta>/g,'<font color="#FF00FF">'),e="";null!=e;)e=StringOperators.getFirstTextBetweenStrings(d,"<fcuint",">"),null!=e&&(d=d.replace("<fcuint"+e+">",'<font color="'+ColorOperators.uinttoHEX(e)+'">'));for(e="";null!=e;)if(e=StringOperators.getFirstTextBetweenStrings(d,"<frgb",">"),null!=e){var f=e.split(".");d=d.replace("<frgb"+e+">",'<font color="'+ColorOperators.RGBtoHEX(Number(f[0]),Number(f[1]),Number(f[2]))+'">')}for(e="";null!=e;)e=StringOperators.getFirstTextBetweenStrings(d,"<fc",">"),null!=e&&(d=d.replace("<fc"+e+">",'<font color="#'+e+'">'));for(e="";null!=e;)e=StringOperators.getFirstTextBetweenStrings(d,"<tl",">"),null!=e&&(d=d.replace("<tl"+e+">",'<textformat leftmargin="'+e+'">'));for(e="";null!=e;)e=StringOperators.getFirstTextBetweenStrings(d,"<tv",">"),null!=e&&(d=d.replace("<tv"+e+">",'<textformat leading="'+e+'">'));e="";for(var g,h,i;null!=e;)e=StringOperators.getFirstTextBetweenStrings(d,"<e",">"),null!=e&&(g=e.split("*")[0],h=e.split("*")[1],i=e.split("*").length>2&&"s"==e.split("*")[2]?"_self":"_blank",d="http://"==g.substr(0,7)||"https://"==g.substr(0,8)?d.replace("<e"+e+">","<u><a href='"+g+"' target='"+i+"'>"+h+"</a></u>"):d.replace("<e"+e+">","<u><a href='javascript:FastHtml.clickLink(\""+g+"\")' FastHtml.onclick='event.preventDefault(); clickLink(\""+g+"\"); return false; '>"+h+"</a></u>"));return d=d.replace(/<pl>/g,'<p align="left">'),d=d.replace(/<pc>/g,'<p align="center">'),d=d.replace(/<pr>/g,'<p align="right">'),d=d.replace(/<pj>/g,'<p align="justify">'),d=d.replace(/<\/f>/g,"</font>"),d=d.replace(/<\/t>/g,"</textformat>")},FastHtml.clickLink=function(a){FastHtml.linkFunction.call(FastHtml.target,a)},FastHtml.findAndPlaceLinks=function(a){var b=FastHtml._findAndPlaceLinksPrefix(a,"http");return FastHtml._findAndPlaceLinksPrefix(b,"https")},FastHtml._findAndPlaceLinksPrefix=function(a,b){var c="http"==b?/http:\/\//g:/https:\/\//g,d=a.split(c);if(d.length>1){var e,f,g=[];g[0]=d[0];for(var h=1;null!=d[h];h++)e=d[h].search(/ |:|;/),e>-1?(f=b+"://"+d[h].substr(0,e),g[h]="<e"+f+"*"+f+">"+d[h].substr(e)):(f=b+"://"+d[h].substr(0),g[h]="<e"+f+"*"+f+">")}return 0==d.length||1==d.length?a:g.join("")},FastHtml.findAndPlaceTwitterAdresses=function(a){var b=a.split(/@/g);if(b.length>1){var c,d,e,f=[];f[0]=b[0];for(var g=1;null!=b[g];g++)c=b[g].search(/ |:|;/),c>-1?(e=b[g].substr(0,c),d="https://twitter.com/"+e,f[g]="<e"+d+"*@"+e+">"+b[g].substr(c)):(e=b[g].substr(0),d="https://twitter.com/"+e,f[g]="<e"+d+"*@"+e+">")}return 0==b.length||1==b.length?a:f.join("")},FastHtml.getColorTag=function(a){return a=ColorOperators.colorStringToHEX(a),'<font color="'+a+'">'},JSONUtils.stringifyAndPrint=function(a){var b=JSON.stringify(a);c.log("__________________________________________________________________________________________________________________________________________________________"),c.log(b),c.log("__________________________________________________________________________________________________________________________________________________________")},JSONUtils.dummy2=function(){return null},MD5.hex_md5=function(a){return this.rstr2hex(this.rstr_md5(this.str2rstr_utf8(a)))},MD5.b64_md5=function(a){return this.rstr2b64(this.rstr_md5(this.str2rstr_utf8(a)))},MD5.any_md5=function(a,b){return this.rstr2any(this.rstr_md5(this.str2rstr_utf8(a)),b)},MD5.hex_hmac_md5=function(a,b){return this.rstr2hex(this.rstr_hmac_md5(this.str2rstr_utf8(a),this.str2rstr_utf8(b)))},MD5.b64_hmac_md5=function(a,b){return this.rstr2b64(this.rstr_hmac_md5(this.str2rstr_utf8(a),this.str2rstr_utf8(b)))},MD5.any_hmac_md5=function(a,b,c){return this.rstr2any(this.rstr_hmac_md5(this.str2rstr_utf8(a),this.str2rstr_utf8(b)),c)},MD5.md5_vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"==this.hex_md5("abc").toLowerCase()},MD5.rstr_md5=function(a){return this.binl2rstr(this.binl_md5(this.rstr2binl(a),8*a.length))},MD5.rstr_hmac_md5=function(a,b){var c=rstr2binl(a);c.length>16&&(c=this.binl_md5(c,8*a.length));for(var d=Array(16),e=Array(16),f=0;16>f;f++)d[f]=909522486^c[f],e[f]=1549556828^c[f];var g=this.binl_md5(d.concat(this.rstr2binl(b)),512+8*b.length);return this.binl2rstr(this.binl_md5(e.concat(g),640))},MD5.rstr2hex=function(a){var b=0;try{}catch(c){b=0}for(var d,e=b?"0123456789ABCDEF":"0123456789abcdef",f="",g=0;g<a.length;g++)d=a.charCodeAt(g),f+=e.charAt(d>>>4&15)+e.charAt(15&d);return f},MD5.rstr2b64=function(a){var b="";try{}catch(c){b=""}for(var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e="",f=a.length,g=0;f>g;g+=3)for(var h=a.charCodeAt(g)<<16|(f>g+1?a.charCodeAt(g+1)<<8:0)|(f>g+2?a.charCodeAt(g+2):0),i=0;4>i;i++)e+=8*g+6*i>8*a.length?b:d.charAt(h>>>6*(3-i)&63);return e},MD5.rstr2any=function(a,b){var c,d,e,f,g,h=b.length,i=Array(Math.ceil(a.length/2));for(c=0;c<i.length;c++)i[c]=a.charCodeAt(2*c)<<8|a.charCodeAt(2*c+1);var j=Math.ceil(8*a.length/(Math.log(b.length)/Math.log(2))),k=Array(j);for(d=0;j>d;d++){for(g=Array(),f=0,c=0;c<i.length;c++)f=(f<<16)+i[c],e=Math.floor(f/h),f-=e*h,(g.length>0||e>0)&&(g[g.length]=e);k[d]=f,i=g}var l="";for(c=k.length-1;c>=0;c--)l+=b.charAt(k[c]);return l},MD5.str2rstr_utf8=function(a){for(var b,c,d="",e=-1;++e<a.length;)b=a.charCodeAt(e),c=e+1<a.length?a.charCodeAt(e+1):0,b>=55296&&56319>=b&&c>=56320&&57343>=c&&(b=65536+((1023&b)<<10)+(1023&c),e++),127>=b?d+=String.fromCharCode(b):2047>=b?d+=String.fromCharCode(192|b>>>6&31,128|63&b):65535>=b?d+=String.fromCharCode(224|b>>>12&15,128|b>>>6&63,128|63&b):2097151>=b&&(d+=String.fromCharCode(240|b>>>18&7,128|b>>>12&63,128|b>>>6&63,128|63&b));return d},MD5.str2rstr_utf16le=function(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(255&a.charCodeAt(c),a.charCodeAt(c)>>>8&255);return b},MD5.str2rstr_utf16be=function(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a.charCodeAt(c)>>>8&255,255&a.charCodeAt(c));return b},MD5.rstr2binl=function(a){for(var b=Array(a.length>>2),c=0;c<b.length;c++)b[c]=0;for(var c=0;c<8*a.length;c+=8)b[c>>5]|=(255&a.charCodeAt(c/8))<<c%32;return b},MD5.binl2rstr=function(a){for(var b="",c=0;c<32*a.length;c+=8)b+=String.fromCharCode(a[c>>5]>>>c%32&255);return b},MD5.binl_md5=function(a,b){a[b>>5]|=128<<b%32,a[(b+64>>>9<<4)+14]=b;for(var c=1732584193,d=-271733879,e=-1732584194,f=271733878,g=0;g<a.length;g+=16){var h=c,i=d,j=e,k=f;c=this.md5_ff(c,d,e,f,a[g+0],7,-680876936),f=this.md5_ff(f,c,d,e,a[g+1],12,-389564586),e=this.md5_ff(e,f,c,d,a[g+2],17,606105819),d=this.md5_ff(d,e,f,c,a[g+3],22,-1044525330),c=this.md5_ff(c,d,e,f,a[g+4],7,-176418897),f=this.md5_ff(f,c,d,e,a[g+5],12,1200080426),e=this.md5_ff(e,f,c,d,a[g+6],17,-1473231341),d=this.md5_ff(d,e,f,c,a[g+7],22,-45705983),c=this.md5_ff(c,d,e,f,a[g+8],7,1770035416),f=this.md5_ff(f,c,d,e,a[g+9],12,-1958414417),e=this.md5_ff(e,f,c,d,a[g+10],17,-42063),d=this.md5_ff(d,e,f,c,a[g+11],22,-1990404162),c=this.md5_ff(c,d,e,f,a[g+12],7,1804603682),f=this.md5_ff(f,c,d,e,a[g+13],12,-40341101),e=this.md5_ff(e,f,c,d,a[g+14],17,-1502002290),d=this.md5_ff(d,e,f,c,a[g+15],22,1236535329),c=this.md5_gg(c,d,e,f,a[g+1],5,-165796510),f=this.md5_gg(f,c,d,e,a[g+6],9,-1069501632),e=this.md5_gg(e,f,c,d,a[g+11],14,643717713),d=this.md5_gg(d,e,f,c,a[g+0],20,-373897302),c=this.md5_gg(c,d,e,f,a[g+5],5,-701558691),f=this.md5_gg(f,c,d,e,a[g+10],9,38016083),e=this.md5_gg(e,f,c,d,a[g+15],14,-660478335),d=this.md5_gg(d,e,f,c,a[g+4],20,-405537848),c=this.md5_gg(c,d,e,f,a[g+9],5,568446438),f=this.md5_gg(f,c,d,e,a[g+14],9,-1019803690),e=this.md5_gg(e,f,c,d,a[g+3],14,-187363961),d=this.md5_gg(d,e,f,c,a[g+8],20,1163531501),c=this.md5_gg(c,d,e,f,a[g+13],5,-1444681467),f=this.md5_gg(f,c,d,e,a[g+2],9,-51403784),e=this.md5_gg(e,f,c,d,a[g+7],14,1735328473),d=this.md5_gg(d,e,f,c,a[g+12],20,-1926607734),c=this.md5_hh(c,d,e,f,a[g+5],4,-378558),f=this.md5_hh(f,c,d,e,a[g+8],11,-2022574463),e=this.md5_hh(e,f,c,d,a[g+11],16,1839030562),d=this.md5_hh(d,e,f,c,a[g+14],23,-35309556),c=this.md5_hh(c,d,e,f,a[g+1],4,-1530992060),f=this.md5_hh(f,c,d,e,a[g+4],11,1272893353),e=this.md5_hh(e,f,c,d,a[g+7],16,-155497632),d=this.md5_hh(d,e,f,c,a[g+10],23,-1094730640),c=this.md5_hh(c,d,e,f,a[g+13],4,681279174),f=this.md5_hh(f,c,d,e,a[g+0],11,-358537222),e=this.md5_hh(e,f,c,d,a[g+3],16,-722521979),d=this.md5_hh(d,e,f,c,a[g+6],23,76029189),c=this.md5_hh(c,d,e,f,a[g+9],4,-640364487),f=this.md5_hh(f,c,d,e,a[g+12],11,-421815835),e=this.md5_hh(e,f,c,d,a[g+15],16,530742520),d=this.md5_hh(d,e,f,c,a[g+2],23,-995338651),c=this.md5_ii(c,d,e,f,a[g+0],6,-198630844),f=this.md5_ii(f,c,d,e,a[g+7],10,1126891415),e=this.md5_ii(e,f,c,d,a[g+14],15,-1416354905),d=this.md5_ii(d,e,f,c,a[g+5],21,-57434055),c=this.md5_ii(c,d,e,f,a[g+12],6,1700485571),f=this.md5_ii(f,c,d,e,a[g+3],10,-1894986606),e=this.md5_ii(e,f,c,d,a[g+10],15,-1051523),d=this.md5_ii(d,e,f,c,a[g+1],21,-2054922799),c=this.md5_ii(c,d,e,f,a[g+8],6,1873313359),f=this.md5_ii(f,c,d,e,a[g+15],10,-30611744),e=this.md5_ii(e,f,c,d,a[g+6],15,-1560198380),d=this.md5_ii(d,e,f,c,a[g+13],21,1309151649),c=this.md5_ii(c,d,e,f,a[g+4],6,-145523070),f=this.md5_ii(f,c,d,e,a[g+11],10,-1120210379),e=this.md5_ii(e,f,c,d,a[g+2],15,718787259),d=this.md5_ii(d,e,f,c,a[g+9],21,-343485551),c=this.safe_add(c,h),d=this.safe_add(d,i),e=this.safe_add(e,j),f=this.safe_add(f,k)}return Array(c,d,e,f)},MD5.md5_cmn=function(a,b,c,d,e,f){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(b,a),this.safe_add(d,f)),e),c)},MD5.md5_ff=function(a,b,c,d,e,f,g){return this.md5_cmn(b&c|~b&d,a,b,e,f,g)},MD5.md5_gg=function(a,b,c,d,e,f,g){return this.md5_cmn(b&d|c&~d,a,b,e,f,g)},MD5.md5_hh=function(a,b,c,d,e,f,g){return this.md5_cmn(b^c^d,a,b,e,f,g)},MD5.md5_ii=function(a,b,c,d,e,f,g){return this.md5_cmn(c^(b|~d),a,b,e,f,g)},MD5.safe_add=function(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c},MD5.bit_rol=function(a,b){return a<<b|a>>>32-b},StringUtils.stringtoXML=function(a){if(window.ActiveXObject){var b=new ActiveXObject("Microsoft.XMLDOM");b.async="false",b.loadXML(a)}else var c=new DOMParser,b=c.parseFromString(a,"text/xml");return b};var userAgent,userAgentVersion;Navigator.IE="IE",Navigator.NS="NS",Navigator.IOS="IOS",detectUserAgent=function(){/MSIE (\d+\.\d+);/.test(navigator.userAgent)&&(userAgent=Navigator.IE,userAgentVersion=Number(RegExp.$1)),null!=navigator.userAgent.match(/iPad/i)&&(userAgent=Navigator.IOS),/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)&&(userAgent=Navigator.NS,userAgentVersion=Number(RegExp.$1))},Navigator.getUserAgent=function(){return userAgent},Navigator.getUserAgentVersion=function(){return userAgentVersion},CountryListDraw.drawCountriesAsCircles=function(a,b,c,d,e,f){e=null==e?new Rectangle(-180,-90,360,180):e,f=null==f?ColorListGenerators.createColorListWithSingleColor(b.length,"rgba(100,100,100,0.6)"):f;for(var g,h=d.width/e.width,i=d.height/e.height,j=0;null!=b[j];j++)c[j]<.5||(g=b[j],a.fillStyle=f[j],a.beginPath(),a.arc(d.x+h*(g.geoCenter.x-e.x),d.getBottom()-i*(g.geoCenter.y-e.y),c[j],0,TwoPi),a.fill())},CountryListDraw.drawCountriesPolygons=function(a,b,c,d,e,f,g){d=null==d?new Rectangle(-180,-90,360,180):d,e=null==e?ColorListGenerators.createColorListWithSingleColor(b.length,"rgba(100,100,100,0.6)"):e;var h,i,j,k=c.width/d.width,l=c.height/d.height;null!=f&&(a.lineWidth=f),null!=g&&(a.strokeStyle=g);for(var m=0;null!=b[m];m++){h=b[m],i=h.polygonList,a.fillStyle=e[m];for(var n=0;null!=i[n];n++){j=i[n],a.beginPath(),a.moveTo(c.x+k*(j[0].x-d.x),c.getBottom()-l*(j[0].y-d.y));for(var o=1;null!=j[o];o++)a.lineTo(c.x+k*(j[o].x-d.x),c.getBottom()-l*(j[o].y-d.y));a.fill(),null!=f&&a.stroke()}}},CirclesVisOperators.circlesCloud=function(a,b,d){if(null==a||0==a.length)return null;d=null==d?0:d;var e=a.getNormalizedToMax().sqrt(),f=new Polygon3D;c.l("  o",a.length,e);for(var g,h,i=0,j=0,k=0,l=0,m=b.getCenter(),n=100*e[0],o=b.width/b.height,p=0;null!=e[p];p++){if(g=100*e[p],0==p)k=m.x,l=m.y,h=g;else{for(i=0,j=h+g+d+.1;CirclesVisOperators._pointInCircles(f,k,l,g,d);)j+=.1,i+=.005*j,k=m.x+o*j*Math.cos(i),l=m.y+j*Math.sin(i);n=Math.max(n,o*j+100*e[p])}f[p]=new Point3D(k,l,g)}var q;for(o=.5*b.width/(n+.001),p=0;null!=f[p];p++)q=f[p],q.x=m.x+(q.x-m.x)*o,q.y=m.y+(q.y-m.y)*o,q.z*=o;return f},CirclesVisOperators._pointInCircles=function(a,b,c,d,e){for(var f,g=0;null!=a[g];g++)if(f=a[g],Math.pow(f.x-b,2)+Math.pow(f.y-c,2)<Math.pow(f.z+d+e,2))return!0;return!1},ColorsDraw.drawColorScaleLegend=function(a,b,c,d){var e=null==a.memory||a.width!=a.memory.w||a.height!=a.memory.h||b!=a.memory.cS||c!=a.memory.min||d!=a.memory.max;if(e){a.memory={w:a.width,h:a.height,cS:b,min:c,max:d};var f=document.createElement("canvas");f.width=a.width,f.height=a.height;var g=f.getContext("2d");g.clearRect(0,0,a.width,a.height);var h=context;context=g;var i;if(a.width>a.height){for(i=0;i<a.width;i+=2)setFill(b(i/a.width)),fRect(i,0,2,a.height);setStroke("rgba(0,0,0,0.8)",3),null!=c&&(setText("white",12,null,"left","middle"),fsText(c,2,.5*a.height)),null!=d&&(setText("white",12,null,"right","middle"),fsText(d,a.width-2,.5*a.height))}else for(i=0;i<a.height;i+=2)setFill(b(i/a.height)),fRect(0,i,a.width,2);context=h,a.memory.image=new Image,a.memory.image.src=f.toDataURL()}a.memory.image&&drawImage(a.memory.image,a.x,a.y)},ImageDraw.drawImage=function(a,b,c){c=c||0,Draw.fillRectangleWithImage(a,b,c)},ImageDraw.captureVisualizationImage=function(a,b,d){if(c.log("visFunctionName",a),!(null==a||null==b||!b>0||null==d)&&d>0){var e=new Rectangle(0,0,b,d),f=Array.prototype.slice.call(arguments);f=[e].concat(f.slice(3));var g;if(-1==a.indexOf("."))g=this[a];else{if(c.log(a.split(".")[0],this[a.split(".")[0]],this.mY),null==this[a.split(".")[0]])return;g=this[a.split(".")[0]][a.split(".")[1]]}if(null==g)return null;c.log("ImageDraw.captureVisualizationImage | args",f),c.log("ImageDraw.captureVisualizationImage | visFunction==null",null==g);var h=document.createElement("canvas");h.width=b,h.height=d;var i=h.getContext("2d");i.clearRect(0,0,b,d);var j=context;context=i,g.apply(this,f),context=j;var k=new Image;return k.src=h.toDataURL(),k}},ListDraw.drawList=function(a,b,c,d,e,f,g){if(!(null==b||!b.length>0)){e=e||14,c=null==c?0:c,null==a.memory&&(a.memory={selected:0,y:0,multiSelected:new List});var h=a.memory.list!=b,i=h&&null!=g||a.memory.selectedInit!=g;i&&(3==c?(a.memory.multiSelected=new List,g.forEach(function(c){a.memory.multiSelected.push(b[c])})):2==c?a.memory.multiSelected=List.fromArray(g).getImproved():a.memory.selected=g,a.memory.selectedInit=g),h&&(a.memory.list=b);var j,k,l,m,n,o,p=a.x+5,q=p+(d?15:0),r=e+4,s=b.length,t=a.getBottom(),u=a.containsPoint(mP),v=0,w=2==c||3==c,x=b.length*r;for(x<=a.height-20?l=a.y+10:(v=u?Math.min(10-(x-a.height+20)*((mY-(a.y+10))/(a.height-20)),10):10-(x-a.height+20)*a.memory.selected/b.length,a.memory.y=.95*a.memory.y+.05*v,l=a.y+a.memory.y),setText("black",e),j=0;null!=b[j];j++)if(k=l+r*j,!(k<a.y)){if(k+12>t)break;-1!=c?(n=a.memory.multiSelected.indexOf(j),o=w&&-1!=n,m=w?o:a.memory.selected==j,m?(setFill("black"),fRect(a.x+2,k,a.width-4,r),setFill("white")):setFill("black"),fText(b[j].toString(),q,k+2),u&&mY>=k&&k+r>mY&&(setFill("rgba(150,150,150,0.3)"),fRectM(a.x+2,k,a.width-4,r)&&setCursor("pointer"),MOUSE_DOWN&&(w?o?a.memory.multiSelected=a.memory.multiSelected.getWithoutElementAtIndex(n):(a.memory.multiSelected=a.memory.multiSelected.clone(),
a.memory.multiSelected.push(2==c?j:b[j]),a.memory.multiSelected=a.memory.multiSelected.getImproved()):a.memory.selected=j))):setFill("black"),d&&(setFill(null==d?"rgb(200, 200, 200)":d[j%s]),fRect(p,k+4,10,10))}return 1==c?b[a.memory.selected]:w?a.memory.multiSelected:a.memory.selected}},IntervalTableDraw.MIN_CHARACTERS_SIZE=1,IntervalTableDraw.drawIntervalsFlowTable=function(a,b,c,d,e){b=null==b?new Rectangle(10,10,400,300):b,c=null==c?ColorListGenerators.createCategoricalColors(0,a.length,ColorScales.temperature):c,d=d||!1,e=null==e?.45:e;var f,g,h,i,j,k,l=a.length,m=a[0].length,n=b.width/(m-1),o=b.height,p=(a[l-1],0),q=b.x,r=b.y;for(f=0;null!=a[f];f++){for(i=a[f],context.fillStyle=c[f],context.beginPath(),p=r,h=new Point(q,i[0].y*o+p),context.moveTo(h.x,h.y),j=h,g=1;m>g;g++)p=r,h=new Point(g*n+q,i[g].y*o+p),d?(k=(h.x-j.x)*e,context.bezierCurveTo(j.x+k,j.y,h.x-k,h.y,h.x,h.y)):context.lineTo(h.x,h.y),j=h;for(h=new Point((m-1)*n+q,i[m-1].x*o+p),context.lineTo(h.x,h.y),j=h,g=m-2;g>=0;g--)p=r,h=new Point(g*n+q,i[g].x*o+p),d?(k=(h.x-j.x)*e,context.bezierCurveTo(j.x+k,j.y,h.x-k,h.y,h.x,h.y)):context.lineTo(h.x,h.y),j=h;h=new Point(q,i[0].x*o+p),context.lineTo(h.x,h.y),context.fill()}},IntervalTableDraw._isOnShape=function(a,b,c,d,e,f,g){var h=(f-a.x)/(b.x-a.x),i=1-h;this.p0.x=a.x+h*e,this.p0.y=a.y,this.p1.x=i*(a.x+e)+h*(b.x-e),this.p1.y=i*a.y+h*b.y,this.p2.x=b.x-i*e,this.p2.y=b.y,this.P0.x=i*this.p0.x+h*this.p1.x,this.P0.y=i*this.p0.y+h*this.p1.y,this.P1.x=i*this.p1.x+h*this.p2.x,this.P1.y=i*this.p1.y+h*this.p2.y;var j=i*this.P0.y+h*this.P1.y;this.p0.y=c,this.p1.y=i*c+h*d,this.p2.y=d,this.P0.y=i*this.p0.y+h*this.p1.y,this.P1.y=i*this.p1.y+h*this.p2.y;var k=i*this.P0.y+h*this.P1.y;return g>k&&j>g},IntervalTableDraw.drawCircularIntervalsFlowTable=function(a,b,c,d,e,f,g,h,i){var j,k,l=a.length;e=null==e?ColorListOperators.colorListFromColorScale(new ColorScale(ColorOperators.temperatureScale),l):e,b=null==b?new Point(100,100):b,c=null==c?200:c,d=null==d?10:d,i=null==i?0:i;var m,n,o,p,q,r,s,t,p,u,v=a[0].length,w=TwoPi/v,x=c-d,y=(a[l-1],.3*w),z=Math.cos(y),A=-1,B=[],C=[],D=[],E=[],F=[];for(j=0;l>j;j++){for(n=a[j],context.fillStyle=e[j%l],context.beginPath(),m=new Point(null==h?0:h[0]+i,(1-n[0].y)*x+d),context.moveTo(m.y*Math.cos(m.x)+b.x,m.y*Math.sin(m.x)+b.y),r=m,k=1;v>=k;k++)o=n[k%v],m=new Point(null==h?k*w:h[k%v]+i,(1-o.y)*x+d),s=r.y/z,t=m.y/z,context.bezierCurveTo(s*Math.cos(r.x+y)+b.x,s*Math.sin(r.x+y)+b.y,t*Math.cos(m.x-y)+b.x,t*Math.sin(m.x-y)+b.y,m.y*Math.cos(m.x)+b.x,m.y*Math.sin(m.x)+b.y),g&&-1==A&&this._isOnRadialShape(b,mP,r.x,m.x,x*(1-n[(k-1)%v].y)+d,x*(1-n[(k-1)%v].x)+d,x*(1-n[k%v].y)+d,x*(1-n[k%v].x)+d)&&(A=j),r=m,null!=f&&(p=o.getAmplitude(),q=Math.min(3*Math.sqrt(p*c),28),q>=8&&(u=m.y+.5*p*x,E.push(q),F.push(m.x+.5*Math.PI),C.push(u*Math.cos(m.x)+b.x),D.push(u*Math.sin(m.x)+b.y),B.push(f[j])));for(m=new Point(null==h?0:h[0]+i,(1-n[0].x)*x+d),context.lineTo(m.y*Math.cos(m.x)+b.x,m.y*Math.sin(m.x)+b.y),r=m,k=v-1;k>=0;k--)m=new Point(null==h?k*w:h[k]+i,(1-n[k].x)*x+d),s=r.y/z,t=m.y/z,context.bezierCurveTo(s*Math.cos(r.x-y)+b.x,s*Math.sin(r.x-y)+b.y,t*Math.cos(m.x+y)+b.x,t*Math.sin(m.x+y)+b.y,m.y*Math.cos(m.x)+b.x,m.y*Math.sin(m.x)+b.y),r=m;m=new Point(null==h?0:h[0]+i,(1-n[0].x)*x+d),context.lineTo(m.y*Math.cos(m.x)+b.x,m.y*Math.sin(m.x)+b.y),context.fill()}for(j=0;null!=B[j];j++)setText("black",E[j],null,"center","middle"),fTextRotated(B[j],C[j],D[j],F[j]);return A},IntervalTableDraw._isOnRadialShape=function(a,b,c,d,e,f,g,h){c>d&&(d+=TwoPi);var i=a.angleToPoint(b);if(0>i&&(i+=TwoPi),i>TwoPi&&(i-=TwoPi),d>i+TwoPi&&(i+=TwoPi),i-TwoPi>c&&(i-=TwoPi),c>i||i>d)return!1;var j=d-c,k=(i-c)/j,l=GeometryOperators.bezierCurvePoints(c,e,c+.5*j,e,d-.5*j,g,d,g,k),m=GeometryOperators.bezierCurvePoints(c,f,c+.25*j,f,d-.25*j,h,d,h,k);return r=b.subtract(a).getNorm(),r>l.y&&r<m.y},IntervalTableDraw.drawIntervalsWordsFlowTable=function(a,b,c,d,e){var f,g,h=b.length;d=null==d?ColorListGenerators.createCategoricalColors(0,b.length,ColorScales.temperature):d,a=null==a?new Rectangle(10,10,400,300):a;var i,j,k,l,m,n,o,p=b[0].length,q=a.width/(p-1),r=a.height,s=new Point,t=new Point,u=b[h-1],v=0,w=a.x,x=a.y;e||(context.strokeStyle="rgba(255,255,255,0.4)"),context.textBaseline="top",context.textAlign="left";var y,z,A,B,C,D,E,F,G,H,n,I,J,K=q,L=(p-1)/a.width;for(f=0;null!=b[f];f++){m=b[f],o=" "+c[f],z=0,E=0,y=0,g=0,A=0,v=.5*(1-u[0].y)*r+x,i=new Point(w,m[0].x*r+v),j=new Point(w,m[0].y*r+v);do E++,l=j.y-i.y,H=Math.floor(.3*l+1),e||(context.font=H+"px "+LOADED_FONT),F=o.charAt(E%o.length),G=e?H*widthsTypode[F]:context.measureText(F).width+2,K=.9*G||1,z+=K,y=L*z,g=Math.floor(y),A=y-g,g+2>p||(I=g/L,J=(g+1)/L,n=.45*L,B=IntervalTableDraw._bezierValue(I,J,u[g].y,u[g+1].y,A,n),prevsY=v,v=.5*(1-B)*r+x,s.x=i.x,s.y=i.y,t.x=j.x,t.y=j.y,C=IntervalTableDraw._bezierValue(I,J,m[g].x,m[g+1].x,A,n),D=IntervalTableDraw._bezierValue(I,J,m[g].y,m[g+1].y,A,n),i=new Point(z+w,C*r+v),j=new Point(z+w,D*r+v),k=new Point(s.x+.5*K,.25*(i.y+j.y+s.y+t.y)),e?context.strokeStyle=d[f]:context.fillStyle=d[f],l>IntervalTableDraw.MIN_CHARACTERS_SIZE&&(e?DrawTextsAdvanced.typodeOnQuadrilater(F,s,i,j,t):(context.save(),context.globalAlpha=l/15,DrawTextsAdvanced.textOnQuadrilater(context,F,s,i,j,t,H,1),context.restore())));while(p>g+1)}},IntervalTableDraw._bezierValue=function(a,b,c,d,e,f){var g=1-e,h=new Point(a+e*f,c),i=new Point(g*(a+f)+e*(b-f),g*c+e*d),j=new Point(b-g*f,d),k=new Point(g*h.x+e*i.x,g*h.y+e*i.y),l=new Point(g*i.x+e*j.x,g*i.y+e*j.y);return g*k.y+e*l.y},NumberTableDraw.drawNumberTable=function(a,b,c,d,e){if(null==a||null==b||null==b.type||"NumberTable"!=b.type||b.length<2)return null;c=null==c?ColorScales.blueToRed:c,d=d||!1,e=null==e?2:e;var f,g,h,i,j,k,l,m=a.width/b.length,n=a.height/b[0].length;d||(k=b.getMinMaxInterval(),l=k.getAmplitude());var o;for(f=0;null!=b[f];f++)for(h=b[f],i=Math.round(a.x+f*m),o=mX>i&&i+m>=mX,d&&(k=h.getMinMaxInterval(),l=k.getAmplitude()),g=0;null!=h[g];g++)context.fillStyle=c((h[g]-k.x)/l),context.fillRect(i,Math.round(a.y+g*n),Math.ceil(m)-e,Math.ceil(n)-e),o&&mY>a.y+g*n&&mY<=a.y+(g+1)*n&&(j=new Point(f,g));return j},NumberTableDraw.drawSimpleScatterPlot=function(a,b,c,d,e,f,g){if(!(null==a||null==b||"NumberTable"!=b.type||b.length<2||0==b[0].length||0==b[1].length||b.length<2)){e=e||20,f=f||!1,g=g||0;var h=new Rectangle(a.x+g,a.y+g,a.width-2*g,a.height-2*g);h.bottom=h.getBottom();var i,j,k,l,m=(f?b[0].log(1):b[0]).getNormalized(),n=(f?b[1].log(1):b[1]).getNormalized(),o=b.length<=2?null:b[2].getNormalized().sqrt().factor(e),p=null==d?null:d.length,q=Math.min(m.length,n.length,null==o?3e5:o.length,null==c?3e5:c.length);for(i=0;q>i;i++)j=h.x+m[i]*h.width,k=h.bottom-n[i]*h.height,null==o?NumberTableDraw._drawCrossScatterPlot(j,k,null==d?"rgb(150,150,150)":d[i%p])&&(l=i):(setFill(null==d?"rgb(150,150,150)":d[i%p]),fCircleM(j,k,o[i],o[i]+1)&&(l=i)),null!=c&&(setText("black",10),fText(c[i],j,k));return g>7&&""!=m.name&&""!=n.name&&(setText("black",10,null,"right","middle"),fText(m.name,h.getRight()-2,h.bottom+.5*g),fTextRotated(n.name,h.x-.5*g,h.y+1,-HalfPi)),null!=l?(setCursor("pointer"),l):void 0}},NumberTableDraw._drawCrossScatterPlot=function(a,b,c){return setStroke(c,1),line(a,b-2,a,b+2),line(a-2,b,a+2,b),Math.pow(mX-a,2)+Math.pow(mY-b,2)<25},NumberTableDraw.drawSlopeGraph=function(a,b,c){if(null!=a&&null!=b&&"NumberTable"==b.type&&!(b.length<2)){var d=16,e=new Rectangle(a.x+d,a.y+d,a.width-2*d,a.height-2*d);e.bottom=e.getBottom();var f,g,h,i=b[0].getNormalized(),j=b[1].getNormalized(),k=Math.min(i.length,j.length,null==c?2e3:c.length),l=e.x+(null==c?10:.25*e.width),m=e.getRight()-(null==c?10:.25*e.width);for(setStroke("black",1),f=0;k>f;f++)g=e.bottom-i[f]*e.height,h=e.bottom-j[f]*e.height,line(l,g,m,h),null!=c&&e.bottom-g>=9&&(setText("black",9,null,"right","middle"),fText(c[f],l-2,g)),null!=c&&e.bottom-h>=9&&(setText("black",9,null,"left","middle"),fText(c[f],m+2,h))}},NumberTableDraw.drawDensityMatrix=function(a,b,c,d){if(null!=b&&null!=b[0]){c=null==c?ColorScales.whiteToRed:"string"==typeof c?ColorScales[c]:c,d=d||0;var e,f,g,h,i,j,k;if(null==a.memory||b!=a.memory.coordinates||c!=a.memory.colorScale){var l=null==b[0].x;if(l){var m=b;if(null==m||m.length<2||"NumberTable"!=m.type)return}else var n=b;var o=0,p=0,q=0,r=new NumberTable,s=l?m[0].length:n.length;if(k=new Table,l)i=m[0].getMin(),j=m[1].getMin();else for(i=n[0].x,j=n[0].y,e=1;s>e;e++)i=Math.min(n[e].x,i),j=Math.min(n[e].y,j);for(e=0;s>e;e++)l?(g=Math.floor(m[0][e]-i),h=Math.floor(m[1][e]-j)):(g=Math.floor(n[e].x-i),h=Math.floor(n[e].y-j)),null==r[g]&&(r[g]=new NumberList),null==r[g][h]&&(r[g][h]=0),r[g][h]++,o=Math.max(o,r[g][h]),p=Math.max(p,g+1),q=Math.max(q,h+1);for(e=0;p>e;e++)for(null==r[e]&&(r[e]=new NumberList),k[e]=new ColorList,f=0;q>f;f++)null==r[e][f]&&(r[e][f]=0),k[e][f]=c(r[e][f]/o);a.memory={matrixColors:k,coordinates:b,colorScale:c,selected:null}}else k=a.memory.matrixColors;var t=new Rectangle(a.x+d,a.y+d,a.width-2*d,a.height-2*d);t.bottom=t.getBottom();var u=t.width/k.length,v=t.height/k[0].length,w=a.memory.selected;for(MOUSE_UP_FAST&&(a.memory.selected=null),e=0;null!=k[e];e++)for(f=0;null!=k[0][f];f++)setFill(k[e][f]),fRectM(t.x+e*u,t.bottom-(f+1)*v,u+.5,v+.5)&&MOUSE_UP_FAST&&(a.memory.selected=[e,f]);if(a.memory.selected&&(setStroke("white",5),sRect(t.x+a.memory.selected[0]*u-1,t.bottom-(a.memory.selected[1]+1)*v-1,u+1,v+1),setStroke("black",1),sRect(t.x+a.memory.selected[0]*u-1,t.bottom-(a.memory.selected[1]+1)*v-1,u+1,v+1)),w!=a.memory.selected)if(null==a.memory.selected)a.memory.indexes=null;else for(i=m[0].getMin(),j=m[1].getMin(),g=a.memory.selected[0]+i,h=a.memory.selected[1]+j,a.memory.indexes=new NumberList,e=0;null!=m[0][e];e++)m[0][e]==g&&m[1][e]==h&&a.memory.indexes.push(e);return a.memory.selected?a.memory.indexes:void 0}},NumberTableDraw.drawStreamgraph=function(a,b,c,d,e,f,g,h,i,j){if(!(null==b||b.length<2||"NumberTable"!=b.type)){if(f=null==f?!0:f,e=null==e?1:e,null==a.memory||b!=a.memory.numberTable||c!=a.memory.normalized||d!=a.memory.sorted||e!=a.memory.intervalsFactor||f!=a.memory.bezier||a.width!=a.memory.width||a.height!=a.memory.height||j!=a.memory.logFactor){var k=j?b.applyFunction(function(a){return Math.log(j*a+1)}):b;a.memory={numberTable:b,normalized:c,sorted:d,intervalsFactor:e,bezier:f,flowIntervals:IntervalTableOperators.scaleIntervals(NumberTableFlowOperators.getFlowTableIntervals(k,c,d),e),fOpen:1,names:b.getNames(),mXF:mX,width:a.width,height:a.height,logFactor:j,image:null}}g&&a.memory.colorList!=g&&(a.memory.image=null),(a.memory.colorList!=g||null==a.memory.colorList)&&(a.memory.actualColorList=null==g?ColorListGenerators.createDefaultCategoricalColorList(b.length,.7):g,a.memory.colorList=g);var l=new Rectangle(0,0,a.width,null==h?a.height:a.height-14);if(null==a.memory.image){var m=document.createElement("canvas");m.width=a.width,m.height=a.height;var n=m.getContext("2d");n.clearRect(0,0,a.width,a.height);var o=context;context=n,IntervalTableDraw.drawIntervalsFlowTable(a.memory.flowIntervals,l,a.memory.actualColorList,f,.3),context=o,a.memory.image=new Image,a.memory.image.src=m.toDataURL()}if(a.memory.image)if(a.memory.fOpen=.8*a.memory.fOpen+.2*(a.containsPoint(mP)?.8:1),a.memory.mXF=.7*a.memory.mXF+.3*mX,a.memory.mXF=Math.min(Math.max(a.memory.mXF,a.x),a.getRight()),a.memory.fOpen<.999){context.save(),context.translate(a.x,a.y);var p=a.memory.mXF-a.x,q=Math.floor(p*a.memory.fOpen),r=Math.ceil(a.width-(a.width-p)*a.memory.fOpen);drawImage(a.memory.image,0,0,p,l.height,0,0,q,l.height),drawImage(a.memory.image,p,0,a.width-p,l.height,r,0,(a.width-p)*a.memory.fOpen,l.height),NumberTableDraw._drawPartialFlow(l,a.memory.flowIntervals,a.memory.names,a.memory.actualColorList,p,q,r,.3,d,i?b:null),context.restore()}else drawImage(a.memory.image,a.x,a.y,a.width,a.height);h&&NumberTableDraw._drawHorizontalLabels(a,a.getBottom()-5,b,h,q,r)}},NumberTableDraw._drawHorizontalLabels=function(a,b,c,d,e,f){var g,h=a.width/(c[0].length-1),i=Math.min(Math.max(mX,a.x+1),a.getRight()-1),j=(i-a.x)/h,k=Math.round(j);e=null==e?a.x:e+a.x,f=null==f?a.x:f+a.x,d.forEach(function(c,l){setText("black",l==k&&f>e+4?14:10,null,"center","middle"),e>f-5?g=a.x+l*h:k==l?g=.5*(e+f)-(f-e)*(j-k):(g=a.x+l*h,i>g?g=a.x+l*h*a.memory.fOpen:g>i&&(g=a.x+l*h*a.memory.fOpen+(f-e))),fText(d[l],g,b)})},NumberTableDraw._drawPartialFlow=function(a,b,c,d,e,f,g,h,i,j){var k,l,m,n,o,p,q,r,s,t,u,v,w,x=g-f,y=null==j?g-f:.85*(g-f),z=b[0].length,A=a.width/(z-1),B=(e-a.x)/A,B=Math.max(Math.min(B,z-1),0),C=Math.floor(B),D=Math.ceil(B),E=h*A,F=-1;for(k=0;null!=b[k];k++)setFill(d[k]),l=b[k][C],m=b[k][D],s=Math.floor(B)*A,t=Math.floor(B+1)*A,u=e,n=GeometryOperators.trueBezierCurveHeightHorizontalControlPoints(s,t,l.x,m.x,s+E,t-E,u),o=GeometryOperators.trueBezierCurveHeightHorizontalControlPoints(s,t,l.y,m.y,s+E,t-E,u)-n,n=n*a.height+a.y,o*=a.height,fRectM(f,n,x,o)&&(F=k),o>=5&&x>40&&(setText("white",o,null,null,"middle"),r=c[k],p=getTextW(r),q=p/y,q>1&&setText("white",o/q,null,null,"middle"),context.fillText(r,f,n+.5*o),j&&(p=getTextW(r),v=Math.min(o,o/q),w=Math.max(.6*v,8),setText("white",w,null,null,"middle"),fText(Math.round(j[k][C]),f+p+.03*x,n+.5*(o+.5*(v-w)))));return F},NumberTableDraw.drawCircularStreamgraph=function(a,b,c,d,e,f,g){if(!(null==b||b.length<2||b[0].length<2||"NumberTable"!=b.type)){if(e=null==e?1:e,null==a.memory||b!=a.memory.numberTable||c!=a.memory.normalized||d!=a.memory.sorted||e!=a.memory.intervalsFactor||a.width!=a.memory.width||a.height!=a.memory.height){a.memory={numberTable:b,normalized:c,sorted:d,intervalsFactor:e,flowIntervals:IntervalTableOperators.scaleIntervals(NumberTableFlowOperators.getFlowTableIntervals(b,c,d),e),fOpen:1,names:b.getNames(),mXF:mX,width:a.width,height:a.height,radius:.46*Math.min(a.width,a.height)-(null==g?0:8),r0:.05*Math.min(a.width,a.height),angles:new NumberList,zoom:1,angle0:0,image:null};var h=TwoPi/b[0].length;b[0].forEach(function(b,c){a.memory.angles[c]=c*h})}(a.memory.colorList!=f||null==a.memory.colorList)&&(a.memory.actualColorList=null==f?ColorListGenerators.createDefaultCategoricalColorList(b.length,.4):f,a.memory.colorList=f);var i=a.containsPoint(mP);if(i&&(MOUSE_DOWN&&(a.memory.downX=mX,a.memory.downY=mY,a.memory.pressed=!0,a.memory.zoomPressed=a.memory.zoom,a.memory.anglePressed=a.memory.angle0),a.memory.zoom*=1-.4*WHEEL_CHANGE),MOUSE_UP&&(a.memory.pressed=!1),a.memory.pressed){var j=a.getCenter(),k=a.memory.downX-j.x,l=a.memory.downY-j.y,m=Math.sqrt(Math.pow(k,2)+Math.pow(l,2)),n=mX-j.x,o=mY-j.y,p=Math.sqrt(Math.pow(n,2)+Math.pow(o,2));a.memory.zoom=a.memory.zoomPressed*((p+5)/(m+5));var q=Math.atan2(l,k),r=Math.atan2(o,n);a.memory.angle0=a.memory.anglePressed+r-q}i&&(a.memory.image=null);var s=null==a.memory.image&&!i,t=!i&&null!=a.memory.image&&!s;if(t)drawImage(a.memory.image,a.x,a.y,a.width,a.height);else{if(s){var u=document.createElement("canvas");u.width=a.width,u.height=a.height;var v=u.getContext("2d");v.clearRect(0,0,a.width,a.height);var w=context;context=v;var x=a.x,y=a.y;a.x=0,a.y=0,setFill("white"),fRect(0,0,a.width,a.height)}if(context.save(),clipRectangle(a.x,a.y,a.width,a.height),IntervalTableDraw.drawCircularIntervalsFlowTable(a.memory.flowIntervals,a.getCenter(),a.memory.radius*a.memory.zoom,a.memory.r0,a.memory.actualColorList,a.memory.names,!0,a.memory.angles,a.memory.angle0),context.restore(),g){var z,A=a.memory.radius*a.memory.zoom+8;setText("black",14,null,"center","middle"),g.forEach(function(b,c){z=a.memory.angle0+a.memory.angles[c],fTextRotated(String(b),a.getCenter().x+A*Math.cos(z),a.getCenter().y+A*Math.sin(z),z+HalfPi)})}s&&(context=w,a.memory.image=new Image,a.memory.image.src=u.toDataURL(),a.x=x,a.y=y,drawImage(a.memory.image,a.x,a.y,a.width,a.height))}}},NumberListDraw=function(){},NumberListDraw.drawSimpleGraph=function(a,b,c,d){if(null!=b&&null!=b.getNormalized){if(c=c||0,null==a.memory||b!=a.memory.numberList){if(a.memory={numberList:b,minmax:b.getMinMaxInterval(),zero:null},a.memory.minmax.x>0&&a.memory.minmax.y>0?a.memory.normalizedList=b.getNormalizedToMax():(a.memory.normalizedList=b.getNormalized(),a.memory.zero=-a.memory.minmax.x/a.memory.minmax.getAmplitude()),a.memory.xTexts=new StringList,null!=d&&"Interval"==d.type)var e=(d.getAmplitude()+1)/b.length;b.forEach(function(c,f){a.memory.xTexts[f]=null==d?String(b[f]):(null==e?d[f]:d.x+f*e)+":"+b[f]})}var f,g=new Rectangle(a.x+c,a.y+c,a.width-2*c,a.height-2*c);g.bottom=g.getBottom();var h,i=g.width/b.length,j=-1,k=g.containsPoint(mP),l=k?"rgb(160,160,160)":"black";if(a.memory.zero){var m=g.bottom-g.height*a.memory.zero;for(f=0;null!=b[f];f++)h=g.x+f*i,k&&mX>h&&h+i>mX?(j=f,setFill("black")):setFill(l),fRect(g.x+f*i,m,i,-g.height*(a.memory.normalizedList[f]-a.memory.zero))}else for(f=0;null!=b[f];f++)h=g.x+f*i,k&&mX>h&&h+i>mX?(j=f,setFill("black")):setFill(l),fRect(h,g.bottom,i,-g.height*a.memory.normalizedList[f]);var n;if(-1!=j){setText("white",12);var o=a.memory.xTexts[j],p=getTextW(o);setFill("rgb(100,100,100)"),fLines(mX,mY,mX+16,mY-10,mX+p+16,mY-10,mX+p+16,mY-30,mX+6,mY-30,mX+6,mY-10),setFill("white"),fText(o,mX+10,mY-26),MOUSE_DOWN&&(n=j)}return n}},ObjectDraw.count=function(a,b){null==a.memory&&(a.memory={n:1,object:b}),a.memory.object!=b&&(a.memory.object=b,a.memory.n++),MOUSE_DOWN&&a.containsPoint(mP)&&(a.memory.n=0),setText("black",12),fText(a.memory.n,a.x+10,a.y+10)},StringDraw.drawText=function(a,b,c,d,e){e=e||10,c=c||12;var f=new Rectangle(a.x+e,a.y+e,a.width-2*e,a.height-2*e);f.bottom=f.getBottom();var g=Math.floor(1.2*c);if(setText("black",c,null,null,null,d),significantChange=null==a.memory||b!=a.memory.object||c!=a.memory.fontSize||d!=a.memory.fontStyle||e!=a.memory.margin||a.width!=a.memory.width||a.height!=a.memory.height,significantChange){var h=null==b?"":"string"==typeof b?b:JSON.stringify(b,null,"	");a.memory={textLines:DrawTexts.textWordWrapReturnLines(h,f.width,f.height,g,!0),object:b,fontSize:c,fontStyle:d,margin:e,width:a.width,height:a.height}}DrawTexts.fillTextRectangleWithTextLines(a.memory.textLines,f.x,f.y,f.height,g)},StringListDraw.tagCloudRectangles=function(a,b,c){table[1].sqrt().getNormalizedToMax();rectangles=new List,textPositions=new Polygon,textSizes=new NumberList;for(var d,e,f=new List,g=6,h=new Point(0,0),i=0;null!=words[i];i++){for(textSizes[i]=Math.round(16*b[i])*g,DrawTexts.setContextTextProperties("black",textSizes[i],"Arial",null,null,"bold"),d=Math.ceil((2+context.measureText(a[i]).width)/g)*g,e=textSizes[i];StringListDraw._pointInRectangles(f,h,d,e);)h.x+=g,h.y-=g,h.y<0&&(h.y=h.x,h.x=0);rectangles[i]=new Rectangle(h.x,h.y,d,e),f.push(rectangles[i])}},StringListDraw._pointInRectangles=function(a,b,c,d){for(var e,f=0;null!=a[f];f++)if(e=a[f],b.x+c>e.x&&b.x<e.x+e.width&&b.y+d>e.y&&b.y<e.y+e.height)return!0;return!1},StringListVisOperators.simpleTagCloud=function(a,b,c,d,e){d=null==d?"Arial":d,e=null==e?1.2:e;for(var f,g,h,i,j,k,l,m,n,o,p,q=20,r=b.getNormalizedToMax(),s=!0,t=0;s;){for(interLine=q*e,h=0,i=0,m=0,n=0,o=new NumberList,p=new Polygon,f=0;null!=a[f];f++){if(j=a[f],l=Math.floor(Math.sqrt(r[f])*q),o.push(l),context.font=String(l)+"px "+d,k=context.measureText(j).width,h+k>c.width){for(h=0,i+=m*e+1,m=0,g=n;f>g;g++)p[g].y=i;n=f}m=Math.max(m,l),p.push(new Point(h,i)),h+=k+.2*l}for(i+=m*e+1,g=n;null!=a[g];g++)p[g].y=i;s=!1,i<.97*c.height&&(q=.5*q+.5*q*c.height/(i+interLine),s=!0),i>=.995*c.height&&(q=.5*q+.5*q*c.height/(i+interLine),s=!0),t++,t>10&&(s=!1)}return table=new Table,table[0]=a,table[1]=p,table[2]=o,table},StringListVisOperators.tagCloudRectangles=function(a,b,c,d,e){d=null==d?0:d,e=null==e?0:e;var f=b.sqrt().getNormalizedToMax(),g=0==d;rectangles=new List,textPositions=new Polygon,textSizes=new NumberList;var h,i,j,k=new List,l=6,m=0,n=0,o=0;switch(d){case 0:h=c.x,i=c.y;break;case 2:var q=5,r=0,s=1,t=new Point;case 1:h=0,i=0,j=c.getCenter()}for(var u,v,w=c.width/c.height,x=0;null!=a[x];x++){switch(textSizes[x]=g?Math.round(12*f[x])*l:12*f[x]*l,DrawTexts.setContextTextProperties("black",textSizes[x],LOADED_FONT,null,null,"bold"),u=Math.ceil((2+context.measureText(a[x]).width)/l)*l,v=textSizes[x],d){case 0:for(;StringListVisOperators._pointInRectangles(k,h,i,u,v,e);)h+=l,i-=l,i<c.y&&(i=p.x,h=c.x);break;case 1:if(0==x)h=j.x-.5*u,i=j.y-.5*v;else{for(m=.1*x,n=0;StringListVisOperators._pointInRectangles(k,h,i,u,v,e);)n+=1,m+=.005*n,h=j.x+w*n*Math.cos(m)-.5*u,i=j.y+n*Math.sin(m)-.5*v;o=Math.max(o,w*n+.5*u)}break;case 2:if(0==x)t=j.clone(),h=t.x-.5*u,i=t.y-.5*v;else{for(r=0,s=1,m=0,t=j.clone();StringListVisOperators._pointInRectangles(k,h,i,u,v,e);)r++,t.x+=w*q*Math.cos(m),t.y+=q*Math.sin(m),h=t.x-.5*u,i=t.y-.5*v,r>=s&&(m+=.5*Math.PI,s+=.5,r=0);o=Math.max(Math.abs(t.x-j.x)+.5*u,o)}}rectangles[x]=new Rectangle(h,i,u,v),k.push(rectangles[x])}if(1==d||2==d){var y;for(w=.5*c.width/o,x=0;null!=rectangles[x];x++)y=rectangles[x],y.x=j.x+(y.x-j.x)*w,y.y=j.y+(y.y-j.y)*w,y.width*=w,y.height*=w,textSizes[x]*=w}var z=new Table;return z[0]=a,z[1]=rectangles,z[2]=textSizes,z},StringListVisOperators._pointInRectangles=function(a,b,c,d,e,f){for(var g,h=0;null!=a[h];h++)if(g=a[h],b+d>g.x-f&&b<g.x+g.width+f&&c+e>g.y-f&&c<g.y+g.height+f)return!0;return!1},NetworkDraw._drawNode=function(a,b,c,d){var e=!1;return a.image?(clipCircle(b,c,d),drawImage(a.image,b-d,c-1.3*d,2*d,3*d),restore(),e=Math.pow(b-mX,2)+Math.pow(c-mY,2)<=d*d):(setFill(null==a.color?"rgb(50,50,50)":a.color),e=fCircleM(b,c,d)),e&&setCursor("pointer"),e},NetworkDraw.drawRadialNetwork=function(a,b){var c,d,e,f,g=1.1*Math.min(a.width,a.height)/b.nodeList.length,h=.5*a.width-g,i=.5*a.height-g,j=a.x+.5*a.width,k=a.y+.5*a.height,l=TwoPi/b.nodeList.length;new Polygon;return setFill("black"),b.nodeList.forEach(function(a,b){a._drawRadialNetwork_x=j+h*Math.cos(b*l),a._drawRadialNetwork_y=k+i*Math.sin(b*l)}),b.relationList.forEach(function(a){setStroke("black",.25*a.weight),c=.5*(a.node0._drawRadialNetwork_x+a.node1._drawRadialNetwork_x),d=.5*(a.node0._drawRadialNetwork_y+a.node1._drawRadialNetwork_y),e=Math.sqrt(Math.pow(a.node0._drawRadialNetwork_x-a.node1._drawRadialNetwork_x,2),Math.pow(a.node0._drawRadialNetwork_y-a.node1._drawRadialNetwork_y,2))+1,c=(1-.5*(e/h))*c+.5*(e/h)*j,d=(1-.5*(e/i))*d+.5*(e/i)*k,bezier(a.node0._drawRadialNetwork_x,a.node0._drawRadialNetwork_y,c,d,c,d,a.node1._drawRadialNetwork_x,a.node1._drawRadialNetwork_y)}),b.nodeList.forEach(function(a){NetworkDraw._drawNode(a,a._drawRadialNetwork_x,a._drawRadialNetwork_y,g)&&(f=a)}),f},NetworkDraw.drawNetwork2D=function(a,b,c,d,e,f,g){if(null!=b&&null!=c&&"Polygon"==c.type){d=d||!1,e=e||!1,f=f||!1,g=g||0;var h,i,j,k,l,m=1.1*Math.min(a.width,a.height)/b.nodeList.length,n=a.memory,o=null==n||!n.frame.isEqual(a);if(null==n||n.network!=b||n.nNodes!=b.nodeList.length||n.polygon!=c||o||n.respectProportions!=d||n.margin!=g||n.logScale!=e||n.drawGrid!=f){null==n&&(a.memory={},n=a.memory),n.frame=a.clone(),n.network=b;var p=null!=n.polygon&&n.polygon.length!=c.length;n.polygon=c,n.respectProportions=d,n.logScale=e,n.drawGrid=f,n.margin=g,n.nNodes=b.nodeList.length,a.bottom=a.getBottom(),a.right=a.getRight(),n.frameMargin=new Rectangle(a.x+g,a.y+g,a.width-2*g,a.height-2*g),l=n.frameMargin,n.frameMargin.right=n.frameMargin.getRight(),n.frameMargin.bottom=n.frameMargin.getBottom(),n.frameP=c.getFrame(),k=n.frameP,k.right=k.getRight(),k.bottom=k.getBottom(),d&&(i=j=Math.min(i,j));var q;n.actualLogScale=e&&k.x>=0&&k.y>=0,n.actualLogScale?(i=l.width/Math.log((k.right+1)/(k.x+1)),j=l.height/Math.log((k.bottom+1)/(k.y+1)),q=function(a){return new Point((Math.log(a.x+1)-Math.log(k.x+1))*i+l.x,l.bottom-(Math.log(a.y+1)-Math.log(k.y+1))*j)}):(i=l.width/k.width,j=l.height/k.height,q=function(a){return new Point((a.x-k.x)*i+l.x,l.bottom-(a.y-k.y)*j)}),n.projectedPolygon=new Polygon,c.forEach(function(a,b){n.projectedPolygon[b]=q(a)}),k.x<=0&&k.getRight()>=0&&(n.yAxis=-k.x*i+l.x),k.y<=0&&k.getBottom()>=0&&(n.xAxis=l.bottom- -k.y*j),(null==a.memory.projectPolygonConvergent||o||p)&&(a.memory.projectPolygonConvergent=n.projectedPolygon.clone())}else k=n.frameP,l=n.frameMargin;if(setStroke("rgb(50,50,50)",2),n.xAxis&&line(l.x,n.xAxis,n.frameMargin.right,n.xAxis),n.yAxis&&line(n.yAxis,n.frameMargin.y,n.yAxis,n.frameMargin.bottom),a.containsPoint(mP)&&(setStroke("rgb(50,50,50)",.5),line(a.x+2,mY+.5,a.right-4,mY+.5),line(mX+.5,a.y+2,mX+.5,a.bottom-4)),n.projectPolygonConvergent.approach(n.projectedPolygon,.1),b.nodeList.forEach(function(a,b){a.x=n.projectPolygonConvergent[b].x,a.y=n.projectPolygonConvergent[b].y}),b.relationList.forEach(function(a){setStroke("black",.25*a.weight),line(a.node0.x,a.node0.y,a.node1.x,a.node1.y)}),b.nodeList.forEach(function(a){NetworkDraw._drawNode(a,a.x,a.y,m)&&(h=a)}),a.containsPoint(mP))if(null==h)n.actualLogScale?NetworkDraw._drawNodeValues(Math.floor(10*(Math.pow(Math.E,Math.log((k.right+1)/(k.x+1))*(mX-l.x)/l.width)-1))/10,Math.floor(10*(Math.pow(Math.E,Math.log((k.bottom+1)/(k.y+1))*(l.bottom-mY)/l.height)-1))/10):NetworkDraw._drawNodeValues(Math.floor(10*(k.x+k.width*(mX-n.frameMargin.x)/n.frameMargin.width))/10,Math.floor(10*(k.y+k.height*(n.frameMargin.bottom-mY)/n.frameMargin.height))/10);else{var r=b.nodeList.indexOf(h);NetworkDraw._drawNodeValues(c[r].x,c[r].y,h.name)}return h}},NetworkDraw._drawNodeValues=function(a,b,c){var d=(null==c?"":c+": ")+a+", "+b;setFill("rgba(50,50,50,0.8)"),fRect(mX-2,mY-2,-getTextW(d)-4,-14),setText("white",12,null,"right","bottom"),fText(d,mX-4,mY-2)},NetworkDraw.drawNetworkMatrix=function(a,b,c,d,e,f,g,h){d=null==d?ColorOperators.grayScale:d,e=null==e?2:e,f=null==f?!1:f;var i,j,k,l,m=b.nodeList,n=b.relationList,o=null!=g,p=a.width/(m.length+1),q=a.height/(m.length+1),r=p-e,s=q-e,t=p,u=q;if(h=h&&a.pointIsInside(mousePoint))var v=new Point(-1,-1);if(o){p=a.width-p,q=a.height-q;var w,x,y=[],z=[],A=[],B=[]}for(i=0;null!=m[i];i++)context.fillStyle=c[i],o?(w=p*g[i],x=q*g[i],context.fillRect(a.x+t,a.y,w-e,s),context.fillRect(a.x,a.y+u,r,x-e),h&&(mouseX>a.x+t&&mouseX<a.x+t+w&&(v.x=i),mouseY>a.y+u&&mouseY<a.y+u+x&&(v.y=i)),y[m[i].id]=t,z[m[i].id]=u,A[m[i].id]=w,B[m[i].id]=x,t+=w,u+=x):(context.fillRect(a.x+(i+1)*p,a.y,r,s),context.fillRect(a.x,a.y+(i+1)*q,r,s));for(i=0;null!=n[i];i++)j=n[i],context.fillStyle=d(j.weight),o?(context.fillRect(a.x+y[j.node0.id],a.y+z[j.node1.id],A[j.node0.id]-e,B[j.node1.id]-e),f||context.fillRect(a.x+z[j.node1.id],a.y+y[j.node0.id],B[j.node1.id]-e,A[j.node0.id]-e)):(k=m.indexOf(j.node0)+1,l=m.indexOf(j.node1)+1,context.fillRect(a.x+k*p,a.y+l*q,r,s),f||k==l||context.fillRect(a.x+l*p,a.y+k*q,r,s));return v},TreeDraw.drawRectanglesTree=function(a,b,c,d){c=null==c?ColorListGenerators.createCategoricalColors(1,b.nLevels):c,d=d||1;var e=a.width/b.nLevels;TreeDraw._drawRectanglesTreeChildren(b.nodeList[0],new Rectangle(a.x,a.y,e,a.height),c,d)},TreeDraw._drawRectanglesTreeChildren=function(a,b,c,d){context.fillStyle=c[a.level],context.fillRect(b.x+d,b.y+d,b.width-2*d,b.height-2*d);var e=a.toNodeList;if(e.length>0){var f,g,h=b.height/(a.descentWeight-1),i=b.y;for(f=0;null!=e[f];f++)g=h*e[f].descentWeight,TreeDraw._drawRectanglesTreeChildren(e[f],new Rectangle(b.x+b.width,i,b.width,g),c,d),i+=g}},TreeDraw.drawTreemap=function(a,b,c,d,e,f){var g=null==a.memory||a.memory.tree!=b||a.memory.width!=a.width||a.memory.height!=a.height||a.memory.weights!=d;null!=f&&(f=b.nodeList.getNodeById(f.id));var h=null!=f&&(null==a.memory||f!=a.memory.nodeSelected);if(g){var i=null!=a.memory&&null!=a.memory.tree!=b;null!=a.memory&&a.memory.weights!=d;a.memory={tree:b,width:a.width,height:a.height,weights:d,nodeSelected:b.nodeList[0],nFLastChange:nF,image:null};var j=!i&&a.memory.leaves?a.memory.leaves:b.getLeaves();if(a.memory.leaves=j,null==d)b.nodeList.forEach(function(a){a._treeMapWeight=a.descentWeight});else{j.forEach(function(a,b){a._treeMapWeight=d[b]});var k=function(a){var b;if(0==a.toNodeList.length)return a._treeMapWeight;for(a._treeMapWeight=0,b=0;null!=a.toNodeList[b];b++)a._treeMapWeight+=k(a.toNodeList[b]);return a._treeMapWeight};k(b.nodeList[0])}b.nodeList[0]._outRectangle=new Rectangle(0,0,a.width,a.height),b.nodeList[0]._inRectangle=TreeDraw._inRectFromOutRect(b.nodeList[0]._outRectangle),TreeDraw._generateRectangles(b.nodeList[0]),a.memory.focusFrame=TreeDraw._expandRect(b.nodeList[0]._outRectangle),a.memory.kx=a.width/a.memory.focusFrame.width,a.memory.mx=-a.memory.kx*a.memory.focusFrame.x,a.memory.ky=a.height/a.memory.focusFrame.height,a.memory.my=-a.memory.ky*a.memory.focusFrame.y,setText("black",12),b.nodeList.forEach(function(a){a._textWidth=getTextW(a.name)})}if(a.memory.colorList!=c||null==a.memory.colorList){if(a.memory.nFLastChange=nF,a.memory.image=null,a.memory.actualColorList=null==c?ColorListGenerators.createCategoricalColors(0,b.nLevels,ColorScales.grayToOrange,.1):c,a.memory.nodesColorList=new ColorList,null==e&&(a.memory.textsColorList=new ColorList),a.memory.actualColorList.length<=b.nLevels)b.nodeList.forEach(function(b,c){a.memory.nodesColorList[c]=b._color=a.memory.actualColorList[b.level%a.memory.actualColorList.length]});else if(a.memory.actualColorList.length==a.memory.leaves.length){a.memory.leaves.forEach(function(b,c){b._color=a.memory.actualColorList[c],b._rgb=ColorOperators.colorStringToRGB(b._color)});var l=function(a){var b;if(0!=a.toNodeList.length){for(a._rgb=[0,0,0],b=0;null!=a.toNodeList[b];b++)l(a.toNodeList[b]),a._rgb[0]+=a.toNodeList[b]._rgb[0],a._rgb[1]+=a.toNodeList[b]._rgb[1],a._rgb[2]+=a.toNodeList[b]._rgb[2];a._rgb[0]=Math.floor(a._rgb[0]/a.toNodeList.length),a._rgb[1]=Math.floor(a._rgb[1]/a.toNodeList.length),a._rgb[2]=Math.floor(a._rgb[2]/a.toNodeList.length)}};l(b.nodeList[0]),b.nodeList.forEach(function(b,c){b._rgb&&null==b._rgbF&&(b._rgbF=[b._rgb[0],b._rgb[1],b._rgb[2]]),a.memory.nodesColorList[c]="rgb("+b._rgb[0]+","+b._rgb[1]+","+b._rgb[2]+")"})}else b.nodeList.forEach(function(b,c){b._color=a.memory.nodesColorList[c]=a.memory.actualColorList[c%a.memory.actualColorList.length]});if(null==e){var m;b.nodeList.forEach(function(b,c){m=b._color?ColorOperators.colorStringToRGB(b._color):[0,0,0],a.memory.textsColorList[c]=m[0]+m[1]+m[2]>360?"black":"white"})}a.memory.colorList=c}null==e&&(e="black");var n=a.width/a.memory.focusFrame.width,o=-n*a.memory.focusFrame.x,p=a.height/a.memory.focusFrame.height,q=-p*a.memory.focusFrame.y,r=n>a.memory.kx?.05:.1,s=1-r;a.memory.kx=s*a.memory.kx+r*n,a.memory.mx=s*a.memory.mx+r*o,a.memory.ky=s*a.memory.ky+r*p,a.memory.my=s*a.memory.my+r*q;var t,u,v,w,x,y,z,A,B=a.memory.kx,C=a.memory.mx,D=a.memory.ky,E=a.memory.my,F=function(a){return B*a+C},G=function(a){return D*a+E},H=null,I=a.containsPoint(mP),J=nF-a.memory.nFLastChange<50||Math.pow(a.memory.kx-n,2)+Math.pow(a.memory.ky-p,2)+Math.pow(a.memory.mx-o,2)+Math.pow(a.memory.my-q,2)>.01,K=!J&&null==a.memory.image&&!I,L=!J&&!I&&null!=a.memory.image&&!K&&a.memory.image.width>0&&!h;if(L)drawImage(a.memory.image,a.x,a.y,a.width,a.height);else{if(K){var M=document.createElement("canvas");M.width=a.width,M.height=a.height;var N=M.getContext("2d");N.clearRect(0,0,a.width,a.height);var O=context;context=N;var P=a.x,Q=a.y;a.x=0,a.y=0,setFill("white"),fRect(0,0,a.width,a.height),setText("black",12)}else context.save(),clipRectangle(a.x,a.y,a.width,a.height);setStroke("black",.2),b.nodeList.forEach(function(b,c){z=new Rectangle(F(b._outRectangle.x),G(b._outRectangle.y),b._outRectangle.width*B,b._outRectangle.height*D),z.width>5&&z.height>4&&z.x<a.width&&z.getRight()>0&&z.y<a.height&&z.getBottom()>0&&(t=Math.round(a.x+z.x)+.5,u=Math.round(a.y+z.y)+.5,b._rgbF?(b._rgbF[0]=.95*b._rgbF[0]+.05*b._rgb[0],b._rgbF[1]=.95*b._rgbF[1]+.05*b._rgb[1],b._rgbF[2]=.95*b._rgbF[2]+.05*b._rgb[2],setFill("rgb("+Math.floor(b._rgbF[0])+","+Math.floor(b._rgbF[1])+","+Math.floor(b._rgbF[2])+")")):setFill(a.memory.nodesColorList[c]),fsRectM(t,u,Math.floor(z.width),Math.floor(z.height))&&(H=b,A=c),z.width>20&&(v=z.width*TreeDraw.PROP_RECT_MARGIN*.8,w=z.height*TreeDraw.PROP_RECT_MARGIN*.15,x=z.height*TreeDraw.PROP_RECT_LABEL-2,x>=5&&(propTextSpace=(z.width-2*v)/(b._textWidth*x/12),y=propTextSpace<1,y?setText(e?e:a.memory.textsColorList[c],x*propTextSpace):setText(e?e:a.memory.textsColorList[c],x),
fText(b.name,t+v,u+w))))}),K&&(context=O,a.memory.image=new Image,a.memory.image.src=M.toDataURL(),a.x=P,a.y=Q,drawImage(a.memory.image,a.x,a.y,a.width,a.height))}if(I){if(H&&(setCursor("pointer"),z=new Rectangle(F(H._outRectangle.x),G(H._outRectangle.y),H._outRectangle.width*B,H._outRectangle.height*D),t=Math.round(a.x+z.x)+.5,u=Math.round(a.y+z.y)+.5,setStroke(e?e:a.memory.textsColorList[A],2),sRect(t,u,Math.floor(z.width),Math.floor(z.height)),MOUSE_UP_FAST&&(a.memory.focusFrame=TreeDraw._expandRect(H._outRectangle),a.memory.nodeSelected=H,a.memory.image=null)),MOUSE_DOWN&&(a.memory.prevMX=mX,a.memory.prevMY=mY),MOUSE_PRESSED&&(scale=5*a.memory.focusFrame.width/a.width,a.memory.focusFrame.x-=(mX-a.memory.prevMX)*scale,a.memory.focusFrame.y-=(mY-a.memory.prevMY)*scale,a.memory.prevMX=mX,a.memory.prevMY=mY),0!=WHEEL_CHANGE){var R=a.memory.focusFrame.getCenter(),S=1-.1*WHEEL_CHANGE;a.memory.focusFrame.x=R.x-.5*a.memory.focusFrame.width*S,a.memory.focusFrame.y=R.y-.5*a.memory.focusFrame.height*S,a.memory.focusFrame.width*=S,a.memory.focusFrame.height*=S}(MOUSE_PRESSED||0!=WHEEL_CHANGE)&&(a.memory.image=null)}return h&&(a.memory.focusFrame=TreeDraw._expandRect(f._outRectangle),a.memory.nodeSelected=f,a.memory.image=null),K||L||context.restore(),a.memory.nodeSelected},TreeDraw._generateRectangles=function(a){var b=new NumberList;a.toNodeList.forEach(function(a){b.push(a._treeMapWeight)});var c=RectangleOperators.squarify(a._inRectangle,b,!1,!1);a.toNodeList.forEach(function(a,b){a._outRectangle=TreeDraw._reduceRect(c[b]),a._inRectangle=TreeDraw._inRectFromOutRect(a._outRectangle),TreeDraw._generateRectangles(a)})},TreeDraw._reduceRect=function(a){return new Rectangle(a.x+a.width*TreeDraw.PROP_RECT_REDUCTION_MARGIN,a.y+a.height*TreeDraw.PROP_RECT_REDUCTION_MARGIN,a.width*(1-2*TreeDraw.PROP_RECT_REDUCTION_MARGIN),a.height*(1-2*TreeDraw.PROP_RECT_REDUCTION_MARGIN))},TreeDraw._expandRect=function(a){return new Rectangle(a.x-a.width*TreeDraw.PROP_RECT_EXPANTION_MARGIN,a.y-a.height*TreeDraw.PROP_RECT_EXPANTION_MARGIN,a.width*(1+2*TreeDraw.PROP_RECT_EXPANTION_MARGIN),a.height*(1+2*TreeDraw.PROP_RECT_EXPANTION_MARGIN))},TreeDraw._inRectFromOutRect=function(a){return new Rectangle(a.x+a.width*TreeDraw.PROP_RECT_MARGIN,a.y+a.height*TreeDraw.PROP_RECT_LABEL,a.width*(1-2*TreeDraw.PROP_RECT_MARGIN),a.height*(1-TreeDraw.PROP_RECT_MARGIN-TreeDraw.PROP_RECT_LABEL))},TreeDraw.PROP_RECT_MARGIN=.03,TreeDraw.PROP_RECT_LABEL=.2,TreeDraw.PROP_RECT_REDUCTION_MARGIN=.01,TreeDraw.PROP_RECT_EXPANTION_MARGIN=.05,TreeDraw.drawDecisionTree=function(a,b){var d=null==a.memory||a.memory.tree!=b||a.memory.width!=a.width||a.memory.height!=a.height,e=.06*a.height,f=b.nLevels*(a.height-e)/(b.nLevels+1),g=f/b.nLevels,h=!1;if(d){var i=null!=a.memory&&null!=a.memory.tree&&a.memory.tree!=b;a.memory={tree:b,width:a.width,height:a.height,nodeSelected:b.nodeList[0],nFLastChange:nF,leaves:null,image:null},(i||null==a.memory.leaves)&&(a.memory.leaves=b.getLeaves().getSortedByProperty("valueFollowingProbability",!1)),b.nodeList[0]._outRectangle=new Rectangle(0,0,a.width,f),b.nodeList[0]._inRectangle=TreeDraw._inRectFromOutRectDecision(b.nodeList[0]._outRectangle,g),TreeDraw._generateRectanglesDecision(b.nodeList[0],g),a.memory.focusFrame=new Rectangle(0,0,a.width,a.height),a.memory.kx=a.width/a.memory.focusFrame.width,a.memory.mx=-a.memory.kx*a.memory.focusFrame.x,a.memory.ky=a.height/a.memory.focusFrame.height,a.memory.my=-a.memory.ky*a.memory.focusFrame.y,setText("black",12),b.nodeList.forEach(function(a){a.label=0==a.toNodeList.length?Math.round(100*a.valueFollowingProbability)/100:a.bestFeatureName,a._textWidth=getTextW(a.label)})}a.memory.followingWeights&&b.nodeList.forEach(function(a){a._treeMapWeight=a.descentWeight});var j="black",k=a.width/a.memory.focusFrame.width,l=-k*a.memory.focusFrame.x,m=k>a.memory.kx?.05:.1,n=1-m;a.memory.kx=n*a.memory.kx+m*k,a.memory.mx=n*a.memory.mx+m*l;var o,p,q,r,s,t,u,v,w=a.memory.kx,x=a.memory.mx,y=function(a){return w*a+x},z=null,A=a.containsPoint(mP),B=nF-a.memory.nFLastChange<80||Math.pow(a.memory.kx-k,2)+Math.pow(a.memory.mx-l,2)>.001,C=!B&&null==a.memory.image&&!A,D=!B&&!A&&null!=a.memory.image&&!C&&a.memory.image.width>0;if(D)drawImage(a.memory.image,a.x,a.y,a.width,a.height);else{if(c.l("drawing"),C){var E=document.createElement("canvas");E.width=a.width,E.height=a.height;var F=E.getContext("2d");F.clearRect(0,0,a.width,a.height);var G=context;context=F;var H=a.x,I=a.y;a.x=0,a.y=0,setFill("white"),fRect(0,0,a.width,a.height),setText("black",12)}else context.save(),clipRectangle(a.x,a.y,a.width,a.height);var J=a.y+f+e;setStroke("black",.2),b.nodeList.forEach(function(b,c){if(u=new Rectangle(y(b._outRectangle.x),b._outRectangle.y,b._outRectangle.width*w,b._outRectangle.height),u.x<a.width&&u.getRight()>0&&u.y<a.height&&u.getBottom()>0){o=Math.round(a.x+u.x)+.5,p=Math.round(a.y+u.y)+.5,b.pattern?(context.fillStyle=b.pattern,context.fillRect(o,p,Math.floor(u.width),Math.floor(u.height)),sRectM(o,p,Math.floor(u.width),Math.floor(u.height))&&(z=b,v=c)):(setFill(b._color),fsRectM(o,p,Math.floor(u.width),Math.floor(u.height))&&(z=b,v=c));var d=Math.min(u.getRight(),a.width)-Math.max(u.x,0);d>16&&(q=u.width*TreeDraw.PROP_RECT_MARGIN*.8,r=u.height*TreeDraw.PROP_RECT_MARGIN*.15,tC=j?j:a.memory.textsColorList[c],s=18,setText(tC,s),t=!0,t&&clipRectangle(o,p-17,u.width,u.height),fText(b.label,Math.max(o,a.x)+8,p+1),b.value&&(s=14,setText(tC,s),fText(b.value,Math.max(o,a.x)+8,p-17)),d-b._textWidth>60&&(s=12,setText(tC,s,null,"right"),fText("s="+b.weight,Math.min(a.x+u.getRight(),a.getRight())-2,p+1),fText("e="+Math.round(100*b.entropy)/100,Math.min(a.x+u.getRight(),a.getRight())-2,p+12),b.toNodeList.length>0&&fText("P="+Math.round(100*b.valueFollowingProbability)/100,Math.min(a.x+u.getRight(),a.getRight())-2,p+23),fText("l="+Math.round(100*b.lift)/100,Math.min(a.x+u.getRight(),a.getRight())-2,p+23+(b.toNodeList.length>0?11:0))),t&&context.restore())}});var K,L=a.x,M=a.width/b.nodeList[0].weight,N=!0,O=!0,P=!0,Q=!0,R=!0;a.memory.leaves.forEach(function(a){setStroke("black",.2),K=M*a.weight,a.pattern?(context.fillStyle=a.pattern,context.fillRect(L,J,K,g),sRectM(L,J,K,g)&&(z=a,v=b.nodeList.indexOf(a))):(setFill(a._color),fsRectM(L,J,K,g)&&(z=a,v=b.nodeList.indexOf(a))),a._xLeaf=L,a._wLeaf=K,setStroke("black",1),N&&a.valueFollowingProbability<b.nodeList[0].valueFollowingProbability&&(N=!1,setFill("black"),fLines(L,J-14,L+4,J-8,L,J-2,L-4,J-8)),O&&a.valueFollowingProbability<=2*b.nodeList[0].valueFollowingProbability&&(O=!1,line(L,J-14,L,J-2)),P&&a.valueFollowingProbability<.5*b.nodeList[0].valueFollowingProbability&&(P=!1,line(L,J-14,L,J-2)),Q&&a.valueFollowingProbability<=1.5*b.nodeList[0].valueFollowingProbability&&(Q=!1,line(L,J-8,L,J-2)),R&&a.valueFollowingProbability<.66667*b.nodeList[0].valueFollowingProbability&&(R=!1,line(L,J-8,L,J-2)),L+=K}),C&&(context=G,a.memory.image=new Image,a.memory.image.src=E.toDataURL(),a.x=H,a.y=I,drawImage(a.memory.image,a.x,a.y,a.width,a.height))}if(A){if(z&&(setCursor("pointer"),u=new Rectangle(y(z._outRectangle.x),z._outRectangle.y,z._outRectangle.width*w,z._outRectangle.height),o=Math.round(a.x+u.x)+.5,p=Math.round(a.y+u.y)+.5,setStroke(j?j:a.memory.textsColorList[v],2),z._wLeaf&&(setFill("rgba(0,0,0,0.5)"),context.beginPath(),context.moveTo(o,J-e),context.bezierCurveTo(o,J-.65*e,z._xLeaf,J-.35*e,z._xLeaf,J),context.lineTo(z._xLeaf+z._wLeaf,J),context.bezierCurveTo(z._xLeaf+z._wLeaf,J-.35*e,o+u.width,J-.65*e,o+u.width,J-e),context.fill(),sRect(z._xLeaf,J,z._wLeaf,g)),sRect(o,p,Math.floor(u.width),Math.floor(u.height)),MOUSE_UP_FAST&&(a.memory.focusFrame=new Rectangle(z._outRectangle.x-.025*z._outRectangle.width,0,1.05*z._outRectangle.width,a.height),a.memory.focusFrame.x<0&&(a.memory.focusFrame.width+=a.memory.focusFrame.x,a.memory.focusFrame.x=0),a.memory.focusFrame.getRight()>a.width&&(a.memory.focusFrame.width-=a.memory.focusFrame.getRight()-a.width,a.memory.focusFrame.x=a.width-a.memory.focusFrame.width),a.memory.nodeSelected=z,h=!0,a.memory.image=null)),MOUSE_DOWN&&(a.memory.prevMX=mX),MOUSE_PRESSED&&(scale=5*a.memory.focusFrame.width/a.width,a.memory.focusFrame.x-=(mX-a.memory.prevMX)*scale,a.memory.prevMX=mX),0!=WHEEL_CHANGE){var S=a.memory.focusFrame.getCenter(),T=1+.1*WHEEL_CHANGE;a.memory.focusFrame.x=S.x-.5*a.memory.focusFrame.width*T,a.memory.focusFrame.width*=T}(MOUSE_PRESSED||0!=WHEEL_CHANGE)&&(a.memory.image=null)}return C||D||context.restore(),a.memory.overNode!=z&&(a.memory.overNode=z,h=!0),(h||null==a.memory.result)&&(a.memory.result=[{value:a.memory.nodeSelected,type:"Node"},{value:a.memory.overNode,type:"Node"}]),a.memory.result},TreeDraw._generateRectanglesDecision=function(a,b){var c=new NumberList;a.toNodeList.forEach(function(a){c.push(a.weight)});var d=TreeDraw._horizontalRectanglesDecision(a._inRectangle,c);a.toNodeList.forEach(function(a,c){a._outRectangle=d[c],a._inRectangle=TreeDraw._inRectFromOutRectDecision(a._outRectangle,b),TreeDraw._generateRectanglesDecision(a,b)})},TreeDraw._inRectFromOutRectDecision=function(a,b){return new Rectangle(a.x,a.y+b,a.width,a.height-b)},TreeDraw._horizontalRectanglesDecision=function(a,b){var c,d=new List,e=a.x,f=b.getNormalizedToSum();return f.forEach(function(b){c=b*a.width,d.push(new Rectangle(e,a.y,c,a.height)),e+=c}),d},Global.userAgent="unknown",init=function(){},cycle=function(){},resizeWindow=function(){},lastCycle=function(){};var listenerArray=[],canvas,userAgent="none",userAgentVersion,canvasResizeable=!0,cW=1,cH=1,cX=1,cY=1,mX=0,mY=0,mP=new Point(0,0),nF=0,MOUSE_DOWN=!1,MOUSE_UP=!1,MOUSE_UP_FAST=!1,WHEEL_CHANGE=0,NF_DOWN,NF_UP,MOUSE_PRESSED,MOUSE_IN_DOCUMENT=!0,mX_DOWN,mY_DOWN,mX_UP,mY_UP,PREV_mX=0,PREV_mY=0,DX_MOUSE=0,DY_MOUSE=0,MOUSE_MOVED=!1,T_MOUSE_PRESSED=0,cursorStyle="auto",backGroundColor="white",backGroundColorRGB=[255,255,255],cycleActive,context,TwoPi=2*Math.PI,HalfPi=.5*Math.PI,radToGrad=180/Math.PI,gradToRad=Math.PI/180,c=console;c.l=c.log;var _wheelActivated=!1,_keyboardActivated=!1,_prevMouseX=0,_prevMouseY=0,_setIntervalId,_setTimeOutId,_cycleOnMouseMovement=!1,_interactionCancelledFrame,_tLastMouseDown,_alphaRefresh=0,END_CYCLE_DELAY=3e3;Array.prototype.last=function(){return this[this.length-1]},window.addEventListener("load",function(){if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){if(userAgent="IE",userAgentVersion=Number(RegExp.$1),9>userAgentVersion)return null}else/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)?(userAgent="FIREFOX",userAgentVersion=Number(RegExp.$1)):null!=navigator.userAgent.match(/Chrome/)?(userAgent="CHROME",userAgentVersion=Number(RegExp.$1)):/Mozilla[\/\s](\d+\.\d+)/.test(navigator.userAgent)||null!=navigator.userAgent.match(/Mozilla/)?(userAgent="MOZILLA",userAgentVersion=Number(RegExp.$1)):null!=navigator.userAgent.match(/Safari/)?(userAgent="Safari",userAgentVersion=Number(RegExp.$1)):null!=navigator.userAgent.match(/iPad/i)?userAgent="IOS":null!=navigator.userAgent.match(/iPhone/i)&&(userAgent="IOS");Global.userAgent=userAgent,Global._frameRate=30,canvas=document.getElementById("main"),null!=canvas&&(context=canvas.getContext("2d"),_adjustCanvas(),canvas.addEventListener("mousemove",_onMouse,!1),canvas.addEventListener("mousedown",_onMouse,!1),canvas.addEventListener("mouseup",_onMouse,!1),canvas.addEventListener("mouseenter",_onMouse,!1),canvas.addEventListener("mouseleave",_onMouse,!1),activateWheel(),window.addEventListener("resize",onResize,!1),startCycle(),init()),c.l("Moebio Framework v2.259 | user agent: "+userAgent+" | user agent version: "+userAgentVersion+" | canvas detected: "+(null!=canvas))},!1),setStructureLocalStorageWithSeed=function(a,b,c){setStructureLocalStorage(a,MD5.hex_md5(b),c)},setStructureLocalStorage=function(a,b,c){var d,e=typeOf(a);switch(e){case"string":d=a;break;case"Network":d=NetworkEncodings.encodeGDF(network);break;default:e="object",d=JSON.stringify(a)}var f={id:b,type:e,comments:c,date:new Date,code:d},g=JSON.stringify(f);localStorage.setItem(b,g)},getStructureLocalStorageFromSeed=function(a,b){return getStructureLocalStorage(MD5.hex_md5(a),b)},getStructureLocalStorage=function(a,b){b=b||!1;var c=localStorage.getItem(a);if(null==c)return null;try{var d=JSON.parse(c)}catch(e){return null}if(null==d.type&&null==d.code)return null;var f,g=d.type,h=d.code;switch(g){case"string":f=h;break;case"Network":f=NetworkEncodings.decodeGDF(h);break;case"object":f=JSON.parse(h)}return b?(d.object=f,d.size=d.code.length,d.date=new Date(d.date),d):f};